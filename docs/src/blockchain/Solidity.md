# Solidity

## å¼€å‘å·¥å…·ï¼šremix

`	remix`æ˜¯ä»¥å¤ªåŠå®˜æ–¹æ¨èçš„æ™ºèƒ½åˆçº¦å¼€å‘IDEï¼ˆé›†æˆå¼€å‘ç¯å¢ƒï¼‰ï¼Œé€‚åˆæ–°æ‰‹ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­å¿«é€Ÿéƒ¨ç½²æµ‹è¯•æ™ºèƒ½åˆçº¦ï¼Œä½ ä¸éœ€è¦åœ¨æœ¬åœ°å®‰è£…ä»»ä½•ç¨‹åºã€‚

ç½‘å€ï¼š[remix.ethereum.org](https://remix.ethereum.org/)

è¿›å…¥`remix`ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€å·¦è¾¹çš„èœå•æœ‰ä¸‰ä¸ªæŒ‰é’®ï¼Œåˆ†åˆ«å¯¹åº”æ–‡ä»¶ï¼ˆå†™ä»£ç çš„åœ°æ–¹ï¼‰ï¼Œç¼–è¯‘ï¼ˆè·‘ä»£ç ï¼‰ï¼Œéƒ¨ç½²ï¼ˆéƒ¨ç½²åˆ°é“¾ä¸Šï¼‰ã€‚æˆ‘ä»¬ç‚¹æ–°å»ºï¼ˆ`Create New File`ï¼‰æŒ‰é’®ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºç™½çš„`solidity`åˆçº¦ã€‚

![remix](https://www.wtf.academy/assets/images/1-1-59ec4df354181363259759212e42dad1.png)

## ç¬¬ä¸€ä¸ªSolidityç¨‹åº

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;
contract HelloWeb3{
    string public _string = "Hello Web3!";
}
```

æˆ‘ä»¬æ‹†å¼€åˆ†æï¼Œå­¦ä¹ solidityä»£ç æºæ–‡ä»¶çš„ç»“æ„ï¼š

1. ç¬¬1è¡Œæ˜¯æ³¨é‡Šï¼Œä¼šå†™ä¸€ä¸‹è¿™ä¸ªä»£ç æ‰€ç”¨çš„è½¯ä»¶è®¸å¯ï¼ˆlicenseï¼‰ï¼Œè¿™é‡Œç”¨çš„æ˜¯MIT licenseã€‚å¦‚æœä¸å†™è®¸å¯ï¼Œç¼–è¯‘æ—¶ä¼šè­¦å‘Šï¼ˆwarningï¼‰ï¼Œä½†ç¨‹åºå¯ä»¥è¿è¡Œã€‚solidityçš„æ³¨é‡Šç”±â€œ//â€å¼€å¤´ï¼Œåé¢è·Ÿæ³¨é‡Šçš„å†…å®¹ï¼ˆä¸ä¼šè¢«ç¨‹åºè¿è¡Œï¼‰ã€‚

```solidity
// SPDX-License-Identifier: MIT
```



1. ç¬¬2è¡Œå£°æ˜æºæ–‡ä»¶æ‰€ç”¨çš„solidityç‰ˆæœ¬ï¼Œå› ä¸ºä¸åŒç‰ˆæœ¬è¯­æ³•æœ‰å·®åˆ«ã€‚è¿™è¡Œä»£ç æ„æ€æ˜¯æºæ–‡ä»¶å°†ä¸å…è®¸å°äº 0.8.4 ç‰ˆæœ¬æˆ–å¤§äºç­‰äº 0.9.0 ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ç¼–è¯‘ï¼ˆç¬¬äºŒä¸ªæ¡ä»¶ç”±`^`æä¾›ï¼‰ã€‚Solidity è¯­å¥ä»¥åˆ†å·ï¼ˆ;ï¼‰ç»“å°¾ã€‚

```solidity
pragma solidity ^0.8.4;
```



1. ç¬¬3-4è¡Œæ˜¯åˆçº¦éƒ¨åˆ†ï¼Œç¬¬3è¡Œåˆ›å»ºåˆçº¦ï¼ˆcontractï¼‰ï¼Œå¹¶å£°æ˜åˆçº¦çš„åå­— HelloWeb3ã€‚ç¬¬4è¡Œæ˜¯åˆçº¦çš„å†…å®¹ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªstringï¼ˆå­—ç¬¦ä¸²ï¼‰å˜é‡_stringï¼Œå¹¶ç»™ä»–èµ‹å€¼ â€œHello Web3!â€ã€‚

```solidity
contract HelloWeb3{
    string public _string = "Hello Web3!";
}
```



## ç¼–è¯‘å¹¶éƒ¨ç½²ä»£ç 

åœ¨ç¼–è¾‘ä»£ç çš„é¡µé¢ï¼ŒæŒ‰ctrl+Så°±å¯ä»¥ç¼–è¯‘ä»£ç ï¼Œéå¸¸æ–¹ä¾¿ã€‚

ç¼–è¯‘å¥½ä¹‹åï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„â€œéƒ¨ç½²â€æŒ‰é’®ï¼Œè¿›å…¥éƒ¨ç½²é¡µé¢ã€‚

![img](https://www.wtf.academy/assets/images/1-2-e3548890cecc06c795a172d811ccc0e6.png)

åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œremixä¼šç”¨JSè™šæ‹Ÿæœºæ¥æ¨¡æ‹Ÿä»¥å¤ªåŠé“¾ï¼Œè¿è¡Œæ™ºèƒ½åˆçº¦ï¼Œç±»ä¼¼åœ¨æµè§ˆå™¨é‡Œè·‘ä¸€æ¡æµ‹è¯•é“¾ã€‚å¹¶ä¸”remixä¼šåˆ†é…å‡ ä¸ªæµ‹è¯•è´¦æˆ·ç»™ä½ ï¼Œæ¯ä¸ªé‡Œé¢æœ‰100 ETHï¼ˆæµ‹è¯•ä»£å¸ï¼‰ï¼Œå¯åŠ²å„¿ç”¨ã€‚ä½ ç‚¹Deployï¼ˆé»„è‰²æŒ‰é’®ï¼‰ï¼Œå°±å¯ä»¥éƒ¨ç½²å’±ä»¬å†™å¥½çš„åˆçº¦äº†ã€‚

![img](https://www.wtf.academy/assets/images/1-3-7efd0f70cd17c437f6ec29fc6d28c0d6.png)

éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šåœ¨ä¸‹é¢çœ‹åˆ°åä¸º`HelloWeb3`çš„åˆçº¦ï¼Œç‚¹å‡»`_string`ï¼Œå°±èƒ½çœ‹åˆ°æˆ‘ä»¬ä»£ç ä¸­å†™çš„ â€œHello Web3!â€ äº†ã€‚



## Gasè´¹

ä½ éœ€è¦æ”¯ä»˜å¤šå°‘ä»¥å¤ªå¸æ¥è¿›è¡Œä¸€æ¬¡äº¤æ˜“ï¼Ÿ ä½ éœ€è¦æ”¯ä»˜ gas æ¶ˆè€—é‡ * gas ä»·æ ¼ çš„ä»¥å¤ªå¸ï¼Œå…¶ä¸­ï¼š

gas æ˜¯è®¡ç®—å•ä½\

gas æ¶ˆè€—é‡æ˜¯äº¤æ˜“ä¸­ä½¿ç”¨çš„æ€» gas æ•°é‡\

gas ä»·æ ¼æ˜¯ä½ æ„¿æ„æ”¯ä»˜çš„æ¯å•ä½ gas çš„ä»¥å¤ªå¸\

å…·æœ‰æ›´é«˜ gas ä»·æ ¼çš„äº¤æ˜“å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§è¢«åŒ…å«åœ¨åŒºå—ä¸­ã€‚
æœªä½¿ç”¨çš„ gas å°†è¢«é€€è¿˜ã€‚

ç‡ƒæ°”é™åˆ¶
ä½ å¯ä»¥èŠ±è´¹çš„ gas æœ‰ä¸¤ä¸ªä¸Šé™\

- gas é™åˆ¶ï¼ˆä½ ä¸ºäº¤æ˜“è®¾ç½®çš„æœ€å¤§ gas é‡ï¼‰\
- åŒºå— gas é™åˆ¶ï¼ˆç½‘ç»œè®¾ç½®çš„åŒºå—ä¸­å…è®¸çš„æœ€å¤§ gas é‡ï¼‰

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Gas {
uint public i = 0;

  // ä½¿ç”¨å®Œä½ å‘é€çš„æ‰€æœ‰ gas ä¼šå¯¼è‡´ä½ çš„äº¤æ˜“å¤±è´¥ã€‚
  // çŠ¶æ€æ›´æ”¹è¢«æ’¤é”€ã€‚
  // èŠ±è´¹çš„ gas ä¸ä¼šè¢«é€€è¿˜ã€‚
  function forever() public {
      // åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ªå¾ªç¯ç›´åˆ°èŠ±è´¹æ‰€æœ‰çš„ gas
      // äº¤æ˜“å¤±è´¥
      while (true) {
          i += 1;
      }
  }
}
```



ä»£ç æœ¯è¯­è§£é‡Šï¼š

- gasï¼šä»¥å¤ªåŠä¸­çš„è®¡ç®—å•ä½ã€‚
- gas spentï¼šåœ¨äº¤æ˜“ä¸­ä½¿ç”¨çš„ gas æ€»æ•°ã€‚
- gas priceï¼šä¸ºæ¯å•ä½ gas æ‰€æ”¯ä»˜çš„ä»¥å¤ªå¸æ•°é‡ã€‚
- gas limitï¼šäº¤æ˜“ä¸­å¯ä½¿ç”¨çš„æœ€å¤§ gas æ•°é‡ï¼Œç”±ç”¨æˆ·è®¾ç½®ã€‚
- åŒºå— gas é™åˆ¶ï¼šæ¯ä¸ªåŒºå—ä¸­å…è®¸çš„æœ€å¤§ gas æ•°é‡ï¼Œç”±ç½‘ç»œè®¾ç½®ã€‚



### Solidityä¸­çš„å˜é‡ç±»å‹

1. **æ•°å€¼ç±»å‹(Value Type)**ï¼šåŒ…æ‹¬å¸ƒå°”å‹ï¼Œæ•´æ•°å‹ç­‰ç­‰ï¼Œè¿™ç±»å˜é‡èµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’æ•°å€¼ã€‚
2. **å¼•ç”¨ç±»å‹(Reference Type)**ï¼šåŒ…æ‹¬æ•°ç»„å’Œç»“æ„ä½“ï¼Œè¿™ç±»å˜é‡å ç©ºé—´å¤§ï¼Œèµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ã€‚
3. **æ˜ å°„ç±»å‹(Mapping Type)**: `Solidity`é‡Œçš„å“ˆå¸Œè¡¨ã€‚
4. **å‡½æ•°ç±»å‹(Function Type)**ï¼š`Solidity`æ–‡æ¡£é‡ŒæŠŠå‡½æ•°å½’åˆ°æ•°å€¼ç±»å‹ï¼Œä½†æˆ‘è§‰å¾—ä»–è·Ÿå…¶ä»–ç±»å‹å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥å•ç‹¬åˆ†ä¸€ç±»ã€‚

æˆ‘ä»¬åªä»‹ç»ä¸€äº›å¸¸ç”¨çš„ç±»å‹ï¼Œä¸å¸¸ç”¨çš„ä¸è®²ã€‚è¿™ç¯‡ä»‹ç»æ•°å€¼ç±»å‹ï¼Œç¬¬3è®²ä»‹ç»å‡½æ•°ç±»å‹ï¼Œç¬¬4è®²ä»‹ç»å¼•ç”¨å’Œæ˜ å°„ã€‚



## æ•°å€¼ç±»å‹

### 1. å¸ƒå°”å‹

å¸ƒå°”å‹æ˜¯äºŒå€¼å˜é‡ï¼Œå–å€¼ä¸º`true`æˆ–`false`ã€‚

```solidity
    // å¸ƒå°”å€¼
    bool public _bool = true;
```



å¸ƒå°”å€¼çš„è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ï¼š

- ! ï¼ˆé€»è¾‘éï¼‰
- && ï¼ˆé€»è¾‘ä¸ï¼Œ "and" ï¼‰
- || ï¼ˆé€»è¾‘æˆ–ï¼Œ "or" ï¼‰
- == ï¼ˆç­‰äºï¼‰
- != ï¼ˆä¸ç­‰äºï¼‰

ä»£ç ï¼š

```solidity
    // å¸ƒå°”è¿ç®—
    bool public _bool1 = !_bool; //å–é
    bool public _bool2 = _bool && _bool1; //ä¸
    bool public _bool3 = _bool || _bool1; //æˆ–
    bool public _bool4 = _bool == _bool1; //ç›¸ç­‰
    bool public _bool5 = _bool != _bool1; //ä¸ç›¸ç­‰
```



ä¸Šé¢çš„ä»£ç ä¸­ï¼šå˜é‡`_bool`çš„å–å€¼æ˜¯`true`ï¼›`_bool1`æ˜¯`_bool`çš„éï¼Œä¸º`false`ï¼›`_bool && _bool1`ä¸º`false`ï¼›`_bool || _bool1`ä¸º`true`ï¼›`_bool == _bool1`ä¸º`false`ï¼›`_bool != _bool1`ä¸º`true`ã€‚ **å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š**`&&` å’Œ `||`è¿ç®—ç¬¦éµå¾ªçŸ­è·¯è§„åˆ™ï¼Œè¿™æ„å‘³ç€ï¼Œå‡å¦‚å­˜åœ¨`f(x) || g(y)`çš„è¡¨è¾¾å¼ï¼Œå¦‚æœ`f(x)`æ˜¯`true`ï¼Œ`g(y)`ä¸ä¼šè¢«è®¡ç®—ï¼Œå³ä½¿å®ƒå’Œ`f(x)`çš„ç»“æœæ˜¯ç›¸åçš„



### 2. æ•´å‹

æ•´å‹æ˜¯`solidity`ä¸­çš„æ•´æ•°ï¼Œæœ€å¸¸ç”¨çš„åŒ…æ‹¬

```solidity
    // æ•´å‹
    int public _int = -1; // æ•´æ•°ï¼ŒåŒ…æ‹¬è´Ÿæ•°
    uint public _uint = 1; // æ­£æ•´æ•°
    uint256 public _number = 20220330; // 256ä½æ­£æ•´æ•°
```



å¸¸ç”¨çš„æ•´å‹è¿ç®—ç¬¦åŒ…æ‹¬ï¼š

- æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰ï¼š `<=`ï¼Œ `<`ï¼Œ `==`ï¼Œ `!=`ï¼Œ `>=`ï¼Œ `>`
- ç®—æ•°è¿ç®—ç¬¦ï¼š `+`ï¼Œ `-`ï¼Œ ä¸€å…ƒè¿ç®— `-`ï¼Œ `+`ï¼Œ `*`ï¼Œ `/`ï¼Œ `%`ï¼ˆå–ä½™ï¼‰ï¼Œ`**`ï¼ˆå¹‚ï¼‰

ä»£ç ï¼š

```solidity
    // æ•´æ•°è¿ç®—
    uint256 public _number1 = _number + 1; // +ï¼Œ-ï¼Œ*ï¼Œ/
    uint256 public _number2 = 2**2; // æŒ‡æ•°
    uint256 public _number3 = 7 % 2; // å–ä½™æ•°
    bool public _numberbool = _number2 > _number3; // æ¯”å¤§å°
```



### 3. åœ°å€ç±»å‹

åœ°å€ç±»å‹(address)å­˜å‚¨ä¸€ä¸ª 20 å­—èŠ‚çš„å€¼ï¼ˆä»¥å¤ªåŠåœ°å€çš„å¤§å°ï¼‰ã€‚åœ°å€ç±»å‹ä¹Ÿæœ‰æˆå‘˜å˜é‡ï¼Œå¹¶ä½œä¸ºæ‰€æœ‰åˆçº¦çš„åŸºç¡€ã€‚æœ‰æ™®é€šçš„åœ°å€å’Œå¯ä»¥è½¬è´¦`ETH`çš„åœ°å€ï¼ˆ`payable`ï¼‰ã€‚`payable`çš„åœ°å€æ‹¥æœ‰`balance`å’Œ`transfer()`ä¸¤ä¸ªæˆå‘˜ï¼Œæ–¹ä¾¿æŸ¥è¯¢`ETH`ä½™é¢ä»¥åŠè½¬è´¦ã€‚

ä»£ç 

```solidity
    // åœ°å€
    address public _address = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;
    address payable public _address1 = payable(_address); // payable addressï¼Œå¯ä»¥è½¬è´¦ã€æŸ¥ä½™é¢
    // åœ°å€ç±»å‹çš„æˆå‘˜
    uint256 public balance = _address1.balance; // balance of address
```



### 4. å®šé•¿å­—èŠ‚æ•°ç»„

å­—èŠ‚æ•°ç»„`bytes`åˆ†ä¸¤ç§ï¼Œä¸€ç§å®šé•¿ï¼ˆ`byte`, `bytes8`, `bytes32`ï¼‰ï¼Œå¦ä¸€ç§ä¸å®šé•¿ã€‚å®šé•¿çš„å±äºæ•°å€¼ç±»å‹ï¼Œä¸å®šé•¿çš„æ˜¯å¼•ç”¨ç±»å‹ï¼ˆä¹‹åè®²ï¼‰ã€‚ å®šé•¿`bytes`å¯ä»¥å­˜ä¸€äº›æ•°æ®ï¼Œæ¶ˆè€—`gas`æ¯”è¾ƒå°‘ã€‚

ä»£ç ï¼š

```solidity
    // å›ºå®šé•¿åº¦çš„å­—èŠ‚æ•°ç»„
    bytes32 public _byte32 = "MiniSolidity"; 
    bytes1 public _byte = _byte32[0]; 
```



```
MiniSolidity`å˜é‡ä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨è¿›å˜é‡`_byte32`ï¼Œè½¬æ¢æˆ`16è¿›åˆ¶`ä¸ºï¼š`0x4d696e69536f6c69646974790000000000000000000000000000000000000000
```

`_byte`å˜é‡å­˜å‚¨`_byte32`çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œä¸º`0x4d`ã€‚

### 5. æšä¸¾ enum

æšä¸¾ï¼ˆ`enum`ï¼‰æ˜¯`solidity`ä¸­ç”¨æˆ·å®šä¹‰çš„æ•°æ®ç±»å‹ã€‚å®ƒä¸»è¦ç”¨äºä¸º`uint`åˆ†é…åç§°ï¼Œä½¿ç¨‹åºæ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚å®ƒä¸`Cè¯­è¨€`ä¸­çš„`enum`ç±»ä¼¼ï¼Œä½¿ç”¨åç§°æ¥ä»£æ›¿ä»`0`å¼€å§‹çš„`uint`ï¼š

```solidity
    // ç”¨enumå°†uint 0ï¼Œ 1ï¼Œ 2è¡¨ç¤ºä¸ºBuy, Hold, Sell
    enum ActionSet { Buy, Hold, Sell }
    // åˆ›å»ºenumå˜é‡ action
    ActionSet action = ActionSet.Buy;
```



å®ƒå¯ä»¥æ˜¾å¼çš„å’Œ`uint`ç›¸äº’è½¬æ¢ï¼Œå¹¶ä¼šæ£€æŸ¥è½¬æ¢çš„æ­£æ•´æ•°æ˜¯å¦åœ¨æšä¸¾çš„é•¿åº¦å†…ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼š

```solidity
    // enumå¯ä»¥å’Œuintæ˜¾å¼çš„è½¬æ¢
    function enumToUint() external view returns(uint){
        return uint(action);
    }
```



### åœ¨remixä¸ŠéªŒè¯

- éƒ¨ç½²åˆçº¦åå¯ä»¥æŸ¥çœ‹æ¯ä¸ªç±»å‹çš„å˜é‡å…·ä½“çš„æ•°å€¼ ![2-1.png](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/2-1-90414d7e21f49e75101a07a8a55e602c.png)
- enumå’Œuintè½¬æ¢çš„ç¤ºä¾‹ ![2-2.png](https://www.wtf.academy/assets/images/2-2-6c364618b30e6c498127e2d129f9e7e8.png)![2-3.png](https://www.wtf.academy/assets/images/2-3-d2742673ffbd4df5c230d48a02a2921c.png)

### æ€»ç»“

åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­4ç§å˜é‡ç±»å‹ï¼Œå¹¶è¯¦ç»†ä»‹ç»äº†æ•°å€¼å˜é‡ï¼ˆ`value type`)ä¸­çš„å¸ƒå°”å‹ï¼Œæ•´å‹ï¼Œåœ°å€ï¼Œå®šé•¿å­—èŠ‚æ•°ç»„å’Œæšä¸¾ã€‚ä¹‹åæˆ‘ä»¬ä¼šä»‹ç»å…¶ä»–å‡ ç§ç±»å‹ã€‚



## Solidityä¸­çš„å‡½æ•°

solidityå®˜æ–¹æ–‡æ¡£é‡ŒæŠŠå‡½æ•°å½’åˆ°æ•°å€¼ç±»å‹ï¼Œä½†æˆ‘è§‰å¾—å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥å•ç‹¬åˆ†ä¸€ç±»ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹solidityä¸­å‡½æ•°çš„å½¢å¼ï¼š

```solidity
    function <function name> (<parameter types>) {internal|external|public|private} [pure|view|payable] [returns (<return types>)]
```



çœ‹ç€äº›å¤æ‚ï¼Œå’±ä»¬ä»å‰å¾€åä¸€ä¸ªä¸€ä¸ªçœ‹ï¼ˆæ–¹æ‹¬å·ä¸­çš„æ˜¯å¯å†™å¯ä¸å†™çš„å…³é”®å­—ï¼‰ï¼š

1. `function`ï¼šå£°æ˜å‡½æ•°æ—¶çš„å›ºå®šç”¨æ³•ï¼Œæƒ³å†™å‡½æ•°ï¼Œå°±è¦ä»¥functionå…³é”®å­—å¼€å¤´ã€‚
2. `<function name>`ï¼šå‡½æ•°åã€‚
3. `(<parameter types>)`ï¼šåœ†æ‹¬å·é‡Œå†™å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¦è¾“å…¥åˆ°å‡½æ•°çš„å˜é‡ç±»å‹å’Œåå­—ã€‚
4. `{internal|external|public|private}`ï¼šå‡½æ•°å¯è§æ€§è¯´æ˜ç¬¦ï¼Œä¸€å…±4ç§ã€‚æ²¡æ ‡æ˜å‡½æ•°ç±»å‹çš„ï¼Œé»˜è®¤`internal`ã€‚
   - `public`: å†…éƒ¨å¤–éƒ¨å‡å¯è§ã€‚(ä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼Œpublicå˜é‡ä¼šè‡ªåŠ¨ç”Ÿæˆ `getter`å‡½æ•°ï¼Œç”¨äºæŸ¥è¯¢æ•°å€¼).
   - `private`: åªèƒ½ä»æœ¬åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦ä¹Ÿä¸èƒ½ç”¨ï¼ˆä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼‰ã€‚
   - `external`: åªèƒ½ä»åˆçº¦å¤–éƒ¨è®¿é—®ï¼ˆä½†æ˜¯å¯ä»¥ç”¨`this.f()`æ¥è°ƒç”¨ï¼Œ`f`æ˜¯å‡½æ•°åï¼‰
   - `internal`: åªèƒ½ä»åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦å¯ä»¥ç”¨ï¼ˆä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼‰ã€‚
5. `[pure|view|payable]`ï¼šå†³å®šå‡½æ•°æƒé™/åŠŸèƒ½çš„å…³é”®å­—ã€‚`payable`ï¼ˆå¯æ”¯ä»˜çš„ï¼‰å¾ˆå¥½ç†è§£ï¼Œå¸¦ç€å®ƒçš„å‡½æ•°ï¼Œè¿è¡Œçš„æ—¶å€™å¯ä»¥ç»™åˆçº¦è½¬å…¥`ETH`ã€‚`pure`å’Œ`view`çš„ä»‹ç»è§ä¸‹ä¸€èŠ‚ã€‚
6. `[returns ()]`ï¼šå‡½æ•°è¿”å›çš„å˜é‡ç±»å‹å’Œåç§°ã€‚

### åˆ°åº•ä»€ä¹ˆæ˜¯`Pure`å’Œ`View`ï¼Ÿ

æˆ‘åˆšå¼€å§‹å­¦`solidity`çš„æ—¶å€™ï¼Œä¸€ç›´ä¸ç†è§£`pure`è·Ÿ`view`å…³é”®å­—ï¼Œå› ä¸ºåˆ«çš„è¯­è¨€æ²¡æœ‰ç±»ä¼¼çš„å…³é”®å­—ã€‚`solidity`åŠ å…¥è¿™ä¸¤ä¸ªå…³é”®å­—ï¼Œæˆ‘è®¤ä¸ºæ˜¯å› ä¸º`gas fee`ã€‚åˆçº¦çš„çŠ¶æ€å˜é‡å­˜å‚¨åœ¨é“¾ä¸Šï¼Œ`gas fee`å¾ˆè´µï¼Œå¦‚æœä¸æ”¹å˜é“¾ä¸ŠçŠ¶æ€ï¼Œå°±ä¸ç”¨ä»˜`gas`ã€‚åŒ…å«`pure`è·Ÿ`view`å…³é”®å­—çš„å‡½æ•°æ˜¯ä¸æ”¹å†™é“¾ä¸ŠçŠ¶æ€çš„ï¼Œå› æ­¤ç”¨æˆ·ç›´æ¥è°ƒç”¨ä»–ä»¬æ˜¯ä¸éœ€è¦ä»˜gasçš„ï¼ˆåˆçº¦ä¸­é`pure`/`view`å‡½æ•°è°ƒç”¨å®ƒä»¬åˆ™ä¼šæ”¹å†™é“¾ä¸ŠçŠ¶æ€ï¼Œéœ€è¦ä»˜gasï¼‰ã€‚

åœ¨ä»¥å¤ªåŠä¸­ï¼Œä»¥ä¸‹è¯­å¥è¢«è§†ä¸ºä¿®æ”¹é“¾ä¸ŠçŠ¶æ€ï¼š

1. å†™å…¥çŠ¶æ€å˜é‡ã€‚
2. é‡Šæ”¾äº‹ä»¶ã€‚
3. åˆ›å»ºå…¶ä»–åˆåŒã€‚
4. ä½¿ç”¨`selfdestruct`.
5. é€šè¿‡è°ƒç”¨å‘é€ä»¥å¤ªå¸ã€‚
6. è°ƒç”¨ä»»ä½•æœªæ ‡è®°`view`æˆ–`pure`çš„å‡½æ•°ã€‚
7. ä½¿ç”¨ä½çº§è°ƒç”¨ï¼ˆlow-level callsï¼‰ã€‚
8. ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”æ±‡ç¼–ã€‚

æˆ‘ç”»äº†ä¸€ä¸ªé©¬é‡Œå¥¥æ’ç”»ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ã€‚åœ¨æ’ç”»é‡Œï¼Œæˆ‘æŠŠåˆçº¦ä¸­çš„çŠ¶æ€å˜é‡ï¼ˆå­˜å‚¨åœ¨é“¾ä¸Šï¼‰æ¯”ä½œç¢§æ± å…¬ä¸»ï¼Œä¸‰ç§ä¸åŒçš„è§’è‰²ä»£è¡¨ä¸åŒçš„å…³é”®å­—ã€‚

![WTH is pure and view in solidity?](https://images.mirror-media.xyz/publication-images/1B9kHsTYnDY_QURSWMmPb.png?height=1028&width=1758)

- `pure`ï¼Œä¸­æ–‡æ„æ€æ˜¯â€œçº¯â€ï¼Œåœ¨`solidity`é‡Œç†è§£ä¸ºâ€œçº¯çº¯ç‰›é©¬â€ã€‚åŒ…å«`pure`å…³é”®å­—çš„å‡½æ•°ï¼Œä¸èƒ½è¯»å–ä¹Ÿä¸èƒ½å†™å…¥å­˜å‚¨åœ¨é“¾ä¸Šçš„çŠ¶æ€å˜é‡ã€‚å°±åƒå°æ€ªä¸€æ ·ï¼Œçœ‹ä¸åˆ°ä¹Ÿæ‘¸ä¸åˆ°ç¢§æ± å…¬ä¸»ã€‚
- `view`ï¼Œâ€œçœ‹â€ï¼Œåœ¨`solidity`é‡Œç†è§£ä¸ºâ€œçœ‹å®¢â€ã€‚åŒ…å«`view`å…³é”®å­—çš„å‡½æ•°ï¼Œèƒ½è¯»å–ä½†ä¹Ÿä¸èƒ½å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥ï¼Œèƒ½çœ‹åˆ°ç¢§æ± ï¼Œä½†ç»ˆç©¶æ˜¯çœ‹å®¢ï¼Œä¸èƒ½å…¥æ´æˆ¿ã€‚
- ä¸å†™`pure`ä¹Ÿä¸å†™`view`ï¼Œå‡½æ•°æ—¢å¯ä»¥è¯»å–ä¹Ÿå¯ä»¥å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥é‡Œçš„`boss`ï¼Œå¯ä»¥å¯¹ç¢§æ± å…¬ä¸»ä¸ºæ‰€æ¬²ä¸ºğŸ¶ã€‚

### ä»£ç 

#### 1. pure v.s. view

æˆ‘ä»¬åœ¨åˆçº¦é‡Œå®šä¹‰ä¸€ä¸ªçŠ¶æ€å˜é‡ `number = 5`ã€‚

```solidity
    // SPDX-License-Identifier: MIT
    pragma solidity ^0.8.4;
    contract FunctionTypes{
        uint256 public number = 5;
```



å®šä¹‰ä¸€ä¸ª`add()`å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡ç»™`number + 1`ã€‚

```solidity
    // é»˜è®¤
    function add() external{
        number = number + 1;
    }
```



å¦‚æœ`add()`åŒ…å«äº†`pure`å…³é”®å­—ï¼Œä¾‹å¦‚ `function add() pure external`ï¼Œå°±ä¼šæŠ¥é”™ã€‚å› ä¸º`pure`ï¼ˆçº¯çº¯ç‰›é©¬ï¼‰æ˜¯ä¸é…è¯»å–åˆçº¦é‡Œçš„çŠ¶æ€å˜é‡çš„ï¼Œæ›´ä¸é…æ”¹å†™ã€‚é‚£`pure`å‡½æ•°èƒ½åšäº›ä»€ä¹ˆï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ç»™å‡½æ•°ä¼ é€’ä¸€ä¸ªå‚æ•° `_number`ï¼Œç„¶åè®©ä»–è¿”å› `_number+1`ã€‚

```solidity
    // pure: çº¯çº¯ç‰›é©¬
    function addPure(uint256 _number) external pure returns(uint256 new_number){
        new_number = _number+1;
    }
```



**Example:** ![3-3.png](https://www.wtf.academy/assets/images/3-3-5b5c10d460fd4d9721009d3a94a44ebb.png)

å¦‚æœ`add()`åŒ…å«`view`ï¼Œæ¯”å¦‚`function add() view external`ï¼Œä¹Ÿä¼šæŠ¥é”™ã€‚å› ä¸º`view`èƒ½è¯»å–ï¼Œä½†ä¸èƒ½å¤Ÿæ”¹å†™çŠ¶æ€å˜é‡ã€‚å¯ä»¥ç¨å¾®æ”¹å†™ä¸‹æ–¹ç¨‹ï¼Œè®©ä»–ä¸æ”¹å†™`number`ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å˜é‡ã€‚

```solidity
    // view: çœ‹å®¢
    function addView() external view returns(uint256 new_number) {
        new_number = number + 1;
    }
```



**Example:** ![3-4.png](https://www.wtf.academy/assets/images/3-4-049b8caacda74a086158981824991cb3.png)

#### 2. internal v.s. external

```solidity
    // internal: å†…éƒ¨
    function minus() internal {
        number = number - 1;
    }

    // åˆçº¦å†…çš„å‡½æ•°å¯ä»¥è°ƒç”¨å†…éƒ¨å‡½æ•°
    function minusCall() external {
        minus();
    }
```



æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`internal`çš„`minus()`å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨ä½¿å¾—`number`å˜é‡å‡1ã€‚ç”±äºæ˜¯`internal`ï¼Œåªèƒ½ç”±åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œè€Œå¤–éƒ¨ä¸èƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å†å®šä¹‰ä¸€ä¸ª`external`çš„`minusCall()`å‡½æ•°ï¼Œæ¥é—´æ¥è°ƒç”¨å†…éƒ¨çš„`minus()`ã€‚ **Example:** ![3-1.png](https://www.wtf.academy/assets/images/3-1-7ddf1b1c7336bbdd36e3a1fc105b7422.png)

#### 3. payable

```solidity
    // payable: é€’é’±ï¼Œèƒ½ç»™åˆçº¦æ”¯ä»˜ethçš„å‡½æ•°
    function minusPayable() external payable returns(uint256 balance) {
        minus();    
        balance = address(this).balance;
    }
```



æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`external payable`çš„`minusPayable()`å‡½æ•°ï¼Œé—´æ¥çš„è°ƒç”¨`minus()`ï¼Œå¹¶ä¸”è¿”å›åˆçº¦é‡Œçš„`ETH`ä½™é¢ï¼ˆ`this`å…³é”®å­—å¯ä»¥è®©æˆ‘ä»¬å¼•ç”¨åˆçº¦åœ°å€)ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨`minusPayable()`æ—¶ï¼Œå¾€åˆçº¦é‡Œè½¬å…¥1ä¸ª`ETH`ã€‚

![img](https://images.mirror-media.xyz/publication-images/ETDPN8myq7jFfAL8CUAFt.png?height=148&width=588)

æˆ‘ä»¬å¯ä»¥åœ¨è¿”å›çš„ä¿¡æ¯ä¸­çœ‹åˆ°ï¼Œåˆçº¦çš„ä½™é¢æ˜¯1 ETHã€‚

![img](https://images.mirror-media.xyz/publication-images/nGZ2pz0MvzgXuKrENJPYf.png?height=128&width=1130)

**Example:** ![3-2.png](https://www.wtf.academy/assets/images/3-2-e1be980c21311dc80f6233dac763fd89.png)

### æ€»ç»“

åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­çš„å‡½æ•°ç±»å‹ï¼Œæ¯”è¾ƒéš¾ç†è§£çš„æ˜¯`pure`å’Œ`view`ï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­æ²¡å‡ºç°è¿‡ã€‚`solidity`å¼•å…¥`pure`å’Œ`view`å…³é”®å­—ä¸»è¦æ˜¯ä¸ºäº†èŠ‚çœ`gas`å’Œæ§åˆ¶å‡½æ•°æƒé™ï¼šå¦‚æœç”¨æˆ·ç›´æ¥è°ƒç”¨`pure`/`view`æ–¹ç¨‹æ˜¯ä¸æ¶ˆè€—`gas`çš„ï¼ˆåˆçº¦ä¸­é`pure`/`view`å‡½æ•°è°ƒç”¨å®ƒä»¬åˆ™ä¼šæ”¹å†™é“¾ä¸ŠçŠ¶æ€ï¼Œéœ€è¦ä»˜gasï¼‰ã€‚



## å‡½æ•°è¾“å‡º

æˆ‘ä»¬å°†ä»‹ç»`Solidity`å‡½æ•°è¾“å‡ºï¼ŒåŒ…æ‹¬ï¼šè¿”å›å¤šç§å˜é‡ï¼Œå‘½åå¼è¿”å›ï¼Œä»¥åŠåˆ©ç”¨è§£æ„å¼èµ‹å€¼è¯»å–å…¨éƒ¨å’Œéƒ¨åˆ†è¿”å›å€¼ã€‚

### è¿”å›å€¼ returnå’Œreturns

`Solidity`æœ‰ä¸¤ä¸ªå…³é”®å­—ä¸å‡½æ•°è¾“å‡ºç›¸å…³ï¼š`return`å’Œ`returns`ï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š

- `returns`åŠ åœ¨å‡½æ•°ååé¢ï¼Œç”¨äºå£°æ˜è¿”å›çš„å˜é‡ç±»å‹åŠå˜é‡åï¼›
- `return`ç”¨äºå‡½æ•°ä¸»ä½“ä¸­ï¼Œè¿”å›æŒ‡å®šçš„å˜é‡ã€‚

```solidity
    // è¿”å›å¤šä¸ªå˜é‡
    function returnMultiple() public pure returns(uint256, bool, uint256[3] memory){
            return(1, true, [uint256(1),2,5]);
        }
```



ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†`returnMultiple()`å‡½æ•°å°†æœ‰å¤šä¸ªè¾“å‡ºï¼š`returns(uint256, bool, uint256[3] memory)`ï¼Œæ¥ç€æˆ‘ä»¬åœ¨å‡½æ•°ä¸»ä½“ä¸­ç”¨`return(1, true, [uint256(1),2,5])`ç¡®å®šäº†è¿”å›å€¼ã€‚

### å‘½åå¼è¿”å›

æˆ‘ä»¬å¯ä»¥åœ¨`returns`ä¸­æ ‡æ˜è¿”å›å˜é‡çš„åç§°ï¼Œè¿™æ ·`solidity`ä¼šè‡ªåŠ¨ç»™è¿™äº›å˜é‡åˆå§‹åŒ–ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿”å›è¿™äº›å‡½æ•°çš„å€¼ï¼Œä¸éœ€è¦åŠ `return`ã€‚

```solidity
    // å‘½åå¼è¿”å›
    function returnNamed() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array){
        _number = 2;
        _bool = false; 
        _array = [uint256(3),2,1];
    }
```



åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”¨`returns(uint256 _number, bool _bool, uint256[3] memory _array)`å£°æ˜äº†è¿”å›å˜é‡ç±»å‹ä»¥åŠå˜é‡åã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ä¸»ä½“ä¸­åªéœ€è¦ç»™å˜é‡`_number`ï¼Œ`_bool`å’Œ`_array`èµ‹å€¼å°±å¯ä»¥è‡ªåŠ¨è¿”å›äº†ã€‚

å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å‘½åå¼è¿”å›ä¸­ç”¨`return`æ¥è¿”å›å˜é‡ï¼š

```solidity
    // å‘½åå¼è¿”å›ï¼Œä¾ç„¶æ”¯æŒreturn
    function returnNamed2() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array){
        return(1, true, [uint256(1),2,5]);
    }
```



### è§£æ„å¼èµ‹å€¼

`solidity`ä½¿ç”¨è§£æ„å¼èµ‹å€¼çš„è§„åˆ™ï¼Œæ”¯æŒè¯»å–å‡½æ•°çš„å…¨éƒ¨æˆ–éƒ¨åˆ†è¿”å›å€¼ã€‚

- è¯»å–æ‰€æœ‰è¿”å›å€¼ï¼šå£°æ˜å˜é‡ï¼Œå¹¶ä¸”å°†è¦èµ‹å€¼çš„å˜é‡ç”¨`,`éš”å¼€ï¼ŒæŒ‰é¡ºåºæ’åˆ—ã€‚

```solidity
        uint256 _number;
        bool _bool;
        uint256[3] memory _array;
        (_number, _bool, _array) = returnNamed();
```



- è¯»å–éƒ¨åˆ†è¿”å›å€¼ï¼šå£°æ˜è¦è¯»å–çš„è¿”å›å€¼å¯¹åº”çš„å˜é‡ï¼Œä¸è¯»å–çš„ç•™ç©ºã€‚ä¸‹é¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åªè¯»å–`_bool`ï¼Œè€Œä¸è¯»å–è¿”å›çš„`_number`å’Œ`_array`ï¼š

```solidity
        (, _bool2, ) = returnNamed();
```



### åœ¨remixä¸ŠéªŒè¯

- éƒ¨ç½²åˆçº¦åæŸ¥çœ‹ä¸‰ç§è¿”å›æ–¹å¼çš„ç»“æœ ![img](https://www.wtf.academy/assets/images/4-1-3c115fdc5afcb11e3f9eb51b8e2abbd8.png)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»å‡½æ•°çš„è¿”å›å€¼`return`å’Œ`returns`ï¼ŒåŒ…æ‹¬ï¼šè¿”å›å¤šç§å˜é‡ï¼Œå‘½åå¼è¿”å›ï¼Œä»¥åŠåˆ©ç”¨è§£æ„å¼èµ‹å€¼è¯»å–å…¨éƒ¨å’Œéƒ¨åˆ†è¿”å›å€¼ã€‚



## call() å‡½æ•°

> æœ¬æ–‡ä»‹ç»äº† Solidity ä¸­çš„ `call()` å‡½æ•°åŠå…¶ä½¿ç”¨ã€‚

call æ˜¯ä¸å…¶ä»–åˆçº¦äº¤äº’çš„ä½çº§å‡½æ•°ã€‚

å½“æ‚¨åªæ˜¯é€šè¿‡è°ƒç”¨å›é€€å‡½æ•°å‘é€ Ether æ—¶ï¼Œè¿™æ˜¯æ¨èä½¿ç”¨çš„æ–¹æ³•ã€‚

ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯è°ƒç”¨ç°æœ‰å‡½æ•°çš„æ¨èæ–¹å¼ã€‚

ä¸æ¨èä½çº§è°ƒç”¨çš„å‡ ä¸ªåŸå› 

- è¿˜åŸä¸ä¼šå†’æ³¡
- ç»•è¿‡ç±»å‹æ£€æŸ¥
- å‡½æ•°å­˜åœ¨æ€§æ£€æŸ¥è¢«çœç•¥

### ç¤ºä¾‹

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Receiver {
    event Received(address caller, uint amount, string message);

    fallback() external payable {
        emit Received(msg.sender, msg.value, "Fallback was called");
    }

    function foo(string memory _message, uint _x) public payable returns (uint) {
        emit Received(msg.sender, msg.value, _message);

        return _x + 1;
    }
}

contract Caller {
    event Response(bool success, bytes data);

    // Let's imagine that contract Caller does not have the source code for the
    // contract Receiver, but we do know the address of contract Receiver and the function to call.
    function testCallFoo(address payable _addr) public payable {
        // You can send ether and specify a custom gas amount
        (bool success, bytes memory data) = _addr.call{value: msg.value, gas: 5000}(
            abi.encodeWithSignature("foo(string,uint256)", "call foo", 123)
        );

        emit Response(success, data);
    }

    // Calling a function that does not exist triggers the fallback function.
    function testCallDoesNotExist(address payable _addr) public payable {
        (bool success, bytes memory data) = _addr.call{value: msg.value}(
            abi.encodeWithSignature("doesNotExist()")
        );

        emit Response(success, data);
    }
}
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ™ºèƒ½åˆçº¦ `Caller` å’Œ `Callee`ã€‚`Caller` åˆçº¦åŒ…å«ä¸€ä¸ªåä¸º `testCall()` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å‘æŒ‡å®šåœ°å€å‘é€ 1 wei çš„ä»¥å¤ªå¸ï¼Œå¹¶è°ƒç”¨ `Callee` åˆçº¦ä¸­çš„ `foo()` å‡½æ•°ã€‚å½“ `foo()` å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªç¼–ç åçš„å­—ç¬¦ä¸²å’Œæ•°å­—ã€‚

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `call()` å‡½æ•°æ¥å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä½¿ç”¨ `abi.encodeWithSignature()` å‡½æ•°å¯¹å‚æ•°è¿›è¡Œç¼–ç ã€‚

è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ä»å¤šé‡ç­¾åé’±åŒ…å‘é€äº¤æ˜“çš„åˆåŒï¼š

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract TestContract {
    uint public i;

    function callMe(uint j) public {
        i += j;
    }

    function getData() public pure returns (bytes memory) {
        return abi.encodeWithSignature("callMe(uint256)", 123);
    }
}
```



### è¯¦è§£

#### `call()` å‡½æ•°æ¦‚è¿°

`call()` æ˜¯ Solidity ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå‡½æ•°ï¼Œç”¨äºè°ƒç”¨å…¶ä»–åˆçº¦ä¸­çš„å‡½æ•°ã€‚åœ¨è°ƒç”¨ `call()` å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æä¾›è¦è°ƒç”¨å‡½æ•°çš„åœ°å€ã€ä»¥å¤ªå¸æ•°é‡å’Œå‚æ•°ã€‚`call()` å‡½æ•°å°†è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼å’Œä¸€ä¸ª `bytes` ç±»å‹çš„æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºè°ƒç”¨æ˜¯å¦æˆåŠŸä»¥åŠåŒ…å«è¿”å›å€¼çš„æ•°æ®ã€‚

#### å‡½æ•°ç¼–ç 

åœ¨ä½¿ç”¨ `call()` å‡½æ•°è°ƒç”¨å…¶ä»–åˆçº¦ä¸­çš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å‡½æ•°å‚æ•°è¿›è¡Œç¼–ç ã€‚Solidity æä¾›äº†å¤šç§ç¼–ç å‡½æ•°ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°ç±»å‹æ¥é€‰æ‹©ä½¿ç”¨é€‚å½“çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `abi.encodeWithSignature()` å‡½æ•°å¯¹å­—ç¬¦ä¸²å’Œæ•°å­—å‚æ•°è¿›è¡Œç¼–ç ã€‚

```solidity
bytes memory data = abi.encodeWithSignature("foo(string,uint256)", "hello", 123);
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `abi.encodeWithSignature()` å‡½æ•°å¯¹ `"hello"` å’Œ `123` è¿›è¡Œç¼–ç ï¼Œå¹¶å°†ç¼–ç åçš„å­—èŠ‚æ•°ç»„å­˜å‚¨åœ¨åä¸º `data` çš„å˜é‡ä¸­ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨é”™è¯¯çš„ç¼–ç æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´è°ƒç”¨å¤±è´¥æˆ–äº§ç”Ÿé”™è¯¯çš„è¿”å›å€¼ã€‚

#### `address payable` ç±»å‹

åœ¨ Solidity ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `address payable` ç±»å‹æ¥è¡¨ç¤ºä¸€ä¸ªæ—¢å¯ä»¥æ¥æ”¶ä»¥å¤ªå¸åˆå¯ä»¥å‘é€ä»¥å¤ªå¸çš„åœ°å€ã€‚

```solidity
address payable myAddress = payable(0x123);
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ°å€ `0x123` è½¬æ¢ä¸º `address payable` ç±»å‹ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨åä¸º `myAddress` çš„å˜é‡ä¸­ã€‚

è¯·æ³¨æ„ï¼Œåªæœ‰å…·æœ‰ `payable` å‡½æ•°çš„åœ°å€æ‰èƒ½è¢«è½¬æ¢ä¸º `address payable` ç±»å‹ã€‚

### æ€»ç»“

é€šè¿‡ä½¿ç”¨ `call()` å‡½æ•°å’Œæ­£ç¡®çš„å‡½æ•°å‚æ•°ç¼–ç æ–¹å¼ï¼ŒSolidity å¯ä»¥æ–¹ä¾¿åœ°å¤„ç†æ™ºèƒ½åˆçº¦ä¹‹é—´çš„å‡½æ•°è°ƒç”¨ã€‚ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥æ‰§è¡Œå¤æ‚çš„é€»è¾‘æˆ–è½¬ç§»åœºæ™¯ï¼Œå¹¶ç¡®ä¿æ­£ç¡®åœ°å¤„ç†è¿”å›å€¼å’Œé”™è¯¯æƒ…å†µã€‚é€šè¿‡ä½¿ç”¨ `address payable` ç±»å‹ï¼Œç¨‹åºå‘˜å¯ä»¥è½»æ¾åœ°å®ç°ä¸å…¶ä»–åˆçº¦äº¤äº’å¹¶å¤„ç†ä»¥å¤ªå¸è½¬ç§»ã€‚



## delegatecall() å‡½æ•°

> æœ¬æ–‡ä»‹ç»äº† Solidity ä¸­çš„ `delegatecall()` å‡½æ•°åŠå…¶ä½¿ç”¨ã€‚

delegatecall æ˜¯ç±»ä¼¼äºè°ƒç”¨çš„ä½çº§å‡½æ•°ã€‚

å½“åˆçº¦Aå¯¹åˆçº¦Bæ‰§è¡Œdelegatecallæ—¶ï¼Œæ‰§è¡ŒBçš„ä»£ç  ä¸åˆçº¦ A çš„å­˜å‚¨ï¼Œmsg.sender å’Œ msg.valueã€‚

### ç¤ºä¾‹

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

// NOTE: Deploy this contract first
contract B {
    // NOTE: storage layout must be the same as contract A
    uint public num;
    address public sender;
    uint public value;

    function setVars(uint _num) public payable {
        num = _num;
        sender = msg.sender;
        value = msg.value;
    }
}

contract A {
    uint public num;
    address public sender;
    uint public value;

    function setVars(address _contract, uint _num) public payable {
        // A's storage is set, B is not modified.
        (bool success, bytes memory data) = _contract.delegatecall(
            abi.encodeWithSignature("setVars(uint256)", _num)
        );
    }
}
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ™ºèƒ½åˆçº¦ `A` å’Œ `B`ã€‚`A` åˆçº¦åŒ…å«ä¸€ä¸ªåä¸º `foo()` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªæ•°å­—å‚æ•°å¹¶è¿”å›å®ƒä»¬çš„æ€»å’Œã€‚`B` åˆçº¦åŒ…å«ä¸€ä¸ªåä¸º `bar()` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å‘å¦ä¸€ä¸ªåˆçº¦åœ°å€å‘é€ä¸€ä¸ª `delegatecall()`ï¼Œå¹¶å°† `foo()` å‡½æ•°çš„è¾“å…¥å‚æ•° `_i` å’Œ `_j` ä½œä¸ºå‚æ•°ä¼ é€’ã€‚`bar()` å‡½æ•°å°†è¿”å› `foo()` å‡½æ•°è¿”å›å€¼çš„æ€»å’Œã€‚

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `delegatecall()` å‡½æ•°æ¥å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä½¿ç”¨ `abi.encodeWithSignature()` å‡½æ•°å¯¹å‚æ•°è¿›è¡Œç¼–ç ã€‚

### è¯¦è§£

#### `delegatecall()` å‡½æ•°æ¦‚è¿°

`delegatecall()` æ˜¯ Solidity ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå‡½æ•°ï¼Œç”¨äºåœ¨å½“å‰åˆçº¦çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œå…¶ä»–åˆçº¦çš„ä»£ç ã€‚ä¸ `call()` ä¸åŒï¼Œ`delegatecall()` å°†ä½¿ç”¨å½“å‰åˆçº¦çš„å­˜å‚¨å™¨ã€çŠ¶æ€å˜é‡å’Œ ETH ä½™é¢ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†å¦ä¸€ä¸ªåˆçº¦çš„ä»£ç è§†ä¸ºå½“å‰åˆçº¦çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å½“å‰åˆçº¦çš„æ‰€æœ‰èµ„æºã€‚

#### å‡½æ•°ç¼–ç 

åœ¨ä½¿ç”¨ `delegatecall()` å‡½æ•°è°ƒç”¨å…¶ä»–åˆçº¦ä¸­çš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å‡½æ•°å‚æ•°è¿›è¡Œç¼–ç ã€‚Solidity æä¾›äº†å¤šç§ç¼–ç å‡½æ•°ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„å‚æ•°ç±»å‹æ¥é€‰æ‹©ä½¿ç”¨é€‚å½“çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `abi.encodeWithSignature()` å‡½æ•°å¯¹æ•°å­—å‚æ•°è¿›è¡Œç¼–ç ã€‚

```solidity
bytes memory payload = abi.encodeWithSignature("foo(uint256,uint256)", _i, _j);
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `abi.encodeWithSignature()` å‡½æ•°å¯¹ `_i` å’Œ `_j` è¿›è¡Œç¼–ç ï¼Œå¹¶å°†ç¼–ç åçš„å­—èŠ‚æ•°ç»„å­˜å‚¨åœ¨åä¸º `payload` çš„å˜é‡ä¸­ã€‚

è¯·æ³¨æ„ï¼Œä½¿ç”¨é”™è¯¯çš„ç¼–ç æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´è°ƒç”¨å¤±è´¥æˆ–äº§ç”Ÿé”™è¯¯çš„è¿”å›å€¼ã€‚

#### `require()` å‡½æ•°

ä½¿ç”¨ `require()` å‡½æ•°æ¥æ£€æŸ¥æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå¹¶åœ¨æ¡ä»¶ä¸æ»¡è¶³æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚

```solidity
require(success);
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `require()` å‡½æ•°æ¥æ£€æŸ¥ `delegatecall()` æ˜¯å¦æˆåŠŸï¼Œå¹¶åœ¨ä¸æˆåŠŸæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚

### æ€»ç»“

é€šè¿‡ä½¿ç”¨ `delegatecall()` å‡½æ•°å’Œæ­£ç¡®çš„å‡½æ•°å‚æ•°ç¼–ç æ–¹å¼ï¼ŒSolidity å¯ä»¥æ–¹ä¾¿åœ°å¤„ç†æ™ºèƒ½åˆçº¦ä¹‹é—´çš„ä»£ç å…±äº«ã€‚ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥æ‰§è¡Œå¤æ‚çš„é€»è¾‘æˆ–è½¬ç§»åœºæ™¯ï¼Œå¹¶ç¡®ä¿æ­£ç¡®åœ°å¤„ç†è¿”å›å€¼å’Œé”™è¯¯æƒ…å†µã€‚é€šè¿‡ä½¿ç”¨ `require()` å‡½æ•°ï¼Œç¨‹åºå‘˜å¯ä»¥è½»æ¾åœ°æ£€æŸ¥æ¡ä»¶æ˜¯å¦æ»¡è¶³ï¼Œå¹¶åœ¨å¿…è¦æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚



â€‹		

## payable å‡½æ•°

> æœ¬æ–‡ä»‹ç»äº† Solidity ä¸­çš„ `payable` å‡½æ•°ä¿®é¥°ç¬¦ï¼Œå®ƒå…è®¸åˆçº¦æ¥æ”¶ä»¥å¤ªå¸ã€‚

å£°æ˜ä¸º payable çš„å‡½æ•°å’Œåœ°å€å¯ä»¥å°†ä»¥å¤ªå¸æ¥æ”¶åˆ°åˆçº¦ä¸­ã€‚

### ç¤ºä¾‹

```solidity
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.17;

contract Payable {
    // Payableåœ°å€å¯ä»¥æ¥æ”¶ä»¥å¤ªå¸
    address payable public owner;

    // Payableæ„é€ å‡½æ•°å¯ä»¥æ¥æ”¶ä»¥å¤ªå¸
    constructor() payable {
        owner = payable(msg.sender);
    }

    // å­˜å…¥ä»¥å¤ªå¸åˆ°æ™ºèƒ½åˆçº¦çš„å‡½æ•°ã€‚
    // ä¸ä¸€äº›ä»¥å¤ªå¸ä¸€èµ·è°ƒç”¨æ­¤å‡½æ•°ã€‚
    // æ™ºèƒ½åˆçº¦çš„ä½™é¢å°†è‡ªåŠ¨æ›´æ–°ã€‚
    function deposit() public payable {}

    // ä¸ä¸€äº›ä»¥å¤ªå¸ä¸€èµ·è°ƒç”¨æ­¤å‡½æ•°ã€‚
    // ç”±äºæ­¤å‡½æ•°ä¸å¯æ”¯ä»˜ï¼Œå› æ­¤è¯¥å‡½æ•°å°†æŠ›å‡ºé”™è¯¯ã€‚
    function notPayable() public {}

    // ä»æ™ºèƒ½åˆçº¦ä¸­æå–æ‰€æœ‰ä»¥å¤ªå¸çš„å‡½æ•°ã€‚
    function withdraw() public {
        // è·å–å­˜å‚¨åœ¨æ­¤åˆçº¦ä¸­çš„ä»¥å¤ªå¸æ•°é‡
        uint amount = address(this).balance;

        // å°†æ‰€æœ‰ä»¥å¤ªå¸å‘é€ç»™æ‹¥æœ‰è€…
        // ç”±äºæ‰€æœ‰è€…çš„åœ°å€æ˜¯å¯æ”¯ä»˜çš„ï¼Œå› æ­¤å…¶å¯ä»¥æ¥æ”¶ä»¥å¤ªå¸
        (bool success, ) = owner.call{value: amount}("");
        require(success, "Failed to send Ether");
    }

    // å°†ä»¥å¤ªå¸ä»æ­¤åˆçº¦è½¬ç§»åˆ°è¾“å…¥åœ°å€çš„å‡½æ•°
    function transfer(address payable _to, uint _amount) public {
        // æ³¨æ„ï¼Œâ€œtoâ€è¢«å£°æ˜ä¸ºpayable
        (bool success, ) = _to.call{value: _amount}("");
        require(success, "Failed to send Ether");
    }
}
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º `ReceiveEther` çš„åˆçº¦ï¼Œå¹¶ä½¿ç”¨ `receive()` å‡½æ•°ä½œä¸ºå…¶é»˜è®¤å‡½æ•°ã€‚å¦‚æœæœ‰äººå‘è¯¥åˆçº¦å‘é€ä»¥å¤ªå¸ï¼Œåˆ™è¯¥å‡½æ•°å°†è¢«è°ƒç”¨ã€‚

æˆ‘ä»¬è¿˜ä½¿ç”¨äº† `payable` ä¿®é¥°ç¬¦æ¥æ ‡è¯† `sendEther()` å‡½æ•°ï¼Œè¯¥å‡½æ•°å…è®¸å‘åˆçº¦å‘é€ä»¥å¤ªå¸ã€‚é€šè¿‡ `getBalance()` å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è·å–è¯¥åˆçº¦çš„ä½™é¢ã€‚

### è¯¦è§£

#### `receive()` å‡½æ•°

å½“æœ‰äººå‘åˆçº¦å‘é€ä»¥å¤ªå¸æ—¶ï¼Œé»˜è®¤å‡½æ•°å°†è¢«è°ƒç”¨ã€‚é»˜è®¤å‡½æ•°æ˜¯æ²¡æœ‰åç§°å’Œå‚æ•°çš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```solidity
receive() external payable {
    // å¤„ç†æ¥æ”¶åˆ°çš„ä»¥å¤ªå¸
}
```



è¯·æ³¨æ„ï¼Œå¦‚æœåˆçº¦æ²¡æœ‰å®šä¹‰ `receive()` å‡½æ•°ï¼Œå¹¶ä¸”æœ‰äººå‘å…¶å‘é€ä»¥å¤ªå¸ï¼Œåˆ™å°†ä¼šæŠ›å‡ºå¼‚å¸¸å¹¶è¿”è¿˜æ‰€æœ‰çš„ä»¥å¤ªå¸ã€‚

#### `payable` ä¿®é¥°ç¬¦

ä½¿ç”¨ `payable` ä¿®é¥°ç¬¦ä¿®é¥°ä¸€ä¸ªå‡½æ•°å¯ä»¥ä½¿è¯¥å‡½æ•°æ¥æ”¶ä»¥å¤ªå¸ã€‚

```solidity
function myFunction() external payable {
    // å¤„ç†æ¥æ”¶åˆ°çš„ä»¥å¤ªå¸
}
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `payable` ä¿®é¥°ç¬¦æ¥æ ‡è¯† `myFunction()` å‡½æ•°ï¼Œè¯¥å‡½æ•°å…è®¸æ¥æ”¶ä»¥å¤ªå¸ã€‚

è¯·æ³¨æ„ï¼Œåªæœ‰å…·æœ‰ `payable` ä¿®é¥°ç¬¦çš„å‡½æ•°æ‰èƒ½æ¥æ”¶ä»¥å¤ªå¸ã€‚

#### åˆçº¦ä½™é¢

è¦è·å–åˆçº¦çš„å½“å‰ä½™é¢ï¼Œå¯ä»¥ä½¿ç”¨ `address(this).balance`ã€‚

```solidity
function getBalance() external view returns (uint) {
    return address(this).balance;
}
```



åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º `getBalance()` çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›è¯¥åˆçº¦çš„ä½™é¢ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨ `view` å…³é”®å­—æ¥æ ‡è¯†è¯¥å‡½æ•°ä¸ä¼šä¿®æ”¹åˆçº¦çŠ¶æ€ã€‚

### æ€»ç»“

é€šè¿‡ä½¿ç”¨ `payable` ä¿®é¥°ç¬¦ä»¥åŠé»˜è®¤å‡½æ•°ï¼ŒSolidity å¯ä»¥æ–¹ä¾¿åœ°å¤„ç†åˆçº¦æ¥æ”¶ä»¥å¤ªå¸çš„æƒ…å½¢ã€‚ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·æ¥æ‰§è¡Œå¤æ‚çš„è½¬è´¦é€»è¾‘æˆ–æ”¯ä»˜åœºæ™¯ï¼Œå¹¶åœ¨éœ€è¦æ—¶è·å–å½“å‰åˆçº¦çš„ä½™é¢ä¿¡æ¯ã€‚





## Solidityä¸­çš„å¼•ç”¨ç±»å‹

**å¼•ç”¨ç±»å‹(Reference Type)**ï¼šåŒ…æ‹¬æ•°ç»„ï¼ˆ`array`ï¼‰ï¼Œç»“æ„ä½“ï¼ˆ`struct`ï¼‰å’Œæ˜ å°„ï¼ˆ`mapping`ï¼‰ï¼Œè¿™ç±»å˜é‡å ç©ºé—´å¤§ï¼Œèµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ã€‚ç”±äºè¿™ç±»å˜é‡æ¯”è¾ƒå¤æ‚ï¼Œå ç”¨å­˜å‚¨ç©ºé—´å¤§ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶å¿…é¡»è¦å£°æ˜æ•°æ®å­˜å‚¨çš„ä½ç½®ã€‚

### æ•°æ®ä½ç½®

solidityæ•°æ®å­˜å‚¨ä½ç½®æœ‰ä¸‰ç±»ï¼š`storage`ï¼Œ`memory`å’Œ`calldata`ã€‚ä¸åŒå­˜å‚¨ä½ç½®çš„`gas`æˆæœ¬ä¸åŒã€‚`storage`ç±»å‹çš„æ•°æ®å­˜åœ¨é“¾ä¸Šï¼Œç±»ä¼¼è®¡ç®—æœºçš„ç¡¬ç›˜ï¼Œæ¶ˆè€—`gas`å¤šï¼›`memory`å’Œ`calldata`ç±»å‹çš„ä¸´æ—¶å­˜åœ¨å†…å­˜é‡Œï¼Œæ¶ˆè€—`gas`å°‘ã€‚å¤§è‡´ç”¨æ³•ï¼š

1. `storage`ï¼šåˆçº¦é‡Œçš„çŠ¶æ€å˜é‡é»˜è®¤éƒ½æ˜¯`storage`ï¼Œå­˜å‚¨åœ¨é“¾ä¸Šã€‚
2. `memory`ï¼šå‡½æ•°é‡Œçš„å‚æ•°å’Œä¸´æ—¶å˜é‡ä¸€èˆ¬ç”¨`memory`ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ã€‚
3. `calldata`ï¼šå’Œ`memory`ç±»ä¼¼ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ã€‚ä¸`memory`çš„ä¸åŒç‚¹åœ¨äº`calldata`å˜é‡ä¸èƒ½ä¿®æ”¹ï¼ˆ`immutable`ï¼‰ï¼Œä¸€èˆ¬ç”¨äºå‡½æ•°çš„å‚æ•°ã€‚ä¾‹å­ï¼š

```solidity
    function fCalldata(uint[] calldata _x) public pure returns(uint[] calldata){
        //å‚æ•°ä¸ºcalldataæ•°ç»„ï¼Œä¸èƒ½è¢«ä¿®æ”¹
        // _x[0] = 0 //è¿™æ ·ä¿®æ”¹ä¼šæŠ¥é”™
        return(_x);
    }
```



**Example:** ![5-1.png](https://www.wtf.academy/assets/images/5-1-9d00a21842c77b3911aaf419f67ad691.png)

### æ•°æ®ä½ç½®å’Œèµ‹å€¼è§„åˆ™

åœ¨ä¸åŒå­˜å‚¨ç±»å‹ç›¸äº’èµ‹å€¼æ—¶å€™ï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿç‹¬ç«‹çš„å‰¯æœ¬ï¼ˆä¿®æ”¹æ–°å˜é‡ä¸ä¼šå½±å“åŸå˜é‡ï¼‰ï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿå¼•ç”¨ï¼ˆä¿®æ”¹æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ï¼‰ã€‚è§„åˆ™å¦‚ä¸‹ï¼š

1. `storage`ï¼ˆåˆçº¦çš„çŠ¶æ€å˜é‡ï¼‰èµ‹å€¼ç»™æœ¬åœ°`storage`ï¼ˆå‡½æ•°é‡Œçš„ï¼‰æ—¶å€™ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ã€‚ä¾‹å­ï¼š

```solidity
    uint[] x = [1,2,3]; // çŠ¶æ€å˜é‡ï¼šæ•°ç»„ x

    function fStorage() public{
        //å£°æ˜ä¸€ä¸ªstorageçš„å˜é‡ xStorageï¼ŒæŒ‡å‘xã€‚ä¿®æ”¹xStorageä¹Ÿä¼šå½±å“x
        uint[] storage xStorage = x;
        xStorage[0] = 100;
    }
```



**Example:** ![5-2.png](https://www.wtf.academy/assets/images/5-2-91bae5b0b86b0e55210cac541a6edee5.png)

1. `storage`èµ‹å€¼ç»™`memory`ï¼Œä¼šåˆ›å»ºç‹¬ç«‹çš„å¤æœ¬ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¸ä¼šå½±å“å¦ä¸€ä¸ªï¼›åä¹‹äº¦ç„¶ã€‚ä¾‹å­ï¼š

```solidity
    uint[] x = [1,2,3]; // çŠ¶æ€å˜é‡ï¼šæ•°ç»„ x
    
    function fMemory() public view{
        //å£°æ˜ä¸€ä¸ªMemoryçš„å˜é‡xMemoryï¼Œå¤åˆ¶xã€‚ä¿®æ”¹xMemoryä¸ä¼šå½±å“x
        uint[] memory xMemory = x;
        xMemory[0] = 100;
        xMemory[1] = 200;
        uint[] memory xMemory2 = x;
        xMemory2[0] = 300;
    }
```



**Example:** ![5-3.png](https://www.wtf.academy/assets/images/5-3-979f3cbffbbe20ff5df5c143384610e4.png)

1. `memory`èµ‹å€¼ç»™`memory`ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ã€‚
2. å…¶ä»–æƒ…å†µï¼Œå˜é‡èµ‹å€¼ç»™`storage`ï¼Œä¼šåˆ›å»ºç‹¬ç«‹çš„å¤æœ¬ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¸ä¼šå½±å“å¦ä¸€ä¸ªã€‚

### å˜é‡çš„ä½œç”¨åŸŸ

`Solidity`ä¸­å˜é‡æŒ‰ä½œç”¨åŸŸåˆ’åˆ†æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯çŠ¶æ€å˜é‡ï¼ˆstate variableï¼‰ï¼Œå±€éƒ¨å˜é‡ï¼ˆlocal variableï¼‰å’Œå…¨å±€å˜é‡(global variable)

#### 1. çŠ¶æ€å˜é‡

çŠ¶æ€å˜é‡æ˜¯æ•°æ®å­˜å‚¨åœ¨é“¾ä¸Šçš„å˜é‡ï¼Œæ‰€æœ‰åˆçº¦å†…å‡½æ•°éƒ½å¯ä»¥è®¿é—® ï¼Œ`gas`æ¶ˆè€—é«˜ã€‚çŠ¶æ€å˜é‡åœ¨åˆçº¦å†…ã€å‡½æ•°å¤–å£°æ˜ï¼š

```solidity
contract Variables {
    uint public x = 1;
    uint public y;
    string public z;
```



æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼ï¼š

```solidity
    function foo() external{
        // å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼
        x = 5;
        y = 2;
        z = "0xAA";
    }
```



#### 2. å±€éƒ¨å˜é‡

å±€éƒ¨å˜é‡æ˜¯ä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„å˜é‡ï¼Œå‡½æ•°é€€å‡ºåï¼Œå˜é‡æ— æ•ˆã€‚å±€éƒ¨å˜é‡çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œä¸ä¸Šé“¾ï¼Œ`gas`ä½ã€‚å±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…å£°æ˜ï¼š

```solidity
    function bar() external pure returns(uint){
        uint xx = 1;
        uint yy = 3;
        uint zz = xx + yy;
        return(zz);
    }
```



#### 3. å…¨å±€å˜é‡

å…¨å±€å˜é‡æ˜¯å…¨å±€èŒƒå›´å·¥ä½œçš„å˜é‡ï¼Œéƒ½æ˜¯`solidity`é¢„ç•™å…³é”®å­—ã€‚ä»–ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä¸å£°æ˜ç›´æ¥ä½¿ç”¨ï¼š

```solidity
    function global() external view returns(address, uint, bytes memory){
        address sender = msg.sender;
        uint blockNum = block.number;
        bytes memory data = msg.data;
        return(sender, blockNum, data);
    }
```



åœ¨ä¸Šé¢ä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†3ä¸ªå¸¸ç”¨çš„å…¨å±€å˜é‡ï¼š`msg.sender`, `block.number`å’Œ`msg.data`ï¼Œä»–ä»¬åˆ†åˆ«ä»£è¡¨è¯·æ±‚å‘èµ·åœ°å€ï¼Œå½“å‰åŒºå—é«˜åº¦ï¼Œå’Œè¯·æ±‚æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å…¨å±€å˜é‡ï¼Œæ›´å®Œæ•´çš„åˆ—è¡¨è¯·çœ‹è¿™ä¸ª[é“¾æ¥](https://learnblockchain.cn/docs/solidity/units-and-global-variables.html#special-variables-and-functions)ï¼š

- `blockhash(uint blockNumber)`: (`bytes32`)ç»™å®šåŒºå—çš„å“ˆå¸Œå€¼ â€“ åªé€‚ç”¨äº256æœ€è¿‘åŒºå—, ä¸åŒ…å«å½“å‰åŒºå—ã€‚
- `block.coinbase`: (`address payable`) å½“å‰åŒºå—çŸ¿å·¥çš„åœ°å€
- `block.gaslimit`: (`uint`) å½“å‰åŒºå—çš„gaslimit
- `block.number`: (`uint`) å½“å‰åŒºå—çš„number
- `block.timestamp`: (`uint`) å½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä¸ºunixçºªå…ƒä»¥æ¥çš„ç§’
- `gasleft()`: (`uint256`) å‰©ä½™ gas
- `msg.data`: (`bytes calldata`) å®Œæ•´call data
- `msg.sender`: (`address payable`) æ¶ˆæ¯å‘é€è€… (å½“å‰ caller)
- `msg.sig`: (`bytes4`) calldataçš„å‰å››ä¸ªå­—èŠ‚ (function identifier)
- `msg.value`: (`uint`) å½“å‰äº¤æ˜“å‘é€çš„`wei`å€¼

**Example:** ![5-4.png](https://www.wtf.academy/assets/images/5-4-5ee425310e1666a20575f2a8330c55cb.png)

### æ€»ç»“

åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­çš„å¼•ç”¨ç±»å‹ï¼Œæ•°æ®ä½ç½®å’Œå˜é‡çš„ä½œç”¨åŸŸã€‚é‡ç‚¹æ˜¯`storage`, `memory`å’Œ`calldata`ä¸‰ä¸ªå…³é”®å­—çš„ç”¨æ³•ã€‚ä»–ä»¬å‡ºç°çš„åŸå› æ˜¯ä¸ºäº†èŠ‚çœé“¾ä¸Šæœ‰é™çš„å­˜å‚¨ç©ºé—´å’Œé™ä½`gas`ã€‚ä¸‹ä¸€è®²æˆ‘ä»¬ä¼šä»‹ç»å¼•ç”¨ç±»å‹ä¸­çš„æ•°ç»„ã€‚



## å¼•ç”¨ç±»å‹

### æ•°ç»„ array[]

æ•°ç»„ï¼ˆ`Array`ï¼‰æ˜¯`solidity`å¸¸ç”¨çš„ä¸€ç§å˜é‡ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ä¸€ç»„æ•°æ®ï¼ˆæ•´æ•°ï¼Œå­—èŠ‚ï¼Œåœ°å€ç­‰ç­‰ï¼‰ã€‚æ•°ç»„åˆ†ä¸ºå›ºå®šé•¿åº¦æ•°ç»„å’Œå¯å˜é•¿åº¦æ•°ç»„ä¸¤ç§ï¼š

- å›ºå®šé•¿åº¦æ•°ç»„ï¼šåœ¨å£°æ˜æ—¶æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨`T[k]`çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­`T`æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œ`k`æ˜¯é•¿åº¦ï¼Œä¾‹å¦‚ï¼š

```solidity
    // å›ºå®šé•¿åº¦ Array
    uint[8] array1;
    bytes1[5] array2;
    address[100] array3;
```



- å¯å˜é•¿åº¦æ•°ç»„ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰ï¼šåœ¨å£°æ˜æ—¶ä¸æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨`T[]`çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­`T`æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼ˆ`bytes`æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯æ•°ç»„ï¼Œä½†æ˜¯ä¸ç”¨åŠ `[]`ï¼‰ï¼š

```solidity
    // å¯å˜é•¿åº¦ Array
    uint[] array4;
    bytes1[] array5;
    address[] array6;
    bytes array7;
```



#### åˆ›å»ºæ•°ç»„çš„è§„åˆ™

åœ¨solidityé‡Œï¼Œåˆ›å»ºæ•°ç»„æœ‰ä¸€äº›è§„åˆ™ï¼š

- å¯¹äº`memory`ä¿®é¥°çš„`åŠ¨æ€æ•°ç»„`ï¼Œå¯ä»¥ç”¨`new`æ“ä½œç¬¦æ¥åˆ›å»ºï¼Œä½†æ˜¯å¿…é¡»å£°æ˜é•¿åº¦ï¼Œå¹¶ä¸”å£°æ˜åé•¿åº¦ä¸èƒ½æ”¹å˜ã€‚ä¾‹å­ï¼š

```solidity
    // memoryåŠ¨æ€æ•°ç»„
    uint[] memory array8 = new uint[](5);
    bytes memory array9 = new bytes(9);
```



- æ•°ç»„å­—é¢å¸¸æ•°(Array Literals)æ˜¯å†™ä½œè¡¨è¾¾å¼å½¢å¼çš„æ•°ç»„ï¼Œç”¨æ–¹æ‹¬å·åŒ…ç€æ¥åˆå§‹åŒ–arrayçš„ä¸€ç§æ–¹å¼ï¼Œå¹¶ä¸”é‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ çš„typeæ˜¯ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†çš„ï¼Œä¾‹å¦‚`[1,2,3]`é‡Œé¢æ‰€æœ‰çš„å…ƒç´ éƒ½æ˜¯uint8ç±»å‹ï¼Œå› ä¸ºåœ¨solidityä¸­å¦‚æœä¸€ä¸ªå€¼æ²¡æœ‰æŒ‡å®štypeçš„è¯ï¼Œé»˜è®¤å°±æ˜¯æœ€å°å•ä½çš„è¯¥typeï¼Œè¿™é‡Œintçš„é»˜è®¤æœ€å°å•ä½ç±»å‹å°±æ˜¯uint8ã€‚è€Œ`[uint(1),2,3]`é‡Œé¢çš„å…ƒç´ éƒ½æ˜¯uintç±»å‹ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å®šäº†æ˜¯uintç±»å‹äº†ï¼Œæˆ‘ä»¬éƒ½ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†ã€‚ä¸‹é¢çš„åˆçº¦ä¸­ï¼Œå¯¹äºfå‡½æ•°é‡Œé¢çš„è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œuintå¼ºè½¬çš„è¯ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ï¼Œå› ä¸ºå¦‚ä¸Šæ‰€è¿°æˆ‘ä»¬å…¶å®æ˜¯ä¼ å…¥äº†uint8ç±»å‹çš„arrayï¼Œå¯æ˜¯gå‡½æ•°éœ€è¦çš„å´æ˜¯uintç±»å‹çš„arrayï¼Œå°±ä¼šæŠ¥é”™äº†ã€‚

```solidity
// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.4.16 <0.9.0;
contract C {
    function f() public pure {
        g([uint(1), 2, 3]);
    }
    function g(uint[3] memory) public pure {
        // ...
    }
}
```



- å¦‚æœåˆ›å»ºçš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªå…ƒç´ çš„èµ‹å€¼ã€‚

```solidity
    uint[] memory x = new uint[](3);
    x[0] = 1;
    x[1] = 3;
    x[2] = 4;
```



#### æ•°ç»„æˆå‘˜

- `length`: æ•°ç»„æœ‰ä¸€ä¸ªåŒ…å«å…ƒç´ æ•°é‡çš„`length`æˆå‘˜ï¼Œ`memory`æ•°ç»„çš„é•¿åº¦åœ¨åˆ›å»ºåæ˜¯å›ºå®šçš„ã€‚
- `push()`: `åŠ¨æ€æ•°ç»„`å’Œ`bytes`æ‹¥æœ‰`push()`æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª`0`å…ƒç´ ã€‚
- `push(x)`: `åŠ¨æ€æ•°ç»„`å’Œ`bytes`æ‹¥æœ‰`push(x)`æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª`x`å…ƒç´ ã€‚
- `pop()`: `åŠ¨æ€æ•°ç»„`å’Œ`bytes`æ‹¥æœ‰`pop()`æˆå‘˜ï¼Œå¯ä»¥ç§»é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ã€‚

**Example:** ![6-1.png](https://www.wtf.academy/assets/images/6-1-ff58f00a7e037fcd318401ca2bc350b6.png)

### ç»“æ„ä½“ struct

`Solidity`æ”¯æŒé€šè¿‡æ„é€ ç»“æ„ä½“çš„å½¢å¼å®šä¹‰æ–°çš„ç±»å‹ã€‚åˆ›å»ºç»“æ„ä½“çš„æ–¹æ³•ï¼š

```solidity
    // ç»“æ„ä½“
    struct Student{
        uint256 id;
        uint256 score; 
    }
```



```solidity
    Student student; // åˆå§‹ä¸€ä¸ªstudentç»“æ„ä½“
```



ç»™ç»“æ„ä½“èµ‹å€¼çš„ä¸¤ç§æ–¹æ³•ï¼š

```solidity
    //  ç»™ç»“æ„ä½“èµ‹å€¼
    // æ–¹æ³•1:åœ¨å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªstorageçš„structå¼•ç”¨
    function initStudent1() external{
        Student storage _student = student; // assign a copy of student
        _student.id = 11;
        _student.score = 100;
    }
```



**Example:** ![6-2.png](https://www.wtf.academy/assets/images/6-2-991e08767256fcc39717f429da21f05d.png)

```solidity
     // æ–¹æ³•2:ç›´æ¥å¼•ç”¨çŠ¶æ€å˜é‡çš„struct
    function initStudent2() external{
        student.id = 1;
        student.score = 80;
    }
```



**Example:** ![6-3.png](https://www.wtf.academy/assets/images/6-3-7ccb3cbebd7eff492292a171a8de1852.png)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†solidityä¸­æ•°ç»„ï¼ˆ`array`ï¼‰å’Œç»“æ„ä½“ï¼ˆ`struct`ï¼‰çš„åŸºæœ¬ç”¨æ³•ã€‚ä¸‹ä¸€è®²æˆ‘ä»¬å°†ä»‹ç»solidityä¸­çš„å“ˆå¸Œè¡¨â€”â€”æ˜ å°„ï¼ˆ`mapping`ï¼‰ã€‚



## æ˜ å°„ç±»å‹

æˆ‘ä»¬å°†ä»‹ç»solidityä¸­çš„å“ˆå¸Œè¡¨ï¼šæ˜ å°„ï¼ˆ`Mapping`ï¼‰ç±»å‹ã€‚

### æ˜ å°„Mapping

åœ¨æ˜ å°„ä¸­ï¼Œäººä»¬å¯ä»¥é€šè¿‡é”®ï¼ˆ`Key`ï¼‰æ¥æŸ¥è¯¢å¯¹åº”çš„å€¼ï¼ˆ`Value`ï¼‰ï¼Œæ¯”å¦‚ï¼šé€šè¿‡ä¸€ä¸ªäººçš„`id`æ¥æŸ¥è¯¢ä»–çš„é’±åŒ…åœ°å€ã€‚

å£°æ˜æ˜ å°„çš„æ ¼å¼ä¸º`mapping(_KeyType => _ValueType)`ï¼Œå…¶ä¸­`_KeyType`å’Œ`_ValueType`åˆ†åˆ«æ˜¯`Key`å’Œ`Value`çš„å˜é‡ç±»å‹ã€‚ä¾‹å­ï¼š

```solidity
    mapping(uint => address) public idToAddress; // idæ˜ å°„åˆ°åœ°å€
    mapping(address => address) public swapPair; // å¸å¯¹çš„æ˜ å°„ï¼Œåœ°å€åˆ°åœ°å€
```



### æ˜ å°„çš„è§„åˆ™

- **è§„åˆ™1**ï¼šæ˜ å°„çš„`_KeyType`åªèƒ½é€‰æ‹©`solidity`é»˜è®¤çš„ç±»å‹ï¼Œæ¯”å¦‚`uint`ï¼Œ`address`ç­‰ï¼Œä¸èƒ½ç”¨è‡ªå®šä¹‰çš„ç»“æ„ä½“ã€‚è€Œ`_ValueType`å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»å‹ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¼šæŠ¥é”™ï¼Œå› ä¸º`_KeyType`ä½¿ç”¨äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼š

```solidity
    // æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ Struct
    struct Student{
        uint256 id;
        uint256 score; 
    }
     mapping(Student => uint) public testVar;
```



- **è§„åˆ™2**ï¼šæ˜ å°„çš„å­˜å‚¨ä½ç½®å¿…é¡»æ˜¯`storage`ï¼Œå› æ­¤å¯ä»¥ç”¨äºåˆçº¦çš„çŠ¶æ€å˜é‡ï¼Œå‡½æ•°ä¸­çš„`storage`å˜é‡ï¼Œå’Œlibraryå‡½æ•°çš„å‚æ•°ï¼ˆè§[ä¾‹å­](https://github.com/ethereum/solidity/issues/4635)ï¼‰ã€‚ä¸èƒ½ç”¨äº`public`å‡½æ•°çš„å‚æ•°æˆ–è¿”å›ç»“æœä¸­ï¼Œå› ä¸º`mapping`è®°å½•çš„æ˜¯ä¸€ç§å…³ç³» (key - value pair)ã€‚
- **è§„åˆ™3**ï¼šå¦‚æœæ˜ å°„å£°æ˜ä¸º`public`ï¼Œé‚£ä¹ˆ`solidity`ä¼šè‡ªåŠ¨ç»™ä½ åˆ›å»ºä¸€ä¸ª`getter`å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡`Key`æ¥æŸ¥è¯¢å¯¹åº”çš„`Value`ã€‚
- **è§„åˆ™4**ï¼šç»™æ˜ å°„æ–°å¢çš„é”®å€¼å¯¹çš„è¯­æ³•ä¸º`_Var[_Key] = _Value`ï¼Œå…¶ä¸­`_Var`æ˜¯æ˜ å°„å˜é‡åï¼Œ`_Key`å’Œ`_Value`å¯¹åº”æ–°å¢çš„é”®å€¼å¯¹ã€‚ä¾‹å­ï¼š

```solidity
    function writeMap (uint _Key, address _Value) public{
        idToAddress[_Key] = _Value;
    }
```



### æ˜ å°„çš„åŸç†

- **åŸç†1**: æ˜ å°„ä¸å‚¨å­˜ä»»ä½•é”®ï¼ˆ`Key`ï¼‰çš„èµ„è®¯ï¼Œä¹Ÿæ²¡æœ‰lengthçš„èµ„è®¯ã€‚
- **åŸç†2**: æ˜ å°„ä½¿ç”¨`keccak256(key)`å½“æˆoffsetå­˜å–valueã€‚
- **åŸç†3**: å› ä¸ºEthereumä¼šå®šä¹‰æ‰€æœ‰æœªä½¿ç”¨çš„ç©ºé—´ä¸º0ï¼Œæ‰€ä»¥æœªèµ‹å€¼ï¼ˆ`Value`ï¼‰çš„é”®ï¼ˆ`Key`ï¼‰åˆå§‹å€¼éƒ½æ˜¯0ã€‚

### åœ¨Remixä¸ŠéªŒè¯ (ä»¥ `Mapping.sol`ä¸ºä¾‹)

- æ˜ å°„ç¤ºä¾‹ 1 éƒ¨ç½²

  ![7-1](https://www.wtf.academy/assets/images/7-1-2768f65eec9dbbc8771275b45c937e96.jpg)

- æ˜ å°„ç¤ºä¾‹ 2 åˆå§‹å€¼

  ![7-2](https://www.wtf.academy/assets/images/7-2-886db6cf3743df280acac78c151971f3.jpg)

- æ˜ å°„ç¤ºä¾‹ 3 key-value pair

  ![7-3](https://www.wtf.academy/assets/images/7-3-88745249067310f5e280dd60b2560adb.jpg)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­å“ˆå¸Œè¡¨â€”â€”æ˜ å°„ï¼ˆ`Mapping`ï¼‰çš„ç”¨æ³•ã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†æ‰€æœ‰å¸¸ç”¨å˜é‡ç§ç±»ï¼Œä¹‹åæˆ‘ä»¬ä¼šå­¦ä¹ æ§åˆ¶æµ`if-else`,` while`ç­‰ã€‚



## å˜é‡åˆå§‹å€¼

åœ¨`solidity`ä¸­ï¼Œå£°æ˜ä½†æ²¡èµ‹å€¼çš„å˜é‡éƒ½æœ‰å®ƒçš„åˆå§‹å€¼æˆ–é»˜è®¤å€¼ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¸¸ç”¨å˜é‡çš„åˆå§‹å€¼ã€‚

### å€¼ç±»å‹åˆå§‹å€¼

- `boolean`: `false`

- `string`: `""`

- `int`: `0`

- `uint`: `0`

- `enum`: æšä¸¾ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ 

- `address`: `0x0000000000000000000000000000000000000000` (æˆ– `address(0)`)

- ```
  function
  ```

  - `internal`: ç©ºç™½æ–¹ç¨‹
  - `external`: ç©ºç™½æ–¹ç¨‹

å¯ä»¥ç”¨`public`å˜é‡çš„`getter`å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š

```solidity
    bool public _bool; // false
    string public _string; // ""
    int public _int; // 0
    uint public _uint; // 0
    address public _address; // 0x0000000000000000000000000000000000000000

    enum ActionSet { Buy, Hold, Sell}
    ActionSet public _enum; // ç¬¬ä¸€ä¸ªå…ƒç´  0

    function fi() internal{} // internalç©ºç™½æ–¹ç¨‹ 
    function fe() external{} // externalç©ºç™½æ–¹ç¨‹ 
```



### å¼•ç”¨ç±»å‹åˆå§‹å€¼

- æ˜ å°„`mapping`: æ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„`mapping`
- ç»“æ„ä½“`struct`: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“
- æ•°ç»„`array`
  - åŠ¨æ€æ•°ç»„: `[]`
  - é™æ€æ•°ç»„ï¼ˆå®šé•¿ï¼‰: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„

å¯ä»¥ç”¨`public`å˜é‡çš„`getter`å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š

```solidity
    // Reference Types
    uint[8] public _staticArray; // æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„[0,0,0,0,0,0,0,0]
    uint[] public _dynamicArray; // `[]`
    mapping(uint => address) public _mapping; // æ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„mapping
    // æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“ 0, 0
    struct Student{
        uint256 id;
        uint256 score; 
    }
    Student public student;
```



### `delete`æ“ä½œç¬¦

`delete a`ä¼šè®©å˜é‡`a`çš„å€¼å˜ä¸ºåˆå§‹å€¼ã€‚

```solidity
    // deleteæ“ä½œç¬¦
    bool public _bool2 = true; 
    function d() external {
        delete _bool2; // delete ä¼šè®©_bool2å˜ä¸ºé»˜è®¤å€¼ï¼Œfalse
    }
```



### åœ¨remixä¸ŠéªŒè¯

- éƒ¨ç½²åˆçº¦æŸ¥çœ‹å€¼ç±»å‹ã€å¼•ç”¨ç±»å‹çš„åˆå§‹å€¼ ![img](https://www.wtf.academy/assets/images/8-1-bf8a5eafba9f2a6be29c8a116a5465bc.png)
- å€¼ç±»å‹ã€å¼•ç”¨ç±»å‹deleteæ“ä½œåçš„é»˜è®¤å€¼ ![img](https://www.wtf.academy/assets/images/8-2-968b7c57cb793dc524a5665dfae26624.png)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­å˜é‡çš„åˆå§‹å€¼ã€‚å˜é‡è¢«å£°æ˜ä½†æ²¡æœ‰èµ‹å€¼çš„æ—¶å€™ï¼Œå®ƒçš„å€¼é»˜è®¤ä¸ºåˆå§‹å€¼ã€‚ä¸åŒç±»å‹çš„å˜é‡åˆå§‹å€¼ä¸åŒï¼Œ`delete`æ“ä½œç¬¦å¯ä»¥åˆ é™¤ä¸€ä¸ªå˜é‡çš„å€¼å¹¶ä»£æ›¿ä¸ºåˆå§‹å€¼ã€‚



## å¸¸æ•°

æˆ‘ä»¬ä»‹ç»`solidity`ä¸­ä¸¤ä¸ªå…³é”®å­—ï¼Œ`constant`ï¼ˆå¸¸é‡ï¼‰å’Œ`immutable`ï¼ˆä¸å˜é‡ï¼‰ã€‚çŠ¶æ€å˜é‡å£°æ˜è¿™ä¸ªä¸¤ä¸ªå…³é”®å­—ä¹‹åï¼Œä¸èƒ½åœ¨åˆçº¦åæ›´æ”¹æ•°å€¼ï¼›å¹¶ä¸”è¿˜å¯ä»¥èŠ‚çœ`gas`ã€‚å¦å¤–ï¼Œåªæœ‰æ•°å€¼å˜é‡å¯ä»¥å£°æ˜`constant`å’Œ`immutable`ï¼›`string`å’Œ`bytes`å¯ä»¥å£°æ˜ä¸º`constant`ï¼Œä½†ä¸èƒ½ä¸º`immutable`ã€‚

### constantå’Œimmutable

#### constant

`constant`å˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ”¹å˜ã€‚å°è¯•æ”¹å˜çš„è¯ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚

```solidity
    // constantå˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åä¸èƒ½æ”¹å˜
    uint256 constant CONSTANT_NUM = 10;
    string constant CONSTANT_STRING = "0xAA";
    bytes constant CONSTANT_BYTES = "WTF";
    address constant CONSTANT_ADDRESS = 0x0000000000000000000000000000000000000000;
```



#### immutable

`immutable`å˜é‡å¯ä»¥åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚

```solidity
    // immutableå˜é‡å¯ä»¥åœ¨constructoré‡Œåˆå§‹åŒ–ï¼Œä¹‹åä¸èƒ½æ”¹å˜
    uint256 public immutable IMMUTABLE_NUM = 9999999999;
    address public immutable IMMUTABLE_ADDRESS;
    uint256 public immutable IMMUTABLE_BLOCK;
    uint256 public immutable IMMUTABLE_TEST;
```



ä½ å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ä¾‹å¦‚`address(this)`ï¼Œ`block.number` ï¼Œæˆ–è€…è‡ªå®šä¹‰çš„å‡½æ•°ç»™`immutable`å˜é‡åˆå§‹åŒ–ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†`test()`å‡½æ•°ç»™`IMMUTABLE_TEST`åˆå§‹åŒ–ä¸º`9`ï¼š

```solidity
    // åˆ©ç”¨constructoråˆå§‹åŒ–immutableå˜é‡ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨
    constructor(){
        IMMUTABLE_ADDRESS = address(this);
        IMMUTABLE_BLOCK = block.number;
        IMMUTABLE_TEST = test();
    }

    function test() public pure returns(uint256){
        uint256 what = 9;
        return(what);
    }
```



### åœ¨remixä¸ŠéªŒè¯

1. éƒ¨ç½²å¥½åˆçº¦ä¹‹åï¼Œé€šè¿‡remixä¸Šçš„`getter`å‡½æ•°ï¼Œèƒ½è·å–åˆ°`constant`å’Œ`immutable`å˜é‡åˆå§‹åŒ–å¥½çš„å€¼ã€‚

   ![9-1.png](https://www.wtf.academy/assets/images/9-1-4dd7d40c9799d42c60e4793394a4eb5e.png)

2. `constant`å˜é‡åˆå§‹åŒ–ä¹‹åï¼Œå°è¯•æ”¹å˜å®ƒçš„å€¼ï¼Œä¼šç¼–è¯‘ä¸é€šè¿‡å¹¶æŠ›å‡º`TypeError: Cannot assign to a constant variable.`çš„é”™è¯¯ã€‚

![9-2.png](https://www.wtf.academy/assets/images/9-2-5b85f9969dff8fbeb78cac9f8d4089ce.png)

1. `immutable`å˜é‡åˆå§‹åŒ–ä¹‹åï¼Œå°è¯•æ”¹å˜å®ƒçš„å€¼ï¼Œä¼šç¼–è¯‘ä¸é€šè¿‡å¹¶æŠ›å‡º`TypeError: Immutable state variable already initialized.`çš„é”™è¯¯ã€‚

   ![9-3.png](data:image/png;base64,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)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»`solidity`ä¸­ä¸¤ä¸ªå…³é”®å­—ï¼Œ`constant`ï¼ˆå¸¸é‡ï¼‰å’Œ`immutable`ï¼ˆä¸å˜é‡ï¼‰ï¼Œè®©ä¸åº”è¯¥å˜çš„å˜é‡ä¿æŒä¸å˜ã€‚è¿™æ ·çš„åšæ³•èƒ½åœ¨èŠ‚çœ`gas`çš„åŒæ—¶æå‡åˆçº¦çš„å®‰å…¨æ€§ã€‚



## æ§åˆ¶æµ

`Solidity`çš„æ§åˆ¶æµä¸å…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ç§ï¼š

### æ¡ä»¶åˆ¤æ–­

1. `if-else`

```solidity
function ifElseTest(uint256 _number) public pure returns(bool){
    if(_number == 0){
    return(true);
    }else{
    return(false);
    }
}
```



### å¾ªç¯

1. `forå¾ªç¯`

```solidity
function forLoopTest() public pure returns(uint256){
    uint sum = 0;
    for(uint i = 0; i < 10; i++){
    sum += i;
    }
    return(sum);
}
```



1. `whileå¾ªç¯`

```solidity
function whileTest() public pure returns(uint256){
    uint sum = 0;
    uint i = 0;
    while(i < 10){
    sum += i;
    i++;
    }
    return(sum);
}
```



1. `do-whileå¾ªç¯`

```solidity
function doWhileTest() public pure returns(uint256){
    uint sum = 0;
    uint i = 0;
    do{
    sum += i;
    i++;
    }while(i < 10);
    return(sum);
}
```



1. `ä¸‰å…ƒè¿ç®—ç¬¦` ä¸‰å…ƒè¿ç®—ç¬¦æ˜¯`solidity`ä¸­å”¯ä¸€ä¸€ä¸ªæ¥å—ä¸‰ä¸ªæ“ä½œæ•°çš„è¿ç®—ç¬¦ï¼Œè§„åˆ™`æ¡ä»¶? æ¡ä»¶ä¸ºçœŸçš„è¡¨è¾¾å¼:æ¡ä»¶ä¸ºå‡çš„è¡¨è¾¾å¼`ã€‚ æ­¤è¿ç®—ç¬¦ç»å¸¸ç”¨ä½œ if è¯­å¥çš„å¿«æ·æ–¹å¼ã€‚

```solidity
// ä¸‰å…ƒè¿ç®—ç¬¦ ternary/conditional operator
function ternaryTest(uint256 x, uint256 y) public pure returns(uint256){
    // return the max of x and y
    return x >= y ? x: y; 
}
```



å¦å¤–è¿˜æœ‰`continue`ï¼ˆç«‹å³è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯ï¼‰å’Œ`break`ï¼ˆè·³å‡ºå½“å‰å¾ªç¯ï¼‰å…³é”®å­—å¯ä»¥ä½¿ç”¨ã€‚

### ç”¨`solidity`å®ç°æ’å…¥æ’åº

#### å†™åœ¨å‰é¢ï¼š90%ä»¥ä¸Šçš„äººç”¨`solidity`å†™æ’å…¥ç®—æ³•éƒ½ä¼šå‡ºé”™ã€‚

### æ’å…¥æ’åº

æ’åºç®—æ³•è§£å†³çš„é—®é¢˜æ˜¯å°†æ— åºçš„ä¸€ç»„æ•°å­—ï¼Œä¾‹å¦‚`[2, 5, 3, 1]`ï¼Œä»å°åˆ°å¤§ä¾æ¬¡æ’åˆ—å¥½ã€‚æ’å…¥æ’åºï¼ˆ`InsertionSort`ï¼‰æ˜¯æœ€ç®€å•çš„ä¸€ç§æ’åºç®—æ³•ï¼Œä¹Ÿæ˜¯å¾ˆå¤šäººå­¦ä¹ çš„ç¬¬ä¸€ä¸ªç®—æ³•ã€‚å®ƒçš„æ€è·¯å¾ˆç®€ç­”ï¼Œä»å‰å¾€åï¼Œä¾æ¬¡å°†æ¯ä¸€ä¸ªæ•°å’Œæ’åœ¨ä»–å‰é¢çš„æ•°å­—æ¯”å¤§å°ï¼Œå¦‚æœæ¯”å‰é¢çš„æ•°å­—å°ï¼Œå°±äº’æ¢ä½ç½®ã€‚ç¤ºæ„å›¾ï¼š

![æ’å…¥æ’åº](https://i.pinimg.com/originals/92/b0/34/92b034385c440e08bc8551c97df0a2e3.gif)

### `python`ä»£ç 

æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹æ’å…¥æ’åºçš„pythonä»£ç ï¼š

```python
# Python program for implementation of Insertion Sort
def insertionSort(arr):
    for i in range(1, len(arr)):
        key = arr[i]
        j = i-1
        while j >=0 and key < arr[j] :
                arr[j+1] = arr[j]
                j -= 1
        arr[j+1] = key
```



### æ”¹å†™æˆ`solidity`åæœ‰`BUG`ï¼

ä¸€å…±8è¡Œ`python`ä»£ç å°±å¯ä»¥å®Œæˆæ’å…¥æ’åºï¼Œéå¸¸ç®€å•ã€‚é‚£ä¹ˆæˆ‘ä»¬å°†å®ƒæ”¹å†™æˆ`solidity`ä»£ç ï¼Œå°†å‡½æ•°ï¼Œå˜é‡ï¼Œå¾ªç¯ç­‰ç­‰éƒ½åšäº†ç›¸åº”çš„è½¬æ¢ï¼Œåªéœ€è¦9è¡Œä»£ç ï¼š

```solidity
    // æ’å…¥æ’åº é”™è¯¯ç‰ˆ
    function insertionSortWrong(uint[] memory a) public pure returns(uint[] memory) {
        
        for (uint i = 1;i < a.length;i++){
            uint temp = a[i];
            uint j=i-1;
            while( (j >= 0) && (temp < a[j])){
                a[j+1] = a[j];
                j--;
            }
            a[j+1] = temp;
        }
        return(a);
    }
```



é‚£æˆ‘ä»¬æŠŠæ”¹å¥½çš„æ”¾åˆ°`remix`ä¸Šå»è·‘ï¼Œè¾“å…¥`[2, 5, 3, 1]`ã€‚BOOMï¼æœ‰`bug`ï¼æ”¹äº†åŠå¤©ï¼Œæ²¡æ‰¾åˆ°`bug`åœ¨å“ªã€‚æˆ‘åˆå»`google`æœâ€solidity insertion sortâ€ï¼Œç„¶åå‘ç°ç½‘ä¸Šç”¨`solidity`å†™çš„æ’å…¥ç®—æ³•æ•™ç¨‹éƒ½æ˜¯é”™çš„ï¼Œæ¯”å¦‚ï¼š[Sorting in Solidity without Comparison](https://medium.com/coinmonks/sorting-in-solidity-without-comparison-4eb47e04ff0d)

Remix decoded output å‡ºç°é”™è¯¯å†…å®¹ ![10-1](https://www.wtf.academy/assets/images/10-1-e9590da7aad6c176501b7fc5abe3372f.jpg)

### æ­£ç¡®çš„solidityæ’å…¥æ’åº

èŠ±äº†å‡ ä¸ªå°æ—¶ï¼Œåœ¨`Dapp-Learning`ç¤¾ç¾¤ä¸€ä¸ªæœ‹å‹çš„å¸®åŠ©ä¸‹ï¼Œç»ˆäºæ‰¾åˆ°äº†`bug`æ‰€åœ¨ã€‚`solidity`ä¸­æœ€å¸¸ç”¨çš„å˜é‡ç±»å‹æ˜¯`uint`ï¼Œä¹Ÿå°±æ˜¯æ­£æ•´æ•°ï¼Œå–åˆ°è´Ÿå€¼çš„è¯ï¼Œä¼šæŠ¥`underflow`é”™è¯¯ã€‚è€Œåœ¨æ’å…¥ç®—æ³•ä¸­ï¼Œå˜é‡`j`æœ‰å¯èƒ½ä¼šå–åˆ°`-1`ï¼Œå¼•èµ·æŠ¥é”™ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æŠŠ`j`åŠ 1ï¼Œè®©å®ƒæ— æ³•å–åˆ°è´Ÿå€¼ã€‚æ­£ç¡®ä»£ç ï¼š

```solidity
    // æ’å…¥æ’åº æ­£ç¡®ç‰ˆ
    function insertionSort(uint[] memory a) public pure returns(uint[] memory) {
        // note that uint can not take negative value
        for (uint i = 1;i < a.length;i++){
            uint temp = a[i];
            uint j=i;
            while( (j >= 1) && (temp < a[j-1])){
                a[j] = a[j-1];
                j--;
            }
            a[j] = temp;
        }
        return(a);
    }
```



è¿è¡Œåçš„ç»“æœï¼š

!["è¾“å…¥[2,5,3,1] è¾“å‡º[1,2,3,5] "](https://images.mirror-media.xyz/publication-images/S-i6rwCMeXoi8eNJ0fRdB.png?height=300&width=554)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­æ§åˆ¶æµï¼Œå¹¶ä¸”ç”¨`solidity`å†™äº†æ’å…¥æ’åºã€‚çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†å®é™…å¾ˆéš¾ã€‚è¿™å°±æ˜¯`solidity`ï¼Œå‘å¾ˆå¤šï¼Œæ¯ä¸ªæœˆéƒ½æœ‰é¡¹ç›®å› ä¸ºè¿™äº›å°`bug`æŸå¤±å‡ åƒä¸‡ç”šè‡³ä¸Šäº¿ç¾å…ƒã€‚æŒæ¡å¥½åŸºç¡€ï¼Œä¸æ–­ç»ƒä¹ ï¼Œæ‰èƒ½å†™å‡ºæ›´å¥½çš„`solidity`ä»£ç ã€‚



## æ„é€ å‡½æ•°

æ„é€ å‡½æ•°ï¼ˆ`constructor`ï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ¯ä¸ªåˆçº¦å¯ä»¥å®šä¹‰ä¸€ä¸ªï¼Œå¹¶åœ¨éƒ¨ç½²åˆçº¦çš„æ—¶å€™è‡ªåŠ¨è¿è¡Œä¸€æ¬¡ã€‚å®ƒå¯ä»¥ç”¨æ¥åˆå§‹åŒ–åˆçº¦çš„ä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚åˆå§‹åŒ–åˆçº¦çš„`owner`åœ°å€ï¼š

```solidity
   address owner; // å®šä¹‰ownerå˜é‡

   // æ„é€ å‡½æ•°
   constructor() {
      owner = msg.sender; // åœ¨éƒ¨ç½²åˆçº¦çš„æ—¶å€™ï¼Œå°†ownerè®¾ç½®ä¸ºéƒ¨ç½²è€…çš„åœ°å€
   }
```



**æ³¨æ„**âš ï¸ï¼šæ„é€ å‡½æ•°åœ¨ä¸åŒçš„solidityç‰ˆæœ¬ä¸­çš„è¯­æ³•å¹¶ä¸ä¸€è‡´ï¼Œåœ¨Solidity 0.4.22ä¹‹å‰ï¼Œæ„é€ å‡½æ•°ä¸ä½¿ç”¨ `constructor` è€Œæ˜¯ä½¿ç”¨ä¸åˆçº¦ååŒåçš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°è€Œä½¿ç”¨ï¼Œç”±äºè¿™ç§æ—§å†™æ³•å®¹æ˜“ä½¿å¼€å‘è€…åœ¨ä¹¦å†™æ—¶å‘ç”Ÿç–æ¼ï¼ˆä¾‹å¦‚åˆçº¦åå« `Parents`ï¼Œæ„é€ å‡½æ•°åå†™æˆ `parents`ï¼‰ï¼Œä½¿å¾—æ„é€ å‡½æ•°å˜æˆæ™®é€šå‡½æ•°ï¼Œå¼•å‘æ¼æ´ï¼Œæ‰€ä»¥0.4.22ç‰ˆæœ¬åŠä¹‹åï¼Œé‡‡ç”¨äº†å…¨æ–°çš„ `constructor` å†™æ³•ã€‚

æ„é€ å‡½æ•°çš„æ—§å†™æ³•ä»£ç ç¤ºä¾‹ï¼š

```solidity
pragma solidity =0.4.21;
contract Parents {
    // ä¸åˆçº¦åParentsåŒåçš„å‡½æ•°å°±æ˜¯æ„é€ å‡½æ•°
    function Parents () public {
    }
}
```



## ä¿®é¥°å™¨

ä¿®é¥°å™¨ï¼ˆ`modifier`ï¼‰æ˜¯`solidity`ç‰¹æœ‰çš„è¯­æ³•ï¼Œç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„`decorator`ï¼Œå£°æ˜å‡½æ•°æ‹¥æœ‰çš„ç‰¹æ€§ï¼Œå¹¶å‡å°‘ä»£ç å†—ä½™ã€‚å®ƒå°±åƒé’¢é“ä¾ çš„æ™ºèƒ½ç›”ç”²ï¼Œç©¿ä¸Šå®ƒçš„å‡½æ•°ä¼šå¸¦æœ‰æŸäº›ç‰¹å®šçš„è¡Œä¸ºã€‚`modifier`çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯è¿è¡Œå‡½æ•°å‰çš„æ£€æŸ¥ï¼Œä¾‹å¦‚åœ°å€ï¼Œå˜é‡ï¼Œä½™é¢ç­‰ã€‚

![é’¢é“ä¾ çš„modifier](https://images.mirror-media.xyz/publication-images/nVwXsOVmrYu8rqvKKPMpg.jpg?height=630&width=1200)

æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªå«åšonlyOwnerçš„modifierï¼š

```solidity
   // å®šä¹‰modifier
   modifier onlyOwner {
      require(msg.sender == owner); // æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦ä¸ºowneråœ°å€
      _; // å¦‚æœæ˜¯çš„è¯ï¼Œç»§ç»­è¿è¡Œå‡½æ•°ä¸»ä½“ï¼›å¦åˆ™æŠ¥é”™å¹¶revertäº¤æ˜“
   }
```



ä»£æœ‰`onlyOwner`ä¿®é¥°ç¬¦çš„å‡½æ•°åªèƒ½è¢«`owner`åœ°å€è°ƒç”¨ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```solidity
   function changeOwner(address _newOwner) external onlyOwner{
      owner = _newOwner; // åªæœ‰owneråœ°å€è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå¹¶æ”¹å˜owner
   }
```



æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª`changeOwner`å‡½æ•°ï¼Œè¿è¡Œä»–å¯ä»¥æ”¹å˜åˆçº¦çš„`owner`ï¼Œä½†æ˜¯ç”±äº`onlyOwner`ä¿®é¥°ç¬¦çš„å­˜åœ¨ï¼Œåªæœ‰åŸå…ˆçš„`owner`å¯ä»¥è°ƒç”¨ï¼Œåˆ«äººè°ƒç”¨å°±ä¼šæŠ¥é”™ã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ§åˆ¶æ™ºèƒ½åˆçº¦æƒé™çš„æ–¹æ³•ã€‚

### OppenZepplinçš„Ownableæ ‡å‡†å®ç°ï¼š

`OppenZepplin`æ˜¯ä¸€ä¸ªç»´æŠ¤`solidity`æ ‡å‡†åŒ–ä»£ç åº“çš„ç»„ç»‡ï¼Œä»–çš„`Ownable`æ ‡å‡†å®ç°å¦‚ä¸‹ï¼š https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/access/Ownable.sol

### Remix æ¼”ç¤ºç¤ºä¾‹

ä»¥ `Owner.sol` ä¸ºä¾‹ã€‚

1. åœ¨ Remix ä¸Šç¼–è¯‘éƒ¨ç½²ä»£ç ã€‚
2. ç‚¹å‡» `owner` æŒ‰é’®æŸ¥çœ‹å½“å‰ owner å˜é‡ã€‚ ![img](https://www.wtf.academy/assets/images/11-1-158ba3a195f7ecc313538aae20c45658.jpg)
3. ä»¥ owner åœ°å€çš„ç”¨æˆ·èº«ä»½ï¼Œè°ƒç”¨ `changeOwner` å‡½æ•°ï¼Œäº¤æ˜“æˆåŠŸã€‚ ![img](https://www.wtf.academy/assets/images/11-2-4127c92edede8fbe048358b699b57589.jpg)
4. ä»¥é owner åœ°å€çš„ç”¨æˆ·èº«ä»½ï¼Œè°ƒç”¨ `changeOwner` å‡½æ•°ï¼Œäº¤æ˜“å¤±è´¥ï¼Œå› ä¸ºmodifier onlyOwner çš„æ£€æŸ¥è¯­å¥ä¸æ»¡è¶³ã€‚ ![img](https://www.wtf.academy/assets/images/11-3-c6c793034d8354ecf203513b644321df.jpg)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­çš„æ„é€ å‡½æ•°å’Œä¿®é¥°ç¬¦ï¼Œå¹¶ä¸¾äº†ä¸€ä¸ªæ§åˆ¶åˆçº¦æƒé™çš„`Ownable`åˆçº¦ã€‚



## äº‹ä»¶

`Solidity`ä¸­çš„äº‹ä»¶ï¼ˆ`event`ï¼‰æ˜¯`EVM`ä¸Šæ—¥å¿—çš„æŠ½è±¡ï¼Œå®ƒå…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š

- å“åº”ï¼šåº”ç”¨ç¨‹åºï¼ˆ[`ether.js`](https://learnblockchain.cn/docs/ethers.js/api-contract.html#id18)ï¼‰å¯ä»¥é€šè¿‡`RPC`æ¥å£è®¢é˜…å’Œç›‘å¬è¿™äº›äº‹ä»¶ï¼Œå¹¶åœ¨å‰ç«¯åšå“åº”ã€‚
- ç»æµï¼šäº‹ä»¶æ˜¯`EVM`ä¸Šæ¯”è¾ƒç»æµçš„å­˜å‚¨æ•°æ®çš„æ–¹å¼ï¼Œæ¯ä¸ªå¤§æ¦‚æ¶ˆè€—2,000 `gas`ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œé“¾ä¸Šå­˜å‚¨ä¸€ä¸ªæ–°å˜é‡è‡³å°‘éœ€è¦20,000 `gas`ã€‚

### è§„åˆ™

äº‹ä»¶çš„å£°æ˜ç”±`event`å…³é”®å­—å¼€å¤´ï¼Œç„¶åè·Ÿäº‹ä»¶åç§°ï¼Œæ‹¬å·é‡Œé¢å†™å¥½äº‹ä»¶éœ€è¦è®°å½•çš„å˜é‡ç±»å‹å’Œå˜é‡åã€‚ä»¥`ERC20`ä»£å¸åˆçº¦çš„`Transfer`äº‹ä»¶ä¸ºä¾‹ï¼š

```solidity
event Transfer(address indexed from, address indexed to, uint256 value);
```



æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ`Transfer`äº‹ä»¶å…±è®°å½•äº†3ä¸ªå˜é‡`from`ï¼Œ`to`å’Œ`value`ï¼Œåˆ†åˆ«å¯¹åº”ä»£å¸çš„è½¬è´¦åœ°å€ï¼Œæ¥æ”¶åœ°å€å’Œè½¬è´¦æ•°é‡ã€‚

åŒæ—¶`from`å’Œ`to`å‰é¢å¸¦ç€`indexed`å…³é”®å­—ï¼Œæ¯ä¸ª`indexed`æ ‡è®°çš„å˜é‡å¯ä»¥ç†è§£ä¸ºæ£€ç´¢äº‹ä»¶çš„ç´¢å¼•â€œé”®â€ï¼Œåœ¨ä»¥å¤ªåŠä¸Šå•ç‹¬ä½œä¸ºä¸€ä¸ª`topic`è¿›è¡Œå­˜å‚¨å’Œç´¢å¼•ï¼Œç¨‹åºå¯ä»¥è½»æ¾çš„ç­›é€‰å‡ºç‰¹å®šè½¬è´¦åœ°å€å’Œæ¥æ”¶åœ°å€çš„è½¬è´¦äº‹ä»¶ã€‚æ¯ä¸ªäº‹ä»¶æœ€å¤šæœ‰3ä¸ªå¸¦`indexed`çš„å˜é‡ã€‚æ¯ä¸ª `indexed` å˜é‡çš„å¤§å°ä¸ºå›ºå®šçš„256æ¯”ç‰¹ã€‚äº‹ä»¶çš„å“ˆå¸Œä»¥åŠè¿™ä¸‰ä¸ªå¸¦`indexed`çš„å˜é‡åœ¨`EVM`æ—¥å¿—ä¸­é€šå¸¸è¢«å­˜å‚¨ä¸º`topic`ã€‚å…¶ä¸­`topic[0]`æ˜¯æ­¤äº‹ä»¶çš„`keccak256`å“ˆå¸Œï¼Œ`topic[1]`åˆ°`topic[3]`å­˜å‚¨äº†å¸¦`indexed`å˜é‡çš„`keccak256`å“ˆå¸Œã€‚ ![img](https://www.wtf.academy/assets/images/12-3-b08311699b4378c7b077f1cd966b51e2.jpg)

`value` ä¸å¸¦ `indexed` å…³é”®å­—ï¼Œä¼šå­˜å‚¨åœ¨äº‹ä»¶çš„ `data` éƒ¨åˆ†ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºäº‹ä»¶çš„â€œå€¼â€ã€‚`data` éƒ¨åˆ†çš„å˜é‡ä¸èƒ½è¢«ç›´æ¥æ£€ç´¢ï¼Œä½†å¯ä»¥å­˜å‚¨ä»»æ„å¤§å°çš„æ•°æ®ã€‚å› æ­¤ä¸€èˆ¬ `data` éƒ¨åˆ†å¯ä»¥ç”¨æ¥å­˜å‚¨å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚æ•°ç»„å’Œå­—ç¬¦ä¸²ç­‰ç­‰ï¼Œå› ä¸ºè¿™äº›æ•°æ®è¶…è¿‡äº†256æ¯”ç‰¹ï¼Œå³ä½¿å­˜å‚¨åœ¨äº‹ä»¶çš„ `topic` éƒ¨åˆ†ä¸­ï¼Œä¹Ÿæ˜¯ä»¥å“ˆå¸Œçš„æ–¹å¼å­˜å‚¨ã€‚å¦å¤–ï¼Œ`data` éƒ¨åˆ†çš„å˜é‡åœ¨å­˜å‚¨ä¸Šæ¶ˆè€—çš„gasç›¸æ¯”äº `topic` æ›´å°‘ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œé‡Šæ”¾äº‹ä»¶ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡ç”¨`_transfer()`å‡½æ•°è¿›è¡Œè½¬è´¦æ“ä½œçš„æ—¶å€™ï¼Œéƒ½ä¼šé‡Šæ”¾`Transfer`äº‹ä»¶ï¼Œå¹¶è®°å½•ç›¸åº”çš„å˜é‡ã€‚

```solidity
    // å®šä¹‰_transferå‡½æ•°ï¼Œæ‰§è¡Œè½¬è´¦é€»è¾‘
    function _transfer(
        address from,
        address to,
        uint256 amount
    ) external {

        _balances[from] = 10000000; // ç»™è½¬è´¦åœ°å€ä¸€äº›åˆå§‹ä»£å¸

        _balances[from] -=  amount; // fromåœ°å€å‡å»è½¬è´¦æ•°é‡
        _balances[to] += amount; // toåœ°å€åŠ ä¸Šè½¬è´¦æ•°é‡

        // é‡Šæ”¾äº‹ä»¶
        emit Transfer(from, to, amount);
    }
```



### Remix æ¼”ç¤º

ä»¥ `Event.sol` åˆçº¦ä¸ºä¾‹ï¼Œç¼–è¯‘éƒ¨ç½²ã€‚

ç„¶åè°ƒç”¨ `_transfer` å‡½æ•°ã€‚ ![img](https://www.wtf.academy/assets/images/12-1-21d3090d03ff4dbb241e5810f2177fe8.jpg)

ç‚¹å‡»å³ä¾§çš„äº¤æ˜“æŸ¥çœ‹è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—çš„å…·ä½“å†…å®¹ã€‚ ![img](https://www.wtf.academy/assets/images/12-2-4faa09c9994dc41555b86c1f023b4c38.jpg)

### åœ¨etherscanä¸ŠæŸ¥è¯¢äº‹ä»¶

æˆ‘ä»¬å°è¯•ç”¨`_transfer()`å‡½æ•°åœ¨`Rinkeby`æµ‹è¯•ç½‘ç»œä¸Šè½¬è´¦100ä»£å¸ï¼Œå¯ä»¥åœ¨`etherscan`ä¸ŠæŸ¥è¯¢åˆ°ç›¸åº”çš„`tx`ï¼š[ç½‘å€](https://rinkeby.etherscan.io/tx/0x8cf87215b23055896d93004112bbd8ab754f081b4491cb48c37592ca8f8a36c7)ã€‚

ç‚¹å‡»`Logs`æŒ‰é’®ï¼Œå°±èƒ½çœ‹åˆ°äº‹ä»¶æ˜ç»†ï¼š

![Eventæ˜ç»†](https://images.mirror-media.xyz/publication-images/gx6_wDMYEl8_Gc_JkTIKn.png?height=980&width=1772)

`Topics`é‡Œé¢æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œ`[0]`æ˜¯è¿™ä¸ªäº‹ä»¶çš„å“ˆå¸Œï¼Œ`[1]`å’Œ`[2]`æ˜¯æˆ‘ä»¬å®šä¹‰çš„ä¸¤ä¸ª`indexed`å˜é‡çš„ä¿¡æ¯ï¼Œå³è½¬è´¦çš„è½¬å‡ºåœ°å€å’Œæ¥æ”¶åœ°å€ã€‚`Data`é‡Œé¢æ˜¯å‰©ä¸‹çš„ä¸å¸¦`indexed`çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯è½¬è´¦æ•°é‡ã€‚

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨å’ŒæŸ¥è¯¢`solidity`ä¸­çš„äº‹ä»¶ã€‚å¾ˆå¤šé“¾ä¸Šåˆ†æå·¥å…·åŒ…æ‹¬`Nansen`å’Œ`Dune Analysis`éƒ½æ˜¯åŸºäºäº‹ä»¶å·¥ä½œçš„ã€‚





## ç»§æ‰¿

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»`solidity`ä¸­çš„ç»§æ‰¿ï¼ˆ`inheritance`ï¼‰ï¼ŒåŒ…æ‹¬ç®€å•ç»§æ‰¿ï¼Œå¤šé‡ç»§æ‰¿ï¼Œä»¥åŠä¿®é¥°å™¨ï¼ˆ`modifier`ï¼‰å’Œæ„é€ å‡½æ•°ï¼ˆ`constructor`ï¼‰çš„ç»§æ‰¿ã€‚

### è§„åˆ™

- `virtual`: çˆ¶åˆçº¦ä¸­çš„å‡½æ•°ï¼Œå¦‚æœå¸Œæœ›å­åˆçº¦é‡å†™ï¼Œéœ€è¦åŠ ä¸Š`virtual`å…³é”®å­—ã€‚
- `override`ï¼šå­åˆçº¦é‡å†™äº†çˆ¶åˆçº¦ä¸­çš„å‡½æ•°ï¼Œéœ€è¦åŠ ä¸Š`override`å…³é”®å­—ã€‚

### ç®€å•ç»§æ‰¿

æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„çˆ·çˆ·åˆçº¦`Yeye`ï¼Œé‡Œé¢åŒ…å«1ä¸ª`Log`äº‹ä»¶å’Œ3ä¸ª`function`: `hip()`, `pop()`, `yeye()`ï¼Œè¾“å‡ºéƒ½æ˜¯â€Yeyeâ€ã€‚

```solidity
contract Yeye {
    event Log(string msg);

    // å®šä¹‰3ä¸ªfunction: hip(), pop(), man()ï¼ŒLogå€¼ä¸ºYeyeã€‚
    function hip() public virtual{
        emit Log("Yeye");
    }

    function pop() public virtual{
        emit Log("Yeye");
    }

    function yeye() public virtual {
        emit Log("Yeye");
    }
}
```



æˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªçˆ¸çˆ¸åˆçº¦`Baba`ï¼Œè®©ä»–ç»§æ‰¿`Yeye`åˆçº¦ï¼Œè¯­æ³•å°±æ˜¯`contract Baba is Yeye`ï¼Œéå¸¸ç›´è§‚ã€‚åœ¨`Baba`åˆçº¦é‡Œï¼Œæˆ‘ä»¬é‡å†™ä¸€ä¸‹`hip()`å’Œ`pop()`è¿™ä¸¤ä¸ªå‡½æ•°ï¼ŒåŠ ä¸Š`override`å…³é”®å­—ï¼Œå¹¶å°†ä»–ä»¬çš„è¾“å‡ºæ”¹ä¸º`â€Babaâ€`ï¼›å¹¶ä¸”åŠ ä¸€ä¸ªæ–°çš„å‡½æ•°`baba`ï¼Œè¾“å‡ºä¹Ÿæ˜¯`â€Babaâ€`ã€‚

```solidity
contract Baba is Yeye{
    // ç»§æ‰¿ä¸¤ä¸ªfunction: hip()å’Œpop()ï¼Œè¾“å‡ºæ”¹ä¸ºBabaã€‚
    function hip() public virtual override{
        emit Log("Baba");
    }

    function pop() public virtual override{
        emit Log("Baba");
    }

    function baba() public virtual{
        emit Log("Baba");
    }
}
```



æˆ‘ä»¬éƒ¨ç½²åˆçº¦ï¼Œå¯ä»¥çœ‹åˆ°`Baba`åˆçº¦é‡Œæœ‰4ä¸ªå‡½æ•°ï¼Œå…¶ä¸­`hip()`å’Œ`pop()`çš„è¾“å‡ºè¢«æˆåŠŸæ”¹å†™æˆ`â€Babaâ€`ï¼Œè€Œç»§æ‰¿æ¥çš„`yeye()`çš„è¾“å‡ºä»ç„¶æ˜¯`â€Yeyeâ€`ã€‚

### å¤šé‡ç»§æ‰¿

`solidity`çš„åˆçº¦å¯ä»¥ç»§æ‰¿å¤šä¸ªåˆçº¦ã€‚è§„åˆ™ï¼š

ç»§æ‰¿æ—¶è¦æŒ‰è¾ˆåˆ†æœ€é«˜åˆ°æœ€ä½çš„é¡ºåºæ’ã€‚æ¯”å¦‚æˆ‘ä»¬å†™ä¸€ä¸ª`Erzi`åˆçº¦ï¼Œç»§æ‰¿`Yeye`åˆçº¦å’Œ`Baba`åˆçº¦ï¼Œé‚£ä¹ˆå°±è¦å†™æˆ`contract Erzi is Yeye, Baba`ï¼Œè€Œä¸èƒ½å†™æˆ`contract Erzi is Baba, Yeye`ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚ å¦‚æœæŸä¸€ä¸ªå‡½æ•°åœ¨å¤šä¸ªç»§æ‰¿çš„åˆçº¦é‡Œéƒ½å­˜åœ¨ï¼Œæ¯”å¦‚ä¾‹å­ä¸­çš„`hip()`å’Œ`pop()`ï¼Œåœ¨å­åˆçº¦é‡Œå¿…é¡»é‡å†™ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ é‡å†™åœ¨å¤šä¸ªçˆ¶åˆçº¦ä¸­éƒ½é‡åçš„å‡½æ•°æ—¶ï¼Œ`override`å…³é”®å­—åé¢è¦åŠ ä¸Šæ‰€æœ‰çˆ¶åˆçº¦åå­—ï¼Œä¾‹å¦‚`override(Yeye, Baba)`ã€‚ ä¾‹å­ï¼š

```solidity
contract Erzi is Yeye, Baba{
    // ç»§æ‰¿ä¸¤ä¸ªfunction: hip()å’Œpop()ï¼Œè¾“å‡ºå€¼ä¸ºErziã€‚
    function hip() public virtual override(Yeye, Baba){
        emit Log("Erzi");
    }

    function pop() public virtual override(Yeye, Baba) {
        emit Log("Erzi");
    }
```



æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ`Erzi`åˆçº¦é‡Œé¢é‡å†™äº†`hip()`å’Œ`pop()`ä¸¤ä¸ªå‡½æ•°ï¼Œå°†è¾“å‡ºæ”¹ä¸º`â€Erziâ€`ï¼Œå¹¶ä¸”è¿˜åˆ†åˆ«ä»`Yeye`å’Œ`Baba`åˆçº¦ç»§æ‰¿äº†`yeye()`å’Œ`baba()`ä¸¤ä¸ªå‡½æ•°ã€‚

### ä¿®é¥°å™¨çš„ç»§æ‰¿

`Solidity`ä¸­çš„ä¿®é¥°å™¨ï¼ˆ`Modifier`ï¼‰åŒæ ·å¯ä»¥ç»§æ‰¿ï¼Œç”¨æ³•ä¸å‡½æ•°ç»§æ‰¿ç±»ä¼¼ï¼Œåœ¨ç›¸åº”çš„åœ°æ–¹åŠ `virtual`å’Œ`override`å…³é”®å­—å³å¯ã€‚

```solidity
contract Base1 {
    modifier exactDividedBy2And3(uint _a) virtual {
        require(_a % 2 == 0 && _a % 3 == 0);
        _;
    }
}

contract Identifier is Base1 {

    //è®¡ç®—ä¸€ä¸ªæ•°åˆ†åˆ«è¢«2é™¤å’Œè¢«3é™¤çš„å€¼ï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯2å’Œ3çš„å€æ•°
    function getExactDividedBy2And3(uint _dividend) public exactDividedBy2And3(_dividend) pure returns(uint, uint) {
        return getExactDividedBy2And3WithoutModifier(_dividend);
    }

    //è®¡ç®—ä¸€ä¸ªæ•°åˆ†åˆ«è¢«2é™¤å’Œè¢«3é™¤çš„å€¼
    function getExactDividedBy2And3WithoutModifier(uint _dividend) public pure returns(uint, uint){
        uint div2 = _dividend / 2;
        uint div3 = _dividend / 3;
        return (div2, div3);
    }
}
```



`Identifier`åˆçº¦å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨çˆ¶åˆçº¦ä¸­çš„`exactDividedBy2And3`ä¿®é¥°å™¨ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨`override`å…³é”®å­—é‡å†™ä¿®é¥°å™¨ï¼š

```solidity
    modifier exactDividedBy2And3(uint _a) override {
        _;
        require(_a % 2 == 0 && _a % 3 == 0);
    }
```



### æ„é€ å‡½æ•°çš„ç»§æ‰¿

å­åˆçº¦æœ‰ä¸¤ç§æ–¹æ³•ç»§æ‰¿çˆ¶åˆçº¦çš„æ„é€ å‡½æ•°ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œçˆ¶åˆçº¦`A`é‡Œé¢æœ‰ä¸€ä¸ªçŠ¶æ€å˜é‡`a`ï¼Œå¹¶ç”±æ„é€ å‡½æ•°çš„å‚æ•°æ¥ç¡®å®šï¼š

```solidity
// æ„é€ å‡½æ•°çš„ç»§æ‰¿
abstract contract A {
    uint public a;

    constructor(uint _a) {
        a = _a;
    }
}
```



1. åœ¨ç»§æ‰¿æ—¶å£°æ˜çˆ¶æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š`contract B is A(1)`
2. åœ¨å­åˆçº¦çš„æ„é€ å‡½æ•°ä¸­å£°æ˜æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š

```solidity
contract C is A {
    constructor(uint _c) A(_c * _c) {}
}
```



### è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°

å­åˆçº¦æœ‰ä¸¤ç§æ–¹å¼è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å’Œåˆ©ç”¨`super`å…³é”®å­—ã€‚

1. ç›´æ¥è°ƒç”¨ï¼šå­åˆçº¦å¯ä»¥ç›´æ¥ç”¨`çˆ¶åˆçº¦å.å‡½æ•°å()`çš„æ–¹å¼æ¥è°ƒç”¨çˆ¶åˆçº¦å‡½æ•°ï¼Œä¾‹å¦‚`Yeye.pop()`ã€‚

```solidity
    function callParent() public{
        Yeye.pop();
    }
```



1. `super`å…³é”®å­—ï¼šå­åˆçº¦å¯ä»¥åˆ©ç”¨`super.å‡½æ•°å()`æ¥è°ƒç”¨æœ€è¿‘çš„çˆ¶åˆçº¦å‡½æ•°ã€‚`solidity`ç»§æ‰¿å…³ç³»æŒ‰å£°æ˜æ—¶ä»å³åˆ°å·¦çš„é¡ºåºæ˜¯ï¼š`contract Erzi is Yeye, Baba`ï¼Œé‚£ä¹ˆ`Baba`æ˜¯æœ€è¿‘çš„çˆ¶åˆçº¦ï¼Œ`super.pop()`å°†è°ƒç”¨`Baba.pop()`è€Œä¸æ˜¯`Yeye.pop()`ï¼š

```solidity
    function callParentSuper() public{
        // å°†è°ƒç”¨æœ€è¿‘çš„çˆ¶åˆçº¦å‡½æ•°ï¼ŒBaba.pop()
        super.pop();
    }
```



### åœ¨Remixä¸ŠéªŒè¯

- åˆçº¦ç®€å•ç»§æ‰¿ç¤ºä¾‹, å¯ä»¥è§‚å¯Ÿåˆ°Babaåˆçº¦å¤šäº†Yeyeçš„å‡½æ•° ![13-1](https://www.wtf.academy/assets/images/13-1-42f0a6c7cc188762c41239403eb84e8b.png)![13-2](https://www.wtf.academy/assets/images/13-2-9c0be37c4fab16f90c39580cbbead5ed.png)
- åˆçº¦å¤šé‡ç»§æ‰¿å¯ä»¥å‚è€ƒç®€å•ç»§æ‰¿çš„æ“ä½œæ­¥éª¤æ¥å¢åŠ éƒ¨ç½²Erziåˆçº¦ï¼Œç„¶åè§‚å¯Ÿæš´éœ²çš„å‡½æ•°ä»¥åŠå°è¯•è°ƒç”¨æ¥æŸ¥çœ‹æ—¥å¿—
- ä¿®é¥°å™¨ç»§æ‰¿ç¤ºä¾‹ ![13-3](https://www.wtf.academy/assets/images/13-3-7fb3ed386135bd918b84cd92949884a4.png)![13-4](https://www.wtf.academy/assets/images/13-4-c578cff17c65f768d1505da77c3cac0c.png)![13-5](https://www.wtf.academy/assets/images/13-5-58a3d5a358dbda0ffb40afb626801005.png)
- æ„é€ å‡½æ•°ç»§æ‰¿ç¤ºä¾‹ ![13-6](https://www.wtf.academy/assets/images/13-6-099cd67439dcb0194684557cc1e29289.png)![13-7](https://www.wtf.academy/assets/images/13-7-2c772dcd6711e67afd51118ae7ded35e.png)
- è°ƒç”¨çˆ¶åˆçº¦ç¤ºä¾‹ ![13-8](https://www.wtf.academy/assets/images/13-8-dcc83777980c789aec12ff8467b8d51f.png)![13-9](https://www.wtf.academy/assets/images/13-9-49f35bff8cf0343cbbce2dd8fe9d3c59.png)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ç»§æ‰¿çš„åŸºæœ¬ç”¨æ³•ï¼ŒåŒ…æ‹¬ç®€å•ç»§æ‰¿ï¼Œå¤šé‡ç»§æ‰¿ï¼Œä¿®é¥°å™¨å’Œæ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œä»¥åŠè°ƒç”¨çˆ¶åˆçº¦ä¸­çš„å‡½æ•°ã€‚





## æŠ½è±¡åˆçº¦å’Œæ¥å£

â€‹	è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ç”¨`ERC721`çš„æ¥å£åˆçº¦ä¸ºä¾‹ä»‹ç»`solidity`ä¸­çš„æŠ½è±¡åˆçº¦ï¼ˆ`abstract`ï¼‰å’Œæ¥å£ï¼ˆ`interface`ï¼‰ï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£`ERC721`æ ‡å‡†ã€‚

### æŠ½è±¡åˆçº¦

å¦‚æœä¸€ä¸ªæ™ºèƒ½åˆçº¦é‡Œè‡³å°‘æœ‰ä¸€ä¸ªæœªå®ç°çš„å‡½æ•°ï¼Œå³æŸä¸ªå‡½æ•°ç¼ºå°‘ä¸»ä½“`{}`ä¸­çš„å†…å®¹ï¼Œåˆ™å¿…é¡»å°†è¯¥åˆçº¦æ ‡ä¸º`abstract`ï¼Œä¸ç„¶ç¼–è¯‘ä¼šæŠ¥é”™ï¼›å¦å¤–ï¼Œæœªå®ç°çš„å‡½æ•°éœ€è¦åŠ `virtual`ï¼Œä»¥ä¾¿å­åˆçº¦é‡å†™ã€‚æ‹¿æˆ‘ä»¬ä¹‹å‰çš„[æ’å…¥æ’åºåˆçº¦](https://github.com/AmazingAng/WTFSolidity/tree/main/07_InsertionSort)ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è¿˜æ²¡æƒ³å¥½å…·ä½“æ€ä¹ˆå®ç°æ’å…¥æ’åºå‡½æ•°ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠåˆçº¦æ ‡ä¸º`abstract`ï¼Œä¹‹åè®©åˆ«äººè¡¥å†™ä¸Šã€‚

```solidity
abstract contract InsertionSort{
    function insertionSort(uint[] memory a) public pure virtual returns(uint[] memory);
}
```

**æ³¨æ„ï¼š**è¢«æ ‡è®°ä¸º abstract çš„åˆçº¦ä¸èƒ½è¢«éƒ¨ç½²ã€‚å› ä¸º abstract åˆçº¦æ˜¯ä¸€ç§æœªå®ç°å®Œæ•´çš„åˆçº¦ï¼Œå…¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå‡½æ•°è¢«æ ‡è®°ä¸º abstractï¼Œè¿™æ„å‘³ç€è¯¥å‡½æ•°çš„å®ç°å¿…é¡»ç”±å­åˆçº¦æä¾›ã€‚å› æ­¤ï¼Œå¦‚æœè¦éƒ¨ç½²ä¸€ä¸ª abstract åˆçº¦ï¼Œå¿…é¡»å…ˆå®ç°æ‰€æœ‰ abstract å‡½æ•°çš„å­åˆçº¦ï¼Œå¹¶åœ¨åˆçº¦éƒ¨ç½²æ—¶åŒæ—¶éƒ¨ç½²è¿™äº›å­åˆçº¦ï¼Œå¦åˆ™æ— æ³•æˆåŠŸéƒ¨ç½² abstract åˆçº¦ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­åˆçº¦å®ç°æ‰€æœ‰ abstract å‡½æ•°åï¼Œabstract åˆçº¦æ‰å¯ä»¥è¢«å®ä¾‹åŒ–ã€‚è€Œå¦‚æœä¸€ä¸ªåˆçº¦è¢«æ ‡è®°ä¸º abstractï¼Œæ„å‘³ç€å®ƒä¸ä¼šè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œä¹Ÿä¸èƒ½è¢«éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Šã€‚

### æ¥å£

æ¥å£ç±»ä¼¼äºæŠ½è±¡åˆçº¦ï¼Œä½†å®ƒä¸å®ç°ä»»ä½•åŠŸèƒ½ã€‚æ¥å£çš„è§„åˆ™ï¼š

1. ä¸èƒ½åŒ…å«çŠ¶æ€å˜é‡
2. ä¸èƒ½åŒ…å«æ„é€ å‡½æ•°
3. ä¸èƒ½ç»§æ‰¿é™¤æ¥å£å¤–çš„å…¶ä»–åˆçº¦
4. æ‰€æœ‰å‡½æ•°éƒ½å¿…é¡»æ˜¯externalä¸”ä¸èƒ½æœ‰å‡½æ•°ä½“
5. ç»§æ‰¿æ¥å£çš„åˆçº¦å¿…é¡»å®ç°æ¥å£å®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½

è™½ç„¶æ¥å£ä¸å®ç°ä»»ä½•åŠŸèƒ½ï¼Œä½†å®ƒéå¸¸é‡è¦ã€‚æ¥å£æ˜¯æ™ºèƒ½åˆçº¦çš„éª¨æ¶ï¼Œå®šä¹‰äº†åˆçº¦çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•è§¦å‘å®ƒä»¬ï¼šå¦‚æœæ™ºèƒ½åˆçº¦å®ç°äº†æŸç§æ¥å£ï¼ˆæ¯”å¦‚`ERC20`æˆ–`ERC721`ï¼‰ï¼Œå…¶ä»–Dappså’Œæ™ºèƒ½åˆçº¦å°±çŸ¥é“å¦‚ä½•ä¸å®ƒäº¤äº’ã€‚å› ä¸ºæ¥å£æä¾›äº†ä¸¤ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š

1. åˆçº¦é‡Œæ¯ä¸ªå‡½æ•°çš„`bytes4`é€‰æ‹©å™¨ï¼Œä»¥åŠåŸºäºå®ƒä»¬çš„å‡½æ•°ç­¾å`å‡½æ•°å(æ¯ä¸ªå‚æ•°ç±»å‹ï¼‰`ã€‚
2. æ¥å£idï¼ˆæ›´å¤šä¿¡æ¯è§[EIP165](https://eips.ethereum.org/EIPS/eip-165)ï¼‰

å¦å¤–ï¼Œæ¥å£ä¸åˆçº¦`ABI`ï¼ˆApplication Binary Interfaceï¼‰ç­‰ä»·ï¼Œå¯ä»¥ç›¸äº’è½¬æ¢ï¼šç¼–è¯‘æ¥å£å¯ä»¥å¾—åˆ°åˆçº¦çš„`ABI`ï¼Œåˆ©ç”¨[abi-to-solå·¥å…·](https://gnidan.github.io/abi-to-sol/)ä¹Ÿå¯ä»¥å°†`ABI json`æ–‡ä»¶è½¬æ¢ä¸º`æ¥å£sol`æ–‡ä»¶ã€‚

æˆ‘ä»¬ä»¥`ERC721`æ¥å£åˆçº¦`IERC721`ä¸ºä¾‹ï¼Œå®ƒå®šä¹‰äº†3ä¸ª`event`å’Œ9ä¸ª`function`ï¼Œæ‰€æœ‰`ERC721`æ ‡å‡†çš„NFTéƒ½å®ç°äº†è¿™äº›å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¥å£å’Œå¸¸è§„åˆçº¦çš„åŒºåˆ«åœ¨äºæ¯ä¸ªå‡½æ•°éƒ½ä»¥`;`ä»£æ›¿å‡½æ•°ä½“`{ }`ç»“å°¾ã€‚

```solidity
interface IERC721 is IERC165 {
    event Transfer(address indexed from, address indexed to, uint256 indexed tokenId);
    event Approval(address indexed owner, address indexed approved, uint256 indexed tokenId);
    event ApprovalForAll(address indexed owner, address indexed operator, bool approved);
    
    function balanceOf(address owner) external view returns (uint256 balance);

    function ownerOf(uint256 tokenId) external view returns (address owner);

    function safeTransferFrom(address from, address to, uint256 tokenId) external;

    function transferFrom(address from, address to, uint256 tokenId) external;

    function approve(address to, uint256 tokenId) external;

    function getApproved(uint256 tokenId) external view returns (address operator);

    function setApprovalForAll(address operator, bool _approved) external;

    function isApprovedForAll(address owner, address operator) external view returns (bool);

    function safeTransferFrom( address from, address to, uint256 tokenId, bytes calldata data) external;
}
```



### IERC721äº‹ä»¶

`IERC721`åŒ…å«3ä¸ªäº‹ä»¶ï¼Œå…¶ä¸­`Transfer`å’Œ`Approval`äº‹ä»¶åœ¨`ERC20`ä¸­ä¹Ÿæœ‰ã€‚

- `Transfer`äº‹ä»¶ï¼šåœ¨è½¬è´¦æ—¶è¢«é‡Šæ”¾ï¼Œè®°å½•ä»£å¸çš„å‘å‡ºåœ°å€`from`ï¼Œæ¥æ”¶åœ°å€`to`å’Œ`tokenid`ã€‚
- `Approval`äº‹ä»¶ï¼šåœ¨æˆæƒæ—¶é‡Šæ”¾ï¼Œè®°å½•æˆæƒåœ°å€`owner`ï¼Œè¢«æˆæƒåœ°å€`approved`å’Œ`tokenid`ã€‚
- `ApprovalForAll`äº‹ä»¶ï¼šåœ¨æ‰¹é‡æˆæƒæ—¶é‡Šæ”¾ï¼Œè®°å½•æ‰¹é‡æˆæƒçš„å‘å‡ºåœ°å€`owner`ï¼Œè¢«æˆæƒåœ°å€`operator`å’Œæˆæƒä¸å¦çš„`approved`ã€‚

### IERC721å‡½æ•°

- `balanceOf`ï¼šè¿”å›æŸåœ°å€çš„NFTæŒæœ‰é‡`balance`ã€‚
- `ownerOf`ï¼šè¿”å›æŸ`tokenId`çš„ä¸»äºº`owner`ã€‚
- `transferFrom`ï¼šæ™®é€šè½¬è´¦ï¼Œå‚æ•°ä¸ºè½¬å‡ºåœ°å€`from`ï¼Œæ¥æ”¶åœ°å€`to`å’Œ`tokenId`ã€‚
- `safeTransferFrom`ï¼šå®‰å…¨è½¬è´¦ï¼ˆå¦‚æœæ¥æ”¶æ–¹æ˜¯åˆçº¦åœ°å€ï¼Œä¼šè¦æ±‚å®ç°`ERC721Receiver`æ¥å£ï¼‰ã€‚å‚æ•°ä¸ºè½¬å‡ºåœ°å€`from`ï¼Œæ¥æ”¶åœ°å€`to`å’Œ`tokenId`ã€‚
- `approve`ï¼šæˆæƒå¦ä¸€ä¸ªåœ°å€ä½¿ç”¨ä½ çš„NFTã€‚å‚æ•°ä¸ºè¢«æˆæƒåœ°å€`approve`å’Œ`tokenId`ã€‚
- `getApproved`ï¼šæŸ¥è¯¢`tokenId`è¢«æ‰¹å‡†ç»™äº†å“ªä¸ªåœ°å€ã€‚
- `setApprovalForAll`ï¼šå°†è‡ªå·±æŒæœ‰çš„è¯¥ç³»åˆ—NFTæ‰¹é‡æˆæƒç»™æŸä¸ªåœ°å€`operator`ã€‚
- `isApprovedForAll`ï¼šæŸ¥è¯¢æŸåœ°å€çš„NFTæ˜¯å¦æ‰¹é‡æˆæƒç»™äº†å¦ä¸€ä¸ª`operator`åœ°å€ã€‚
- `safeTransferFrom`ï¼šå®‰å…¨è½¬è´¦çš„é‡è½½å‡½æ•°ï¼Œå‚æ•°é‡Œé¢åŒ…å«äº†`data`ã€‚

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£ï¼Ÿ

å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªåˆçº¦å®ç°äº†`IERC721`æ¥å£ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å®ƒå…·ä½“ä»£ç å®ç°ï¼Œå°±å¯ä»¥ä¸å®ƒäº¤äº’ã€‚

æ— èŠçŒ¿`BAYC`å±äº`ERC721`ä»£å¸ï¼Œå®ç°äº†`IERC721`æ¥å£çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å®ƒçš„æºä»£ç ï¼Œåªéœ€çŸ¥é“å®ƒçš„åˆçº¦åœ°å€ï¼Œç”¨`IERC721`æ¥å£å°±å¯ä»¥ä¸å®ƒäº¤äº’ï¼Œæ¯”å¦‚ç”¨`balanceOf()`æ¥æŸ¥è¯¢æŸä¸ªåœ°å€çš„`BAYC`ä½™é¢ï¼Œç”¨`safeTransferFrom()`æ¥è½¬è´¦`BAYC`ã€‚

```solidity
contract interactBAYC {
    // åˆ©ç”¨BAYCåœ°å€åˆ›å»ºæ¥å£åˆçº¦å˜é‡ï¼ˆETHä¸»ç½‘ï¼‰
    IERC721 BAYC = IERC721(0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D);

    // é€šè¿‡æ¥å£è°ƒç”¨BAYCçš„balanceOf()æŸ¥è¯¢æŒä»“é‡
    function balanceOfBAYC(address owner) external view returns (uint256 balance){
        return BAYC.balanceOf(owner);
    }

    // é€šè¿‡æ¥å£è°ƒç”¨BAYCçš„safeTransferFrom()å®‰å…¨è½¬è´¦
    function safeTransferFromBAYC(address from, address to, uint256 tokenId) external{
        BAYC.safeTransferFrom(from, to, tokenId);
    }
}
```



### åœ¨Remixä¸ŠéªŒè¯

- æŠ½è±¡åˆçº¦ç¤ºä¾‹ï¼ˆç®€å•çš„æ¼”ç¤ºä»£ç å¦‚å›¾æ‰€ç¤ºï¼‰ ![14-1](https://www.wtf.academy/assets/images/14-1-044a8470458eea92577e72cdbdd8dd24.png)
- æ¥å£ç¤ºä¾‹ï¼ˆç®€å•çš„æ¼”ç¤ºä»£ç å¦‚å›¾æ‰€ç¤ºï¼‰ ![14-2](https://www.wtf.academy/assets/images/14-2-f9d96ce31ea1e53ff8631a02022a2929.png)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»‹ç»äº†`solidity`ä¸­çš„æŠ½è±¡åˆçº¦ï¼ˆ`abstract`ï¼‰å’Œæ¥å£ï¼ˆ`interface`ï¼‰ï¼Œä»–ä»¬éƒ½å¯ä»¥å†™æ¨¡ç‰ˆå¹¶ä¸”å‡å°‘ä»£ç å†—ä½™ã€‚æˆ‘ä»¬è¿˜è®²äº†`ERC721`æ¥å£åˆçº¦`IERC721`ï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä¸æ— èŠçŒ¿`BAYC`åˆçº¦è¿›è¡Œäº¤äº’ã€‚





## å¼‚å¸¸

â€‹	ä»‹ç»`solidity`ä¸‰ç§æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼š`error`ï¼Œ`require`å’Œ`assert`ï¼Œå¹¶æ¯”è¾ƒä¸‰ç§æ–¹æ³•çš„`gas`æ¶ˆè€—ã€‚

â€‹	å†™æ™ºèƒ½åˆçº¦ç»å¸¸ä¼šå‡º`bug`ï¼Œ`solidity`ä¸­çš„å¼‚å¸¸å‘½ä»¤å¸®åŠ©æˆ‘ä»¬`debug`ã€‚

### Error

`error`æ˜¯`solidity 0.8ç‰ˆæœ¬`æ–°åŠ çš„å†…å®¹ï¼Œæ–¹ä¾¿ä¸”é«˜æ•ˆï¼ˆçœ`gas`ï¼‰åœ°å‘ç”¨æˆ·è§£é‡Šæ“ä½œå¤±è´¥çš„åŸå› ã€‚äººä»¬å¯ä»¥åœ¨`contract`ä¹‹å¤–å®šä¹‰å¼‚å¸¸ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`TransferNotOwner`å¼‚å¸¸ï¼Œå½“ç”¨æˆ·ä¸æ˜¯ä»£å¸`owner`çš„æ—¶å€™å°è¯•è½¬è´¦ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼š

```solidity
error TransferNotOwner(); // è‡ªå®šä¹‰error
```



åœ¨æ‰§è¡Œå½“ä¸­ï¼Œ`error`å¿…é¡»æ­é…`revert`ï¼ˆå›é€€ï¼‰å‘½ä»¤ä½¿ç”¨ã€‚

```solidity
    function transferOwner1(uint256 tokenId, address newOwner) public {
        if(_owners[tokenId] != msg.sender){
            revert TransferNotOwner();
        }
        _owners[tokenId] = newOwner;
    }
```



æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª`transferOwner1()`å‡½æ•°ï¼Œå®ƒä¼šæ£€æŸ¥ä»£å¸çš„`owner`æ˜¯ä¸æ˜¯å‘èµ·äººï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šæŠ›å‡º`TransferNotOwner`å¼‚å¸¸ï¼›å¦‚æœæ˜¯çš„è¯ï¼Œå°±ä¼šè½¬è´¦ã€‚



åœ¨ Solidity ä¸­ï¼ŒError å¯ä»¥å¸¦æœ‰å‚æ•°ã€‚Solidity æä¾›äº†ä¸€ç§ç§°ä¸º Error çš„ç‰¹æ®Šç±»å‹ï¼Œå¯ä»¥ç”¨äºåœ¨åˆçº¦ä¸­æŠ›å‡ºé”™è¯¯å¹¶åœ¨å¤–éƒ¨ä»£ç ä¸­æ•è·å’Œå¤„ç†ã€‚å¯ä»¥åœ¨ Error ç±»å‹ä¸­å®šä¹‰å‚æ•°ï¼Œä»¥ä¾¿åœ¨æŠ›å‡ºé”™è¯¯æ—¶æä¾›æ›´å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

```solidity
error InsufficientBalance(uint256 available, uint256 required);

function withdraw(uint256 amount) public {
    if (balance < amount) {
        revert InsufficientBalance({available: balance, required: amount});
    }
    // ...
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒInsufficientBalance æ˜¯ä¸€ä¸ª Error ç±»å‹ï¼Œå¸¦æœ‰ä¸¤ä¸ªå‚æ•° available å’Œ requiredï¼Œè¡¨ç¤ºå¯ç”¨ä½™é¢å’Œæ‰€éœ€é‡‘é¢ã€‚åœ¨ withdraw å‡½æ•°ä¸­ï¼Œå¦‚æœåˆçº¦ä½™é¢ä¸è¶³ï¼Œåˆ™ä¼šæŠ›å‡º InsufficientBalance é”™è¯¯ï¼Œå¹¶æä¾›å¯ç”¨ä½™é¢å’Œæ‰€éœ€é‡‘é¢ä½œä¸ºå‚æ•°ï¼Œä»¥ä¾¿åœ¨å¤–éƒ¨ä»£ç ä¸­æ›´å¥½åœ°ç†è§£é”™è¯¯åŸå› ã€‚



### Require

`require`å‘½ä»¤æ˜¯`solidity 0.8ç‰ˆæœ¬`ä¹‹å‰æŠ›å‡ºå¼‚å¸¸çš„å¸¸ç”¨æ–¹æ³•ï¼Œç›®å‰å¾ˆå¤šä¸»æµåˆçº¦ä»ç„¶è¿˜åœ¨ä½¿ç”¨å®ƒã€‚å®ƒå¾ˆå¥½ç”¨ï¼Œå”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯`gas`éšç€æè¿°å¼‚å¸¸çš„å­—ç¬¦ä¸²é•¿åº¦å¢åŠ ï¼Œæ¯”`error`å‘½ä»¤è¦é«˜ã€‚ä½¿ç”¨æ–¹æ³•ï¼š`require(æ£€æŸ¥æ¡ä»¶ï¼Œ"å¼‚å¸¸çš„æè¿°")`ï¼Œå½“æ£€æŸ¥æ¡ä»¶ä¸æˆç«‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

æˆ‘ä»¬ç”¨`require`å‘½ä»¤é‡å†™ä¸€ä¸‹ä¸Šé¢çš„`transferOwner`å‡½æ•°ï¼š

```solidity
    function transferOwner2(uint256 tokenId, address newOwner) public {
        require(_owners[tokenId] == msg.sender, "Transfer Not Owner");
        _owners[tokenId] = newOwner;
    }
```



### Assert

`assert`å‘½ä»¤ä¸€èˆ¬ç”¨äºç¨‹åºå‘˜å†™ç¨‹åº`debug`ï¼Œå› ä¸ºå®ƒä¸èƒ½è§£é‡ŠæŠ›å‡ºå¼‚å¸¸çš„åŸå› ï¼ˆæ¯”`require`å°‘ä¸ªå­—ç¬¦ä¸²ï¼‰ã€‚å®ƒçš„ç”¨æ³•å¾ˆç®€å•ï¼Œ`assert(æ£€æŸ¥æ¡ä»¶ï¼‰`ï¼Œå½“æ£€æŸ¥æ¡ä»¶ä¸æˆç«‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

æˆ‘ä»¬ç”¨`assert`å‘½ä»¤é‡å†™ä¸€ä¸‹ä¸Šé¢çš„`transferOwner`å‡½æ•°ï¼š

```solidity
    function transferOwner3(uint256 tokenId, address newOwner) public {
        assert(_owners[tokenId] == msg.sender);
        _owners[tokenId] = newOwner;
    }
```



### åœ¨remixä¸ŠéªŒè¯

1. è¾“å…¥ä»»æ„`uint256`æ•°å­—å’Œé0åœ°å€ï¼Œè°ƒç”¨`transferOwner1`ï¼Œä¹Ÿå°±æ˜¯`error`æ–¹æ³•ï¼Œæ§åˆ¶å°æŠ›å‡ºäº†å¼‚å¸¸å¹¶æ˜¾ç¤ºæˆ‘ä»¬è‡ªå®šä¹‰çš„`TransferNotOwner`ã€‚ ![13 1.png](https://www.wtf.academy/assets/images/15-1-108068d779547bb5f2bbe63c4e350fab.png)
2. è¾“å…¥ä»»æ„`uint256`æ•°å­—å’Œé0åœ°å€ï¼Œè°ƒç”¨`transferOwner2`ï¼Œä¹Ÿå°±æ˜¯`require`æ–¹æ³•ï¼Œæ§åˆ¶å°æŠ›å‡ºäº†å¼‚å¸¸å¹¶æ‰“å°å‡º`require`ä¸­çš„å­—ç¬¦ä¸²ã€‚ ![13 2.png](https://www.wtf.academy/assets/images/15-2-5cd86c90ad4a466946c842c346a5ee18.png)
3. è¾“å…¥ä»»æ„`uint256`æ•°å­—å’Œé0åœ°å€ï¼Œè°ƒç”¨`transferOwner3`ï¼Œä¹Ÿå°±æ˜¯`assert`æ–¹æ³•ï¼Œæ§åˆ¶å°åªæŠ›å‡ºäº†å¼‚å¸¸ã€‚ ![13 3.png](https://www.wtf.academy/assets/images/15-3-390b3562e3410dd9f6256b66e8d2610f.png)

### ä¸‰ç§æ–¹æ³•çš„gasæ¯”è¾ƒ

æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹ä¸‰ç§æŠ›å‡ºå¼‚å¸¸çš„`gas`æ¶ˆè€—ï¼Œé€šè¿‡remixæ§åˆ¶å°çš„DebugæŒ‰é’®ï¼Œèƒ½æŸ¥åˆ°æ¯æ¬¡å‡½æ•°è°ƒç”¨çš„`gas`æ¶ˆè€—åˆ†åˆ«å¦‚ä¸‹ï¼š

1. **`error`æ–¹æ³•`gas`æ¶ˆè€—**ï¼š24445
2. **`require`æ–¹æ³•`gas`æ¶ˆè€—**ï¼š24743
3. **`assert`æ–¹æ³•`gas`æ¶ˆè€—**ï¼š24446

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ`error`æ–¹æ³•`gas`æœ€å°‘ï¼Œå…¶æ¬¡æ˜¯`assert`ï¼Œ`require`æ–¹æ³•æ¶ˆè€—`gas`æœ€å¤šï¼å› æ­¤ï¼Œ`error`æ—¢å¯ä»¥å‘ŠçŸ¥ç”¨æˆ·æŠ›å‡ºå¼‚å¸¸çš„åŸå› ï¼Œåˆèƒ½çœ`gas`ï¼Œå¤§å®¶è¦å¤šç”¨ï¼ï¼ˆæ³¨æ„ï¼Œç”±äºéƒ¨ç½²æµ‹è¯•æ—¶é—´çš„ä¸åŒï¼Œæ¯ä¸ªå‡½æ•°çš„`gas`æ¶ˆè€—ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯æ¯”è¾ƒç»“æœä¼šæ˜¯ä¸€è‡´çš„ã€‚ï¼‰

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»`solidity`ä¸‰ç§æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼š`error`ï¼Œ`require`å’Œ`assert`ï¼Œå¹¶æ¯”è¾ƒäº†ä¸‰ç§æ–¹æ³•çš„`gas`æ¶ˆè€—ã€‚ç»“è®ºï¼š`error`æ—¢å¯ä»¥å‘ŠçŸ¥ç”¨æˆ·æŠ›å‡ºå¼‚å¸¸çš„åŸå› ï¼Œåˆèƒ½çœ`gas`ã€‚



## é‡è½½

`solidity`ä¸­å…è®¸å‡½æ•°è¿›è¡Œé‡è½½ï¼ˆ`overloading`ï¼‰ï¼Œå³åå­—ç›¸åŒä½†è¾“å…¥å‚æ•°ç±»å‹ä¸åŒçš„å‡½æ•°å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬è¢«è§†ä¸ºä¸åŒçš„å‡½æ•°ã€‚æ³¨æ„ï¼Œ`solidity`ä¸å…è®¸ä¿®é¥°å™¨ï¼ˆ`modifier`ï¼‰é‡è½½ã€‚

### å‡½æ•°é‡è½½

ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸¤ä¸ªéƒ½å«`saySomething()`çš„å‡½æ•°ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œè¾“å‡º`"Nothing"`ï¼›å¦ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ª`string`å‚æ•°ï¼Œè¾“å‡ºè¿™ä¸ª`string`ã€‚

```solidity
function saySomething() public pure returns(string memory){
    return("Nothing");
}

function saySomething(string memory something) public pure returns(string memory){
    return(something);
}
```



æœ€ç»ˆé‡è½½å‡½æ•°åœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åï¼Œç”±äºä¸åŒçš„å‚æ•°ç±»å‹ï¼Œéƒ½å˜æˆäº†ä¸åŒçš„å‡½æ•°é€‰æ‹©å™¨ï¼ˆselectorï¼‰ã€‚å…³äºå‡½æ•°é€‰æ‹©å™¨çš„å…·ä½“å†…å®¹å¯å‚è€ƒ[Solidityæç®€å…¥é—¨: 29. å‡½æ•°é€‰æ‹©å™¨Selector](https://github.com/AmazingAng/WTFSolidity/tree/main/29_Selector)ã€‚

ä»¥ `Overloading.sol` åˆçº¦ä¸ºä¾‹ï¼Œåœ¨ Remix ä¸Šç¼–è¯‘éƒ¨ç½²åï¼Œåˆ†åˆ«è°ƒç”¨é‡è½½å‡½æ•° `saySomething()` å’Œ `saySomething(string memory something)`ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬è¿”å›äº†ä¸åŒçš„ç»“æœï¼Œè¢«åŒºåˆ†ä¸ºä¸åŒçš„å‡½æ•°ã€‚ ![img](https://www.wtf.academy/assets/images/16-1-02e5e7643e93251800ec337e341a58a4.jpg)

### å®å‚åŒ¹é…ï¼ˆArgument Matchingï¼‰

åœ¨è°ƒç”¨é‡è½½å‡½æ•°æ—¶ï¼Œä¼šæŠŠè¾“å…¥çš„å®é™…å‚æ•°å’Œå‡½æ•°å‚æ•°çš„å˜é‡ç±»å‹åšåŒ¹é…ã€‚ å¦‚æœå‡ºç°å¤šä¸ªåŒ¹é…çš„é‡è½½å‡½æ•°ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æœ‰ä¸¤ä¸ªå«`f()`çš„å‡½æ•°ï¼Œä¸€ä¸ªå‚æ•°ä¸º`uint8`ï¼Œå¦ä¸€ä¸ªä¸º`uint256`ï¼š

```solidity
    function f(uint8 _in) public pure returns (uint8 out) {
        out = _in;
    }

    function f(uint256 _in) public pure returns (uint256 out) {
        out = _in;
    }
```



æˆ‘ä»¬è°ƒç”¨`f(50)`ï¼Œå› ä¸º`50`æ—¢å¯ä»¥è¢«è½¬æ¢ä¸º`uint8`ï¼Œä¹Ÿå¯ä»¥è¢«è½¬æ¢ä¸º`uint256`ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­å‡½æ•°é‡è½½çš„åŸºæœ¬ç”¨æ³•ï¼šåå­—ç›¸åŒä½†è¾“å…¥å‚æ•°ç±»å‹ä¸åŒçš„å‡½æ•°å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬è¢«è§†ä¸ºä¸åŒçš„å‡½æ•°ã€‚



## ABI ç¼–ç 

### ä»£ç 

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

interface IERC20 {
    function transfer(address, uint) external;
}

contract Token {
    function transfer(address, uint) external {}
}

contract AbiEncode {
    function test(address _contract, bytes calldata data) external {
        (bool ok, ) = _contract.call(data);
        require(ok, "call failed");
    }

    function encodeWithSignature(
        address to,
        uint amount
    ) external pure returns (bytes memory) {
        // Typo is not checked - "transfer(address, uint)"
        return abi.encodeWithSignature("transfer(address,uint256)", to, amount);
    }

    function encodeWithSelector(
        address to,
        uint amount
    ) external pure returns (bytes memory) {
        // Type is not checked - (IERC20.transfer.selector, true, amount)
        return abi.encodeWithSelector(IERC20.transfer.selector, to, amount);
    }

    function encodeCall(address to, uint amount) external pure returns (bytes memory) {
        // Typo and type errors will not compile
        return abi.encodeCall(IERC20.transfer, (to, amount));
    }
}
```



### æè¿°

åœ¨Solidityä¸­ï¼Œ`abi.encode`å‡½æ•°å¯ç”¨äºå°†æ•°æ®ç¼–ç ä¸ºABIï¼ˆåº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼‰æ ¼å¼ã€‚ ABIæ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„æ¥å£è§„èŒƒï¼Œç”¨äºåœ¨ä¸åŒçš„æ™ºèƒ½åˆçº¦ä¹‹é—´ä¼ é€’æ•°æ®ã€‚

åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º`AbiEncode`çš„åˆçº¦ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º`encodeData`çš„å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°-ä¸€ä¸ªæ•´æ•°å’Œä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¹¶ä½¿ç”¨`abi.encode`å°†å®ƒä»¬ç¼–ç ä¸ºABIæ ¼å¼ã€‚ç„¶åï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ª`bytes`ç±»å‹çš„ç»“æœï¼Œå…¶ä¸­åŒ…å«å·²ç¼–ç çš„æ•°æ®ã€‚

è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`abi.encodePacked`å’Œ`abi.encodeWithSignature`ç­‰å…¶ä»–ç¼–ç å‡½æ•°ï¼Œå…·ä½“å–å†³äºæ‚¨éœ€è¦å¯¹æ•°æ®æ‰§è¡Œçš„æ“ä½œã€‚





## ABI Decode

æœ¬é¡µé¢ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ JavaScript å’Œ web3.js åº“è§£ç ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦çš„ ABIï¼ˆApplication Binary Interfaceï¼‰ç¼–ç ã€‚

### ä»€ä¹ˆæ˜¯ ABIï¼Ÿ

ABI å®šä¹‰äº†æ™ºèƒ½åˆçº¦ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œé€šä¿¡çš„æ ‡å‡†æ¥å£ã€‚å®ƒè¯¦ç»†æè¿°äº†å¦‚ä½•è°ƒç”¨åˆçº¦ä¸­çš„æ¯ä¸ªå‡½æ•°ä»¥åŠå‡½æ•°å‚æ•°çš„ç±»å‹å’Œé¡ºåºã€‚é€šè¿‡ä½¿ç”¨ ABIï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸éœ€è¦è®¿é—®æºä»£ç çš„æƒ…å†µä¸‹ä¸æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚

### è§£ç  ABI ç¼–ç 

å‡è®¾æ‚¨æœ‰ä¸€ä¸ª ABI ç¼–ç çš„è¿”å›å€¼ï¼Œå¹¶ä¸”éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ˜“äºé˜…è¯»çš„æ ¼å¼ã€‚è¿™é‡Œæä¾›äº†ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œå®ƒä½¿ç”¨ web3.js åº“æ¥è§£ç  ABI ç¼–ç ï¼š

```solidity
function decodeReturnValue(returnValue, outputTypes) {
    const abiDecoder = require('abi-decoder');
    abiDecoder.addABI(JSON.parse(outputTypes));
    const decodedData = abiDecoder.decodeMethod(returnValue);
    return decodedData.params.map((param) => param.value);
}
```



è¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š

- `returnValue`ï¼šä¸€ä¸ª ABI ç¼–ç çš„è¿”å›å€¼ã€‚
- `outputTypes`ï¼šåŒ…å«å‡½æ•°è¾“å‡ºå‚æ•°ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œç¤ºä¾‹ï¼š`"[ { 'name': 'myString', 'type': 'string' }, { 'name': 'myInt', 'type': 'uint256' } ]"`ã€‚

è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«å·²è§£ç çš„å€¼ã€‚

### ç¤ºä¾‹

å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæ™ºèƒ½åˆçº¦å‡½æ•°ï¼Œè¿”å›ä»¥ä¸‹ ABI ç¼–ç çš„å­—ç¬¦ä¸²ï¼š

```solidity
0x0000000000000000000000000000000000000000000000000000000000000037
0000000000000000000000000000000000000000000000000000000000000005
48656c6c6f
```



æ­¤ç¼–ç çš„è¾“å‡ºç±»å‹ä¸ºï¼š

```solidity
[
    {
        "name": "myUint",
        "type": "uint256"
    },
    {
        "name": "myString",
        "type": "string"
    }
]
```



ä½¿ç”¨ä¸Šé¢æä¾›çš„ JavaScript å‡½æ•°ï¼Œæ‚¨å¯ä»¥å°†è¯¥ç¼–ç è§£ç å¦‚ä¸‹ï¼š

```solidity
const returnValue = "0x0000000000000000000000000000000000000000000000000000000000000037000000000000000000000000000000000000000000000000000000000000000548656c6c6f";
const outputTypes = '[
    { "name": "myUint", "type": "uint256" },
    { "name": "myString", "type": "string" }
]';
const decoded = decodeReturnValue(returnValue, outputTypes);
console.log(decoded); // [55, "Hello"]
```



ä»¥ä¸Šç¤ºä¾‹ä»£ç å°†æ‰“å°å‡º `[55, "Hello"]`ã€‚

### ç»“è®º

åœ¨ä¸ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’æ—¶ï¼Œäº†è§£ ABI æ˜¯éå¸¸é‡è¦çš„ã€‚ä½¿ç”¨ web3.js åº“å’Œä¸Šè¿°æ–¹æ³•ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°è§£ç  ABI ç¼–ç å¹¶ä¸æ™ºèƒ½åˆçº¦äº¤äº’ã€‚



## é‡è½½

`solidity`ä¸­å…è®¸å‡½æ•°è¿›è¡Œé‡è½½ï¼ˆ`overloading`ï¼‰ï¼Œå³åå­—ç›¸åŒä½†è¾“å…¥å‚æ•°ç±»å‹ä¸åŒçš„å‡½æ•°å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬è¢«è§†ä¸ºä¸åŒçš„å‡½æ•°ã€‚æ³¨æ„ï¼Œ`solidity`ä¸å…è®¸ä¿®é¥°å™¨ï¼ˆ`modifier`ï¼‰é‡è½½ã€‚

### å‡½æ•°é‡è½½

ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸¤ä¸ªéƒ½å«`saySomething()`çš„å‡½æ•°ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œè¾“å‡º`"Nothing"`ï¼›å¦ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ª`string`å‚æ•°ï¼Œè¾“å‡ºè¿™ä¸ª`string`ã€‚

```solidity
function saySomething() public pure returns(string memory){
    return("Nothing");
}

function saySomething(string memory something) public pure returns(string memory){
    return(something);
}
```



æœ€ç»ˆé‡è½½å‡½æ•°åœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åï¼Œç”±äºä¸åŒçš„å‚æ•°ç±»å‹ï¼Œéƒ½å˜æˆäº†ä¸åŒçš„å‡½æ•°é€‰æ‹©å™¨ï¼ˆselectorï¼‰ã€‚å…³äºå‡½æ•°é€‰æ‹©å™¨çš„å…·ä½“å†…å®¹å¯å‚è€ƒ[Solidityæç®€å…¥é—¨: 29. å‡½æ•°é€‰æ‹©å™¨Selector](https://github.com/AmazingAng/WTFSolidity/tree/main/29_Selector)ã€‚

ä»¥ `Overloading.sol` åˆçº¦ä¸ºä¾‹ï¼Œåœ¨ Remix ä¸Šç¼–è¯‘éƒ¨ç½²åï¼Œåˆ†åˆ«è°ƒç”¨é‡è½½å‡½æ•° `saySomething()` å’Œ `saySomething(string memory something)`ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬è¿”å›äº†ä¸åŒçš„ç»“æœï¼Œè¢«åŒºåˆ†ä¸ºä¸åŒçš„å‡½æ•°ã€‚ ![img](https://www.wtf.academy/assets/images/16-1-02e5e7643e93251800ec337e341a58a4.jpg)

### å®å‚åŒ¹é…ï¼ˆArgument Matchingï¼‰

åœ¨è°ƒç”¨é‡è½½å‡½æ•°æ—¶ï¼Œä¼šæŠŠè¾“å…¥çš„å®é™…å‚æ•°å’Œå‡½æ•°å‚æ•°çš„å˜é‡ç±»å‹åšåŒ¹é…ã€‚ å¦‚æœå‡ºç°å¤šä¸ªåŒ¹é…çš„é‡è½½å‡½æ•°ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æœ‰ä¸¤ä¸ªå«`f()`çš„å‡½æ•°ï¼Œä¸€ä¸ªå‚æ•°ä¸º`uint8`ï¼Œå¦ä¸€ä¸ªä¸º`uint256`ï¼š

```solidity
    function f(uint8 _in) public pure returns (uint8 out) {
        out = _in;
    }

    function f(uint256 _in) public pure returns (uint256 out) {
        out = _in;
    }
```

å› ä¸ºå‚æ•°ç±»å‹ä¸åŒï¼Œæ‰€ä»¥å‡½æ•°é€‰æ‹©å™¨ä¸åŒï¼Œä½†æ˜¯å½“æˆ‘ä»¬è°ƒç”¨`f(50)`æ—¶ï¼Œå› ä¸º`50`æ—¢å¯ä»¥è¢«è½¬æ¢ä¸º`uint8`ï¼Œä¹Ÿå¯ä»¥è¢«è½¬æ¢ä¸º`uint256`ï¼Œå› æ­¤ä¼šæŠ¥é”™ã€‚

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†`solidity`ä¸­å‡½æ•°é‡è½½çš„åŸºæœ¬ç”¨æ³•ï¼šåå­—ç›¸åŒä½†è¾“å…¥å‚æ•°ç±»å‹ä¸åŒçš„å‡½æ•°å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬è¢«è§†ä¸ºä¸åŒçš„å‡½æ•°ã€‚



## åº“å‡½æ•°

åº“å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆçº¦ï¼Œä¸ºäº†æå‡`solidity`ä»£ç çš„å¤ç”¨æ€§å’Œå‡å°‘`gas`è€Œå­˜åœ¨ã€‚åº“åˆçº¦ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å¥½ç”¨çš„å‡½æ•°åˆé›†ï¼ˆ`åº“å‡½æ•°`ï¼‰ï¼Œç”±å¤§ç¥æˆ–è€…é¡¹ç›®æ–¹åˆ›ä½œï¼Œå’±ä»¬ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œä¼šç”¨å°±è¡Œäº†ã€‚

![åº“åˆçº¦ï¼šç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š](https://images.mirror-media.xyz/publication-images/HJC0UjkALdrL8a2BmAE2J.jpeg?height=300&width=388)

ä»–å’Œæ™®é€šåˆçº¦ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒï¼š

1. ä¸èƒ½å­˜åœ¨çŠ¶æ€å˜é‡
2. ä¸èƒ½å¤Ÿç»§æ‰¿æˆ–è¢«ç»§æ‰¿
3. ä¸èƒ½æ¥æ”¶ä»¥å¤ªå¸
4. ä¸å¯ä»¥è¢«é”€æ¯

## Stringåº“åˆçº¦

`Stringåº“åˆçº¦`æ˜¯å°†`uint256`ç±»å‹è½¬æ¢ä¸ºç›¸åº”çš„`string`ç±»å‹çš„ä»£ç åº“ï¼Œæ ·ä¾‹ä»£ç å¦‚ä¸‹ï¼š

```solidity
library Strings {
    bytes16 private constant _HEX_SYMBOLS = "0123456789abcdef";

    /**
     * @dev Converts a `uint256` to its ASCII `string` decimal representation.
     */
    function toString(uint256 value) public pure returns (string memory) {
        // Inspired by OraclizeAPI's implementation - MIT licence
        // https://github.com/oraclize/ethereum-api/blob/b42146b063c7d6ee1358846c198246239e9360e8/oraclizeAPI_0.4.25.sol

        if (value == 0) {
            return "0";
        }
        uint256 temp = value;
        uint256 digits;
        while (temp != 0) {
            digits++;
            temp /= 10;
        }
        bytes memory buffer = new bytes(digits);
        while (value != 0) {
            digits -= 1;
            buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));
            value /= 10;
        }
        return string(buffer);
    }

    /**
     * @dev Converts a `uint256` to its ASCII `string` hexadecimal representation.
     */
    function toHexString(uint256 value) public pure returns (string memory) {
        if (value == 0) {
            return "0x00";
        }
        uint256 temp = value;
        uint256 length = 0;
        while (temp != 0) {
            length++;
            temp >>= 8;
        }
        return toHexString(value, length);
    }

    /**
     * @dev Converts a `uint256` to its ASCII `string` hexadecimal representation with fixed length.
     */
    function toHexString(uint256 value, uint256 length) public pure returns (string memory) {
        bytes memory buffer = new bytes(2 * length + 2);
        buffer[0] = "0";
        buffer[1] = "x";
        for (uint256 i = 2 * length + 1; i > 1; --i) {
            buffer[i] = _HEX_SYMBOLS[value & 0xf];
            value >>= 4;
        }
        require(value == 0, "Strings: hex length insufficient");
        return string(buffer);
    }
}
```



ä»–ä¸»è¦åŒ…å«ä¸¤ä¸ªå‡½æ•°ï¼Œ`toString()`å°†`uint256`è½¬ä¸º`string`ï¼Œ`toHexString()`å°†`uint256`è½¬æ¢ä¸º`16è¿›åˆ¶`ï¼Œåœ¨è½¬æ¢ä¸º`string`ã€‚

### å¦‚ä½•ä½¿ç”¨åº“åˆçº¦

æˆ‘ä»¬ç”¨Stringåº“å‡½æ•°çš„toHexString()æ¥æ¼”ç¤ºä¸¤ç§ä½¿ç”¨åº“åˆçº¦ä¸­å‡½æ•°çš„åŠæ³•ã€‚

**1. åˆ©ç”¨using foræŒ‡ä»¤**

æŒ‡ä»¤`using A for B;`å¯ç”¨äºé™„åŠ åº“å‡½æ•°ï¼ˆä»åº“ Aï¼‰åˆ°ä»»ä½•ç±»å‹ï¼ˆBï¼‰ã€‚æ·»åŠ å®ŒæŒ‡ä»¤åï¼Œåº“`A`ä¸­çš„å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ ä¸º`B`ç±»å‹å˜é‡çš„æˆå‘˜ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚æ³¨æ„ï¼šåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«å½“ä½œç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼š

```solidity
    // åˆ©ç”¨using foræŒ‡ä»¤
    using Strings for uint256;
    function getString1(uint256 _number) public pure returns(string memory){
        // åº“å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ ä¸ºuint256å‹å˜é‡çš„æˆå‘˜
        return _number.toHexString();
    }
```



**2. é€šè¿‡åº“åˆçº¦åç§°è°ƒç”¨åº“å‡½æ•°**

```solidity
    // ç›´æ¥é€šè¿‡åº“åˆçº¦åè°ƒç”¨
    function getString2(uint256 _number) public pure returns(string memory){
        return Strings.toHexString(_number);
    }
```



æˆ‘ä»¬éƒ¨ç½²åˆçº¦å¹¶è¾“å…¥`170`æµ‹è¯•ä¸€ä¸‹ï¼Œä¸¤ç§æ–¹æ³•å‡èƒ½è¿”å›æ­£ç¡®çš„`16è¿›åˆ¶string` â€œ0xaaâ€ã€‚è¯æ˜æˆ‘ä»¬è°ƒç”¨åº“å‡½æ•°æˆåŠŸï¼

![æˆåŠŸè°ƒç”¨åº“å‡½æ•°](https://images.mirror-media.xyz/publication-images/bzB_JDC9f5VWHRjsjQyQa.png?height=750&width=580)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ç”¨`ERC721`çš„å¼•ç”¨çš„åº“å‡½æ•°`String`ä¸ºä¾‹ä»‹ç»`solidity`ä¸­çš„åº“å‡½æ•°ï¼ˆ`Library`ï¼‰ã€‚99%çš„å¼€å‘è€…éƒ½ä¸éœ€è¦è‡ªå·±å»å†™åº“åˆçº¦ï¼Œä¼šç”¨å¤§ç¥å†™çš„å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“ä»€ä¹ˆæƒ…å†µè¯¥ç”¨ä»€ä¹ˆåº“åˆçº¦ã€‚å¸¸ç”¨çš„æœ‰ï¼š

1. [String](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Strings.sol)ï¼šå°†`uint256`è½¬æ¢ä¸º`String`
2. [Address](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Address.sol)ï¼šåˆ¤æ–­æŸä¸ªåœ°å€æ˜¯å¦ä¸ºåˆçº¦åœ°å€
3. [Create2](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Create2.sol)ï¼šæ›´å®‰å…¨çš„ä½¿ç”¨`Create2 EVM opcode`
4. [Arrays](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Arrays.sol)ï¼šè·Ÿæ•°ç»„ç›¸å…³çš„åº“å‡½æ•°



## `import`ç”¨æ³•

- é€šè¿‡æºæ–‡ä»¶ç›¸å¯¹ä½ç½®å¯¼å…¥ï¼Œä¾‹å­ï¼š

```text
æ–‡ä»¶ç»“æ„
â”œâ”€â”€ Import.sol
â””â”€â”€ Yeye.sol

// é€šè¿‡æ–‡ä»¶ç›¸å¯¹ä½ç½®import
import './Yeye.sol';
```



- é€šè¿‡æºæ–‡ä»¶ç½‘å€å¯¼å…¥ç½‘ä¸Šçš„åˆçº¦ï¼Œä¾‹å­ï¼š

```text
// é€šè¿‡ç½‘å€å¼•ç”¨
import 'https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/Address.sol';
```



- é€šè¿‡`npm`çš„ç›®å½•å¯¼å…¥ï¼Œä¾‹å­ï¼š

```solidity
import '@openzeppelin/contracts/access/Ownable.sol';
```



- é€šè¿‡`å…¨å±€ç¬¦å·`å¯¼å…¥ç‰¹å®šçš„åˆçº¦ï¼Œä¾‹å­ï¼š

```solidity
import {Yeye} from './Yeye.sol';
```



- å¼•ç”¨(`import`)åœ¨ä»£ç ä¸­çš„ä½ç½®ä¸ºï¼šåœ¨å£°æ˜ç‰ˆæœ¬å·ä¹‹åï¼Œåœ¨å…¶ä½™ä»£ç ä¹‹å‰ã€‚

### æµ‹è¯•å¯¼å…¥ç»“æœ

æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™æ®µä»£ç æµ‹è¯•æ˜¯å¦æˆåŠŸå¯¼å…¥äº†å¤–éƒ¨æºä»£ç ï¼š

```solidity
contract Import {
    // æˆåŠŸå¯¼å…¥Addressåº“
    using Address for address;
    // å£°æ˜yeyeå˜é‡
    Yeye yeye = new Yeye();

    // æµ‹è¯•æ˜¯å¦èƒ½è°ƒç”¨yeyeçš„å‡½æ•°
    function test() external{
        yeye.hip();
    }
}
```



![result](https://www.wtf.academy/assets/images/18-1-be3039b3dda4b85f9a3197fbe6102abb.png)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†åˆ©ç”¨`import`å…³é”®å­—å¯¼å…¥å¤–éƒ¨æºä»£ç çš„æ–¹æ³•ã€‚é€šè¿‡`import`å…³é”®å­—ï¼Œå¯ä»¥å¼•ç”¨æˆ‘ä»¬å†™çš„å…¶ä»–æ–‡ä»¶ä¸­çš„åˆçº¦æˆ–è€…å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¼å…¥åˆ«äººå†™å¥½çš„ä»£ç ï¼Œéå¸¸æ–¹ä¾¿ã€‚





## æ¥æ”¶ETHå‡½æ•° receive

`receive()`åªç”¨äºå¤„ç†æ¥æ”¶`ETH`ã€‚ä¸€ä¸ªåˆçº¦æœ€å¤šæœ‰ä¸€ä¸ª`receive()`å‡½æ•°ï¼Œå£°æ˜æ–¹å¼ä¸ä¸€èˆ¬å‡½æ•°ä¸ä¸€æ ·ï¼Œä¸éœ€è¦`function`å…³é”®å­—ï¼š`receive() external payable { ... }`ã€‚`receive()`å‡½æ•°ä¸èƒ½æœ‰ä»»ä½•çš„å‚æ•°ï¼Œä¸èƒ½è¿”å›ä»»ä½•å€¼ï¼Œå¿…é¡»åŒ…å«`external`å’Œ`payable`ã€‚

å½“åˆçº¦æ¥æ”¶ETHçš„æ—¶å€™ï¼Œ`receive()`ä¼šè¢«è§¦å‘ã€‚`receive()`æœ€å¥½ä¸è¦æ‰§è¡Œå¤ªå¤šçš„é€»è¾‘å› ä¸ºå¦‚æœåˆ«äººç”¨`send`å’Œ`transfer`æ–¹æ³•å‘é€`ETH`çš„è¯ï¼Œ`gas`ä¼šé™åˆ¶åœ¨`2300`ï¼Œ`receive()`å¤ªå¤æ‚å¯èƒ½ä¼šè§¦å‘`Out of Gas`æŠ¥é”™ï¼›å¦‚æœç”¨`call`å°±å¯ä»¥è‡ªå®šä¹‰`gas`æ‰§è¡Œæ›´å¤æ‚çš„é€»è¾‘ï¼ˆè¿™ä¸‰ç§å‘é€ETHçš„æ–¹æ³•æˆ‘ä»¬ä¹‹åä¼šè®²åˆ°ï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨`receive()`é‡Œå‘é€ä¸€ä¸ª`event`ï¼Œä¾‹å¦‚ï¼š

```solidity
    // å®šä¹‰äº‹ä»¶
    event Received(address Sender, uint Value);
    // æ¥æ”¶ETHæ—¶é‡Šæ”¾Receivedäº‹ä»¶
    receive() external payable {
        emit Received(msg.sender, msg.value);
    }
```



æœ‰äº›æ¶æ„åˆçº¦ï¼Œä¼šåœ¨`receive()` å‡½æ•°ï¼ˆè€ç‰ˆæœ¬çš„è¯ï¼Œå°±æ˜¯ `fallback()` å‡½æ•°ï¼‰åµŒå…¥æ¶æ„æ¶ˆè€—`gas`çš„å†…å®¹æˆ–è€…ä½¿å¾—æ‰§è¡Œæ•…æ„å¤±è´¥çš„ä»£ç ï¼Œå¯¼è‡´ä¸€äº›åŒ…å«é€€æ¬¾å’Œè½¬è´¦é€»è¾‘çš„åˆçº¦ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå› æ­¤å†™åŒ…å«é€€æ¬¾ç­‰é€»è¾‘çš„åˆçº¦æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„è¿™ç§æƒ…å†µã€‚

## å›é€€å‡½æ•° fallback

`fallback()`å‡½æ•°ä¼šåœ¨è°ƒç”¨åˆçº¦ä¸å­˜åœ¨çš„å‡½æ•°æ—¶è¢«è§¦å‘ã€‚å¯ç”¨äºæ¥æ”¶ETHï¼Œä¹Ÿå¯ä»¥ç”¨äºä»£ç†åˆçº¦`proxy contract`ã€‚`fallback()`å£°æ˜æ—¶ä¸éœ€è¦`function`å…³é”®å­—ï¼Œå¿…é¡»ç”±`external`ä¿®é¥°ï¼Œä¸€èˆ¬ä¹Ÿä¼šç”¨`payable`ä¿®é¥°ï¼Œç”¨äºæ¥æ”¶ETH:`fallback() external payable { ... }`ã€‚

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`fallback()`å‡½æ•°ï¼Œè¢«è§¦å‘æ—¶å€™ä¼šé‡Šæ”¾`fallbackCalled`äº‹ä»¶ï¼Œå¹¶è¾“å‡º`msg.sender`ï¼Œ`msg.value`å’Œ`msg.data`:

```solidity
    // fallback
    fallback() external payable{
        emit fallbackCalled(msg.sender, msg.value, msg.data);
    }
```



### receiveå’Œfallbackçš„åŒºåˆ«

`receive`å’Œ`fallback`éƒ½èƒ½å¤Ÿç”¨äºæ¥æ”¶`ETH`ï¼Œä»–ä»¬è§¦å‘çš„è§„åˆ™å¦‚ä¸‹ï¼š

```text
è§¦å‘fallback() è¿˜æ˜¯ receive()?
           æ¥æ”¶ETH
              |
         msg.dataæ˜¯ç©ºï¼Ÿ
            /  \
          æ˜¯    å¦
          /      \
receive()å­˜åœ¨?   fallback()
        / \
       æ˜¯  å¦
      /     \
receive()   fallback()
```



ç®€å•æ¥è¯´ï¼Œåˆçº¦æ¥æ”¶`ETH`æ—¶ï¼Œ`msg.data`ä¸ºç©ºä¸”å­˜åœ¨`receive()`æ—¶ï¼Œä¼šè§¦å‘`receive()`ï¼›`msg.data`ä¸ä¸ºç©ºæˆ–ä¸å­˜åœ¨`receive()`æ—¶ï¼Œä¼šè§¦å‘`fallback()`ï¼Œæ­¤æ—¶`fallback()`å¿…é¡»ä¸º`payable`ã€‚

`receive()`å’Œ`payable fallback()`å‡ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå‘åˆçº¦**ç›´æ¥**å‘é€`ETH`å°†ä¼šæŠ¥é”™ï¼ˆä½ ä»å¯ä»¥é€šè¿‡å¸¦æœ‰`payable`çš„å‡½æ•°å‘åˆçº¦å‘é€`ETH`ï¼‰ã€‚

### Remix æ¼”ç¤º

1. é¦–å…ˆåœ¨ Remix ä¸Šéƒ¨ç½²åˆçº¦ "Fallback.sol"ã€‚
2. "VALUE" æ ä¸­å¡«å…¥è¦å‘é€ç»™åˆçº¦çš„é‡‘é¢ï¼ˆå•ä½æ˜¯ Weiï¼‰ï¼Œç„¶åç‚¹å‡» "Transact"ã€‚![img](https://www.wtf.academy/assets/images/19-1-4ba34e6d9cbb74a98a3c8affd59bc583.jpg)
3. å¯ä»¥çœ‹åˆ°äº¤æ˜“æˆåŠŸï¼Œå¹¶ä¸”è§¦å‘äº† "receivedCalled" äº‹ä»¶ã€‚![img](https://www.wtf.academy/assets/images/19-2-b933741438ce18210739446f85b8e3c4.jpg)
4. "VALUE" æ ä¸­å¡«å…¥è¦å‘é€ç»™åˆçº¦çš„é‡‘é¢ï¼ˆå•ä½æ˜¯ Weiï¼‰ï¼Œ"CALLDATA" æ ä¸­å¡«å…¥éšæ„ç¼–å†™çš„`msg.data`ï¼Œç„¶åç‚¹å‡» "Transact"ã€‚ ![img](https://www.wtf.academy/assets/images/19-3-83c411c3270d886d6ea0535c4cc9660d.jpg)
5. å¯ä»¥çœ‹åˆ°äº¤æ˜“æˆåŠŸï¼Œå¹¶ä¸”è§¦å‘äº† "fallbackCalled" äº‹ä»¶ã€‚![img](https://www.wtf.academy/assets/images/19-4-a6bbcb103838f43fe8987b95606b8e27.jpg)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»‹ç»äº†`Solidity`ä¸­çš„ä¸¤ç§ç‰¹æ®Šå‡½æ•°ï¼Œ`receive()`å’Œ`fallback()`ï¼Œä»–ä»¬ä¸»è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹è¢«ä½¿ç”¨ï¼Œä»–ä»¬ä¸»è¦ç”¨äºå¤„ç†æ¥æ”¶`ETH`å’Œä»£ç†åˆçº¦`proxy contract`ã€‚

## å‘é€ETH

### æ¥æ”¶ETHåˆçº¦

æˆ‘ä»¬å…ˆéƒ¨ç½²ä¸€ä¸ªæ¥æ”¶`ETH`åˆçº¦`ReceiveETH`ã€‚`ReceiveETH`åˆçº¦é‡Œæœ‰ä¸€ä¸ªäº‹ä»¶`Log`ï¼Œè®°å½•æ”¶åˆ°çš„`ETH`æ•°é‡å’Œ`gas`å‰©ä½™ã€‚è¿˜æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯`receive()`å‡½æ•°ï¼Œæ”¶åˆ°`ETH`è¢«è§¦å‘ï¼Œå¹¶å‘é€`Log`äº‹ä»¶ï¼›å¦ä¸€ä¸ªæ˜¯æŸ¥è¯¢åˆçº¦`ETH`ä½™é¢çš„`getBalance()`å‡½æ•°ã€‚

```solidity
contract ReceiveETH {
    // æ”¶åˆ°ethäº‹ä»¶ï¼Œè®°å½•amountå’Œgas
    event Log(uint amount, uint gas);
    
    // receiveæ–¹æ³•ï¼Œæ¥æ”¶ethæ—¶è¢«è§¦å‘
    receive() external payable{
        emit Log(msg.value, gasleft());
    }
    
    // è¿”å›åˆçº¦ETHä½™é¢
    function getBalance() view public returns(uint) {
        return address(this).balance;
    }
}
```



éƒ¨ç½²`ReceiveETH`åˆçº¦åï¼Œè¿è¡Œ`getBalance()`å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰åˆçº¦çš„`ETH`ä½™é¢ä¸º`0`ã€‚

![20-1](https://www.wtf.academy/assets/images/20-1-b18baa5867c909e527eca6852945ad46.png)

### å‘é€ETHåˆçº¦

æˆ‘ä»¬å°†å®ç°ä¸‰ç§æ–¹æ³•å‘`ReceiveETH`åˆçº¦å‘é€`ETH`ã€‚é¦–å…ˆï¼Œå…ˆåœ¨å‘é€ETHåˆçº¦`SendETH`ä¸­å®ç°`payable`çš„`æ„é€ å‡½æ•°`å’Œ`receive()`ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨éƒ¨ç½²æ—¶å’Œéƒ¨ç½²åå‘åˆçº¦è½¬è´¦ã€‚

```solidity
contract SendETH {
    // æ„é€ å‡½æ•°ï¼Œpayableä½¿å¾—éƒ¨ç½²çš„æ—¶å€™å¯ä»¥è½¬ethè¿›å»
    constructor() payable{}
    // receiveæ–¹æ³•ï¼Œæ¥æ”¶ethæ—¶è¢«è§¦å‘
    receive() external payable{}
}
```



### transfer

- ç”¨æ³•æ˜¯`æ¥æ”¶æ–¹åœ°å€.transfer(å‘é€ETHæ•°é¢)`ã€‚
- `transfer()`çš„`gas`é™åˆ¶æ˜¯`2300`ï¼Œè¶³å¤Ÿç”¨äºè½¬è´¦ï¼Œä½†å¯¹æ–¹åˆçº¦çš„`fallback()`æˆ–`receive()`å‡½æ•°ä¸èƒ½å®ç°å¤ªå¤æ‚çš„é€»è¾‘ã€‚
- `transfer()`å¦‚æœè½¬è´¦å¤±è´¥ï¼Œä¼šè‡ªåŠ¨`revert`ï¼ˆå›æ»šäº¤æ˜“ï¼‰ã€‚

ä»£ç æ ·ä¾‹ï¼Œæ³¨æ„é‡Œé¢çš„`_to`å¡«`ReceiveETH`åˆçº¦çš„åœ°å€ï¼Œ`amount`æ˜¯`ETH`è½¬è´¦é‡‘é¢ï¼š

```solidity
// ç”¨transfer()å‘é€ETH
function transferETH(address payable _to, uint256 amount) external payable{
    _to.transfer(amount);
}
```



éƒ¨ç½²`SendETH`åˆçº¦åï¼Œå¯¹`ReceiveETH`åˆçº¦å‘é€ETHï¼Œæ­¤æ—¶`amount`ä¸º10ï¼Œ`value`ä¸º0ï¼Œ`amount`>`value`ï¼Œè½¬è´¦å¤±è´¥ï¼Œå‘ç”Ÿ`revert`ã€‚

![20-2](https://www.wtf.academy/assets/images/20-2-572c8ac0dfa42d4ea7fc62de0ff1c5af.png)

æ­¤æ—¶`amount`ä¸º10ï¼Œ`value`ä¸º10ï¼Œ`amount`<=`value`ï¼Œè½¬è´¦æˆåŠŸã€‚

![20-3](https://www.wtf.academy/assets/images/20-3-c48a1c9f41ff2a53095bbf4d0b7767b7.png)

åœ¨`ReceiveETH`åˆçº¦ä¸­ï¼Œè¿è¡Œ`getBalance()`å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰åˆçº¦çš„`ETH`ä½™é¢ä¸º`10`ã€‚

![20-4](data:image/png;base64,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)

### send

- ç”¨æ³•æ˜¯`æ¥æ”¶æ–¹åœ°å€.send(å‘é€ETHæ•°é¢)`ã€‚
- `send()`çš„`gas`é™åˆ¶æ˜¯`2300`ï¼Œè¶³å¤Ÿç”¨äºè½¬è´¦ï¼Œä½†å¯¹æ–¹åˆçº¦çš„`fallback()`æˆ–`receive()`å‡½æ•°ä¸èƒ½å®ç°å¤ªå¤æ‚çš„é€»è¾‘ã€‚
- `send()`å¦‚æœè½¬è´¦å¤±è´¥ï¼Œä¸ä¼š`revert`ã€‚
- `send()`çš„è¿”å›å€¼æ˜¯`bool`ï¼Œä»£è¡¨ç€è½¬è´¦æˆåŠŸæˆ–å¤±è´¥ï¼Œéœ€è¦é¢å¤–ä»£ç å¤„ç†ä¸€ä¸‹ã€‚

ä»£ç æ ·ä¾‹ï¼š

```solidity
// send()å‘é€ETH
function sendETH(address payable _to, uint256 amount) external payable{
    // å¤„ç†ä¸‹sendçš„è¿”å›å€¼ï¼Œå¦‚æœå¤±è´¥ï¼Œrevertäº¤æ˜“å¹¶å‘é€error
    bool success = _to.send(amount);
    if(!success){
        revert SendFailed();
    }
}
```



å¯¹`ReceiveETH`åˆçº¦å‘é€ETHï¼Œæ­¤æ—¶`amount`ä¸º10ï¼Œ`value`ä¸º0ï¼Œ`amount`>`value`ï¼Œè½¬è´¦å¤±è´¥ï¼Œå› ä¸ºç»è¿‡å¤„ç†ï¼Œæ‰€ä»¥å‘ç”Ÿ`revert`ã€‚

![20-5](https://www.wtf.academy/assets/images/20-5-cb457285c7185c438995bfcc95b6a01d.png)

æ­¤æ—¶`amount`ä¸º10ï¼Œ`value`ä¸º11ï¼Œ`amount`<=`value`ï¼Œè½¬è´¦æˆåŠŸã€‚

![20-6](https://www.wtf.academy/assets/images/20-6-1ae2f81d902c618059d813e5b16cbe4c.png)

### call

- ç”¨æ³•æ˜¯`æ¥æ”¶æ–¹åœ°å€.call{value: å‘é€ETHæ•°é¢}("")`ã€‚
- `call()`æ²¡æœ‰`gas`é™åˆ¶ï¼Œå¯ä»¥æ”¯æŒå¯¹æ–¹åˆçº¦`fallback()`æˆ–`receive()`å‡½æ•°å®ç°å¤æ‚é€»è¾‘ã€‚
- `call()`å¦‚æœè½¬è´¦å¤±è´¥ï¼Œä¸ä¼š`revert`ã€‚
- `call()`çš„è¿”å›å€¼æ˜¯`(bool, data)`ï¼Œå…¶ä¸­`bool`ä»£è¡¨ç€è½¬è´¦æˆåŠŸæˆ–å¤±è´¥ï¼Œéœ€è¦é¢å¤–ä»£ç å¤„ç†ä¸€ä¸‹ã€‚

ä»£ç æ ·ä¾‹ï¼š

```solidity
// call()å‘é€ETH
function callETH(address payable _to, uint256 amount) external payable{
    // å¤„ç†ä¸‹callçš„è¿”å›å€¼ï¼Œå¦‚æœå¤±è´¥ï¼Œrevertäº¤æ˜“å¹¶å‘é€error
    (bool success,) = _to.call{value: amount}("");
    if(!success){
        revert CallFailed();
    }
}
```



å¯¹`ReceiveETH`åˆçº¦å‘é€ETHï¼Œæ­¤æ—¶`amount`ä¸º10ï¼Œ`value`ä¸º0ï¼Œ`amount`>`value`ï¼Œè½¬è´¦å¤±è´¥ï¼Œå› ä¸ºç»è¿‡å¤„ç†ï¼Œæ‰€ä»¥å‘ç”Ÿ`revert`ã€‚

![20-7](https://www.wtf.academy/assets/images/20-7-bbfe1e7134676767c0a6c9612165ea9e.png)

æ­¤æ—¶`amount`ä¸º10ï¼Œ`value`ä¸º11ï¼Œ`amount`<=`value`ï¼Œè½¬è´¦æˆåŠŸã€‚

![20-8](https://www.wtf.academy/assets/images/20-8-5c25a6d4556ce624ff27752f24e85d4a.png)

è¿è¡Œä¸‰ç§æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä»–ä»¬éƒ½å¯ä»¥æˆåŠŸåœ°å‘`ReceiveETH`åˆçº¦å‘é€`ETH`ã€‚

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»`solidity`ä¸‰ç§å‘é€`ETH`çš„æ–¹æ³•ï¼š`transfer`ï¼Œ`send`å’Œ`call`ã€‚

- `call`æ²¡æœ‰`gas`é™åˆ¶ï¼Œæœ€ä¸ºçµæ´»ï¼Œæ˜¯æœ€æå€¡çš„æ–¹æ³•ï¼›
- `transfer`æœ‰`2300 gas`é™åˆ¶ï¼Œä½†æ˜¯å‘é€å¤±è´¥ä¼šè‡ªåŠ¨`revert`äº¤æ˜“ï¼Œæ˜¯æ¬¡ä¼˜é€‰æ‹©ï¼›
- `send`æœ‰`2300 gas`é™åˆ¶ï¼Œè€Œä¸”å‘é€å¤±è´¥ä¸ä¼šè‡ªåŠ¨`revert`äº¤æ˜“ï¼Œå‡ ä¹æ²¡æœ‰äººç”¨å®ƒã€‚





## è°ƒç”¨å·²éƒ¨ç½²åˆçº¦

å¼€å‘è€…å†™æ™ºèƒ½åˆçº¦æ¥è°ƒç”¨å…¶ä»–åˆçº¦ï¼Œè¿™è®©ä»¥å¤ªåŠç½‘ç»œä¸Šçš„ç¨‹åºå¯ä»¥å¤ç”¨ï¼Œä»è€Œå»ºç«‹ç¹è£çš„ç”Ÿæ€ã€‚å¾ˆå¤š`web3`é¡¹ç›®ä¾èµ–äºè°ƒç”¨å…¶ä»–åˆçº¦ï¼Œæ¯”å¦‚æ”¶ç›Šå†œåœºï¼ˆ`yield farming`ï¼‰ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»å¦‚ä½•åœ¨å·²çŸ¥åˆçº¦ä»£ç ï¼ˆæˆ–æ¥å£ï¼‰å’Œåœ°å€æƒ…å†µä¸‹è°ƒç”¨ç›®æ ‡åˆçº¦çš„å‡½æ•°ã€‚

### ç›®æ ‡åˆçº¦

æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„åˆçº¦`OtherContract`æ¥è°ƒç”¨ã€‚

```solidity
contract OtherContract {
    uint256 private _x = 0; // çŠ¶æ€å˜é‡_x
    // æ”¶åˆ°ethçš„äº‹ä»¶ï¼Œè®°å½•amountå’Œgas
    event Log(uint amount, uint gas);
    
    // è¿”å›åˆçº¦ETHä½™é¢
    function getBalance() view public returns(uint) {
        return address(this).balance;
    }

    // å¯ä»¥è°ƒæ•´çŠ¶æ€å˜é‡_xçš„å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥å¾€åˆçº¦è½¬ETH (payable)
    function setX(uint256 x) external payable{
        _x = x;
        // å¦‚æœè½¬å…¥ETHï¼Œåˆ™é‡Šæ”¾Logäº‹ä»¶
        if(msg.value > 0){
            emit Log(msg.value, gasleft());
        }
    }

    // è¯»å–_x
    function getX() external view returns(uint x){
        x = _x;
    }
}
```



è¿™ä¸ªåˆçº¦åŒ…å«ä¸€ä¸ªçŠ¶æ€å˜é‡`_x`ï¼Œä¸€ä¸ªäº‹ä»¶`Log`åœ¨æ”¶åˆ°`ETH`æ—¶è§¦å‘ï¼Œä¸‰ä¸ªå‡½æ•°ï¼š

- `getBalance()`: è¿”å›åˆçº¦`ETH`ä½™é¢ã€‚
- `setX()`: `external payable`å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®`_x`çš„å€¼ï¼Œå¹¶å‘åˆçº¦å‘é€`ETH`ã€‚
- `getX()`: è¯»å–`_x`çš„å€¼ã€‚

### è°ƒç”¨`OtherContract`åˆçº¦

æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åˆçº¦çš„åœ°å€å’Œåˆçº¦ä»£ç ï¼ˆæˆ–æ¥å£ï¼‰æ¥åˆ›å»ºåˆçº¦çš„å¼•ç”¨ï¼š`_Name(_Address)`ï¼Œå…¶ä¸­`_Name`æ˜¯åˆçº¦åï¼Œ`_Address`æ˜¯åˆçº¦åœ°å€ã€‚ç„¶åç”¨åˆçº¦çš„å¼•ç”¨æ¥è°ƒç”¨å®ƒçš„å‡½æ•°ï¼š`_Name(_Address).f()`ï¼Œå…¶ä¸­`f()`æ˜¯è¦è°ƒç”¨çš„å‡½æ•°ã€‚

ä¸‹é¢æˆ‘ä»¬ä»‹ç»4ä¸ªè°ƒç”¨åˆçº¦çš„ä¾‹å­ï¼Œåœ¨remixä¸­ç¼–è¯‘åˆçº¦åï¼Œåˆ†åˆ«éƒ¨ç½²`OtherContract`å’Œ`CallContract`ï¼š

![deploy contract0 in remix](https://www.wtf.academy/assets/images/21-1-9c522c370dfc53d1a0c273716f949c9e.png)

![deploy contract1 in remix](https://www.wtf.academy/assets/images/21-2-a3c672e6dca937bf09dc3dfe5a421534.png)

![deploy contract2 in remix](https://www.wtf.academy/assets/images/21-3-dd0cfc401d8462761c9b740ec21aa994.png)

#### 1. ä¼ å…¥åˆçº¦åœ°å€

æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œä¼ å…¥ç›®æ ‡åˆçº¦åœ°å€ï¼Œç”Ÿæˆç›®æ ‡åˆçº¦çš„å¼•ç”¨ï¼Œç„¶åè°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚ä»¥è°ƒç”¨`OtherContract`åˆçº¦çš„`setX`å‡½æ•°ä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨æ–°åˆçº¦ä¸­å†™ä¸€ä¸ª`callSetX`å‡½æ•°ï¼Œä¼ å…¥å·²éƒ¨ç½²å¥½çš„`OtherContract`åˆçº¦åœ°å€`_Address`å’Œ`setX`çš„å‚æ•°`x`ï¼š

```solidity
    function callSetX(address _Address, uint256 x) external{
        OtherContract(_Address).setX(x);
    }
```



å¤åˆ¶`OtherContract`åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥`callSetX`å‡½æ•°çš„å‚æ•°ä¸­ï¼ŒæˆåŠŸè°ƒç”¨åï¼Œè°ƒç”¨`OtherContract`åˆçº¦ä¸­çš„`getX`éªŒè¯`x`å˜ä¸º123

![call contract1 in remix](https://www.wtf.academy/assets/images/21-4-89e705ffc18c8f90063c922e7504b31e.png)

![call contract2 in remix](https://www.wtf.academy/assets/images/21-5-52866e87f467b4ebad52d6d00d4d2744.png)

#### 2. ä¼ å…¥åˆçº¦å˜é‡

æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å‡½æ•°é‡Œä¼ å…¥åˆçº¦çš„å¼•ç”¨ï¼Œåªéœ€è¦æŠŠä¸Šé¢å‚æ•°çš„`address`ç±»å‹æ”¹ä¸ºç›®æ ‡åˆçº¦åï¼Œæ¯”å¦‚`OtherContract`ã€‚ä¸‹é¢ä¾‹å­å®ç°äº†è°ƒç”¨ç›®æ ‡åˆçº¦çš„`getX()`å‡½æ•°ã€‚

**æ³¨æ„**è¯¥å‡½æ•°å‚æ•°`OtherContract _Address`åº•å±‚ç±»å‹ä»ç„¶æ˜¯`address`ï¼Œç”Ÿæˆçš„`ABI`ä¸­ã€è°ƒç”¨`callGetX`æ—¶ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯`address`ç±»å‹

```solidity
    function callGetX(OtherContract _Address) external view returns(uint x){
        x = _Address.getX();
    }
```



å¤åˆ¶`OtherContract`åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥`callGetX`å‡½æ•°çš„å‚æ•°ä¸­ï¼Œè°ƒç”¨åæˆåŠŸè·å–`x`çš„å€¼

![call contract3 in remix](https://www.wtf.academy/assets/images/21-6-615b6ab5f73c18a1c4a7a7d0be5f7228.png)

#### 3. åˆ›å»ºåˆçº¦å˜é‡

æˆ‘ä»¬å¯ä»¥åˆ›å»ºåˆçº¦å˜é‡ï¼Œç„¶åé€šè¿‡å®ƒæ¥è°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚ä¸‹é¢ä¾‹å­ï¼Œæˆ‘ä»¬ç»™å˜é‡`oc`å­˜å‚¨äº†`OtherContract`åˆçº¦çš„å¼•ç”¨ï¼š

```solidity
    function callGetX2(address _Address) external view returns(uint x){
        OtherContract oc = OtherContract(_Address);
        x = oc.getX();
    }
```



å¤åˆ¶`OtherContract`åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥`callGetX2`å‡½æ•°çš„å‚æ•°ä¸­ï¼Œè°ƒç”¨åæˆåŠŸè·å–`x`çš„å€¼

![call contract4 in remix](https://www.wtf.academy/assets/images/21-7-ab9a5e3d84b27006392eb368b1e93d2d.png)

#### 4. è°ƒç”¨åˆçº¦å¹¶å‘é€`ETH`

å¦‚æœç›®æ ‡åˆçº¦çš„å‡½æ•°æ˜¯`payable`çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å®ƒæ¥ç»™åˆçº¦è½¬è´¦ï¼š`_Name(_Address).f{value: _Value}()`ï¼Œå…¶ä¸­`_Name`æ˜¯åˆçº¦åï¼Œ`_Address`æ˜¯åˆçº¦åœ°å€ï¼Œ`f`æ˜¯ç›®æ ‡å‡½æ•°åï¼Œ`_Value`æ˜¯è¦è½¬çš„`ETH`æ•°é¢ï¼ˆä»¥`wei`ä¸ºå•ä½ï¼‰ã€‚

`OtherContract`åˆçº¦çš„`setX`å‡½æ•°æ˜¯`payable`çš„ï¼Œåœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬é€šè¿‡è°ƒç”¨`setX`æ¥å¾€ç›®æ ‡åˆçº¦è½¬è´¦ã€‚

```solidity
    function setXTransferETH(address otherContract, uint256 x) payable external{
        OtherContract(otherContract).setX{value: msg.value}(x);
    }
```



å¤åˆ¶`OtherContract`åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥`setXTransferETH`å‡½æ•°çš„å‚æ•°ä¸­ï¼Œå¹¶è½¬å…¥10ETH

![call contract5 in remix](https://www.wtf.academy/assets/images/21-8-3566ee52a32b536dded77112c6599bdb.png)

è½¬è´¦åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`Log`äº‹ä»¶å’Œ`getBalance()`å‡½æ•°è§‚å¯Ÿç›®æ ‡åˆçº¦`ETH`ä½™é¢çš„å˜åŒ–ã€‚

![call contract6 in remix](https://www.wtf.academy/assets/images/21-9-d90c3bad37dd4d77acbd2ea8b695242e.png)

### æ€»ç»“

è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•é€šè¿‡ç›®æ ‡åˆçº¦ä»£ç ï¼ˆæˆ–æ¥å£ï¼‰å’Œåœ°å€æ¥åˆ›å»ºåˆçº¦çš„å¼•ç”¨ï¼Œä»è€Œè°ƒç”¨ç›®æ ‡åˆçº¦çš„å‡½æ•°ã€‚



