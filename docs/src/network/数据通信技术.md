# 网络数据通信技术

## 计算机的诞生

1946年2月14日ENIAC诞生

## 计算机网络的诞生

1969年APNET诞生

## 不同网络之间的互联

由于网络标准不一样无法完成互联

# OSI模型

## OSI模型的由来

​	计算机--各种不同标准的计算机网络---把不同标准的网络互连  就出现了OSI模型

​	问题：不同标准的局域网无法互相连接在一起

​	解决：制定一个统一的网络标准，所有网络都要执行。

​				国际标准化组织（ISO）制定了OSI模型

## 分层思想

​	将复杂的流程分解，复杂问题简单化

​	更容易发现问题并针对性解决

​	一个计算机网络主要分为七层，从下往上依次是：物理层，数据链路层，网络层，传输层，会话层，表示层，应用层

## OSI参考模型

国际标准化组织（International Standard Organization,ISO）于1984年颁布开放系统互联（Open System Interconnection ， OSI）参考模型

它规定将网络分为七层，从下往上依次是：物理层，数据链路层，网络层，传输层，会话层，表示层，应用层

### OSI七层模型每层的作用（理解每层的功能）

| 7    | 应用层     | 应用层软件                         |
| ---- | ---------- | ---------------------------------- |
| 6    | 表示层     | 对数据进行处理（加密，压缩）       |
| 5    | 会话层     | 建立，管理，终止会话               |
| 4    | 传输层     | 端口号，传输方式（可靠或不可靠）   |
| 3    | 网络层     | IP地址，路由选择                   |
| 2    | 数据链路层 | MAC地址，帧校验                    |
| 1    | 物理层     | 传输介质（电线，网线，光纤，无线） |

![image-20220912160808882](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220912160808882.png)

端口号：每个主机上都有很多个端口，每个端口代表不同的服务

1-65535个，1-1024是常用端口。



# TCP/IP模型

产生背景：

​		1969网络诞生

​		1984年制定了OSI模型 

​		这15年间网络也互联了

​		厂商之间自发形成了还一个互联网络的标准 ：TCP/IP模型

OSI模型只是一个理论上的模型，从来没有被实际使用过

TCP/IP模型是一个实际使用的模型

## 分层方式

​	TCP/IP 四层模型

​		应用层（应用层，表示层，会话层）

​		传输层

​		网络层

​		网络接口层（物理层，数据链路层）

​	TCP/IP 五层模型

​		应用层（应用层，表示层，会话层）HTTP，FTP，SMTP，TELNET

​		传输层	TCP,UDP

​		网络层	IP，ICMP，ARP，OSPF

​		数据链路层

​		物理层

# TCP/IP协议簇的组成

## 网络层

IP协议：互联网协议，定义了网络层地址

ICMP协议：网络控制协议，探测网络连接情况

ARP协议：地址解析协议，把IP地址解析为MAC地址

OSPF协议：开放式最短路径优先协议（路由协议）

## 传输层

TCP：传输控制协议，面向连接的可靠传输协议，传输速度慢

UDP：用户数据报协议，面向非连接的不可靠传输协议，传输速度快

![image-20220912163331220](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220912163331220.png)

## 数据链路层

FCS：帧校验序列

## 应用层

HTTP：超文本传输协议，端口80

FTP：文件传输协议，端口20,21

TFTP：简单文件传输协议，端口69

DHCP：动态主机配置协议，端口67,68



# 数据封装过程

![image-20220912163855925](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220912163855925.png)

封装数据，每层为数据添加报头或报尾

应用层：数据  --数据   data

传输层：TCP或UDP报头+数据  --数据段  segment

网络层：IP报头+TCP或UDP报头+数据  -- 数据包  packet

数据链路层：MAC头部+IP报头+TCP或UDP报头+数据+报尾  -- 数据帧 frame

物理层：比特流 bit

PDU（协议数据单元）=报头或报尾+数据

protocol data unit

# 数据解封装的过程

![image-20220912164148734](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220912164148734.png)

# 设备与层的对应关系

![image-20220912165014898](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220912165014898.png)

# 网络通信原理

## 物理层

物理层是TCP/IP模型的最底层

物理层为数据传输提供可靠环境

### 功能

数据转换成1和0进行传输

数据传输是否可同时在两个方向上进行，全双工模式

### 物理层介质

#### 有线介质

##### 双绞线：

​	cat5类  utp(非屏蔽双绞线)

​	T568B ----T568B 直通线  不同设备

​	T568A ----T568B 交叉线  相同设备

同轴电缆

##### 光纤

​	单模和多模

#### 无线

​	电磁波

​	光（激光或红外线）

### 设备

##### 网卡

​	网络接口卡

​	网络信号转换器

##### 中继器

​	能放大电信号，延长网络信号传输距离

​	只包含一个输入输出端口

##### 集线器  hub

​	多端口的中继器,为多台电脑放大信号，同时可以组件局域网。

​	支持不同的传输介质和速率

​	缺点：

​	多台设备共享带宽，网络速率较慢

​	已经被交换机取代

## 数据链路层

位于网络层与物理层之间

### 功能

​	数据链路的建立，维护与拆除

​	帧形成，帧传输，帧同步

​	帧的差错恢复和流量控制

协议

​	Ethernet以太网

​	PPP，HCLC，Frame-relay，ATM

![image-20220914142326177](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220914142326177.png)

### 以太网地址（MAC）

MAC地址用来标识以太网上唯一的一个设备

前24比特表示供应商标识

后24位标识供应商对应的唯一网卡编号

第八位对于目的地址

0-物理地址（单播地址）

1-逻辑地址（组播地址）

例：**00E0.FC**39.8034

发送数据的方式：

​	--单播：一对一

​	--组播：一对多

​	--广播：一对所有

#### 更改MAC地址：

​	逻辑更改

![image-20220914143411536](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220914143411536.png)

#### 查看MAC地址：

ipconfi /all



### 数据帧的封装格式

![image-20220914143602684](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220914143602684.png)

| 目的地址 | 源地址 | 类型  | 数据        | 帧校验序列 |
| -------- | ------ | ----- | ----------- | ---------- |
| 6字节    | 6字节  | 2字节 | 46-1500字节 | 4字节      |

目的地址：目标主机的MAC地址

源地址：发送方主机的MAC地址

类型：网络层使用了哪种协议对数据进行了封装（IP，ICMP，ARP）

帧校验序列：验证数据完整性的数值

数据：最小为46，不够会被填充到46，最大不能超过1500字节。

#### 以太网数据帧的大小范围：

​	报头（14字节）+数据（46-1500字节）+报尾（4字节）

​	**64字节<以太网数据帧<1518字节**



## 网络层

### 作用

​	定义网络设备的逻辑地址，俗称网络层地址（IP地址）

​	在不同的网段之间选择最佳数据转发路径

### 协议

​	IP，IPX，AppleTalk等协议（苹果电脑和普通电脑联网，有可能会遇到协议问题）

#### IP协议

![image-20220918204850941](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220918204850941.png)

其中源地址，目的地址必须要填写

![image-20220918204930383](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220918204930383.png)

IP数据报是可变长度的，它由两部分组成：首部和数据

​	首部由两部分组成：固定部分和可变部分

​	固定部分20字节，可变部分由一些选项组成，最长40字节

##### IP报头格式

| 第一行 | 版本，首部长度，优先级与服务类型，总长度 | 4字节    |
| ------ | ---------------------------------------- | -------- |
| 第二行 | 标识符，标志，段偏移量                   | 4字节    |
| 第三行 | TTL，协议号，首部校验和                  | 4字节    |
| 第四行 | 源地址                                   | 4字节    |
| 第五行 | 目标地址                                 | 4字节    |
| 第六行 | 可选项                                   | 0-40字节 |
| 第七行 | 数据                                     |          |

**版本：IP协议的版本**

​	ipv4	使用32位2进制数来表示IP地址

​	ipv6	使用128位2进制数来表示IP地址

首部长度：IP报头的大小

​	前5行固定报头长度+第六行的扩展报头长度

​	20字节+0-40字节=20-60字节之间

优先级与服务类型：IP数据报的优先级，是否需要优先发送

总长度：IP数据报报头+数据的总长度

**标识符：IP数据报的编号**

标志：此IP数据报是否被分段

偏移量：此IP数据报是第几个分段，分段编号

**TTL：time to live 生存时间**

​	数据包发送前需要定义一个初始的生存时间

​		Windows 128

​		网络设备 255

​		linux 64

数据包每经过一个路由器，TTL值会自动减1，当TTL为0时，此数据包会被丢弃。

TTL保证数据包不会在网络中循环的发送下去

**协议号：此数据在被IP协议封装之前，还被哪个协议封装过**

​	1：ICMP

​	6：TCP

​	17：UDP

![image-20220918215831365](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220918215831365.png)

**IP地址始终不变，Mac地址不断变化**

**只要更换了网段，Mac地址肯定要发生变化**





description 描述命令

Technical 描述内容

![image-20220926163250875](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220926163250875.png)



# 生成树协议

## 冗余性与STP

 	为了实现既有冗余还没有环路

![image-20220928134412696](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20220928134412696.png)

### STP的术语

​	构造一棵自然树的方法达到阻塞冗余环路的目的，同时实现链路备份和路径最优化。

​	用于构造这棵树的算法称为**生成树算法SPA**（Spanning Tree Algorithm）

​		STP不断检测网络，以检测链路故障。当拓扑发生变化时，运行STP的交换机会自动重新配置其端口，以避免环路产生或链路断开。

- **桥（Bridge）**

  在IEEE的术语中，桥 这个属于一直沿用至今，但并不是指只有两个转发端口的交换机了，而是繁殖具有任意多个端口的交换机。

- **桥的MAC地址 （Bridge MAC Address）**

  一个桥有多个转发端口，每个端口又一个MAC地址。**通常交换机会把端口编号最小的地址作为整个桥的MAC地址。**





# 路由器

## 路由概述

寻找最佳路径

### 查看路由表

​	在路由器上执行**display ip routing-table** 命令便可查看到路由表，其中每一行就是一条路由信息。

路由信息三要素：

	1. 目标网络/掩码（Destination/Mask）
 	2. 出接口（Interface）
 	3. 下一跳IP地址（NextHop）

![image-20221024154235914](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20221024154235914.png)

### 最长匹配原则

​	看掩码长度，选择掩码最长的路由条目

### 路由协议分类

- 根据不同的算法分类，可以分为两种：距离矢量路由协议和链路状态路由协议；
- 根据不同的工作范围，可以分为两种：内部网关协议（IGP）和玩不网关协议（EGP）；
- 根据手动配置活自动学习两种不同的方式建立路由表，可以分为两种：静态路由协议和动态路由协议。



## 路由表的生成与路由条目

- 直连路由（Direct Route）：设备自动发现、手动配置或通过动态路由生成。
- 静态路由（Static Route）：把手动配置的路由信息成为静态路由；
- 动态路由（Dynamic Route）：把网络设备通过运行动态路由协议而得到路由信息称为动态路由。

### 路由优先级

​	设备上的路由优先级一般都有默认值，不同厂家设备对于优先级的默认值可能不同。华为AR路由器上部分路由类型与优先级的默认值的对应关系，如下表所示。

![image-20221024162705662](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20221024162705662.png)

### 路由的开销

![image-20221024163226029](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20221024163226029.png)



## 静态路由

![image-20221024163409117](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20221024163409117.png)

![image-20221024163445565](https://bed-1309358403.cos.ap-shanghai.myqcloud.com/img/image-20221024163445565.png)

