import{_ as s,c as n,o as a,a as l}from"./app.b7724597.js";const u=JSON.parse('{"title":"Kubernetes(K8s 1.27.x)","description":"","frontmatter":{},"headers":[{"level":2,"title":"1 基础知识","slug":"_1-基础知识","link":"#_1-基础知识","children":[{"level":3,"title":"1.1 K8s 有用么？","slug":"_1-1-k8s-有用么","link":"#_1-1-k8s-有用么","children":[]},{"level":3,"title":"1.2 K8s 是什么？","slug":"_1-2-k8s-是什么","link":"#_1-2-k8s-是什么","children":[]},{"level":3,"title":"1.3 k8s 部署方式","slug":"_1-3-k8s-部署方式","link":"#_1-3-k8s-部署方式","children":[]},{"level":3,"title":"1.4 k8s 环境解析","slug":"_1-4-k8s-环境解析","link":"#_1-4-k8s-环境解析","children":[]}]},{"level":2,"title":"2 环境部署","slug":"_2-环境部署","link":"#_2-环境部署","children":[{"level":3,"title":"2.1 基础环境配置","slug":"_2-1-基础环境配置","link":"#_2-1-基础环境配置","children":[]},{"level":3,"title":"2.2 容器环境操作","slug":"_2-2-容器环境操作","link":"#_2-2-容器环境操作","children":[]},{"level":3,"title":"2.3 cri环境操作","slug":"_2-3-cri环境操作","link":"#_2-3-cri环境操作","children":[]},{"level":3,"title":"2.4 harbor仓库操作","slug":"_2-4-harbor仓库操作","link":"#_2-4-harbor仓库操作","children":[]},{"level":3,"title":"2.5 k8s集群初始化","slug":"_2-5-k8s集群初始化","link":"#_2-5-k8s集群初始化","children":[]},{"level":3,"title":"2.6 k8s环境收尾操作","slug":"_2-6-k8s环境收尾操作","link":"#_2-6-k8s环境收尾操作","children":[]}]},{"level":2,"title":"3 应用部署","slug":"_3-应用部署","link":"#_3-应用部署","children":[{"level":3,"title":"3.1 应用管理解读","slug":"_3-1-应用管理解读","link":"#_3-1-应用管理解读","children":[]},{"level":3,"title":"3.2 应用部署实践","slug":"_3-2-应用部署实践","link":"#_3-2-应用部署实践","children":[]},{"level":3,"title":"3.3 应用管理实践","slug":"_3-3-应用管理实践","link":"#_3-3-应用管理实践","children":[]}]},{"level":2,"title":"4 应用访问","slug":"_4-应用访问","link":"#_4-应用访问","children":[{"level":3,"title":"4.1 service对象定位","slug":"_4-1-service对象定位","link":"#_4-1-service对象定位","children":[]},{"level":3,"title":"4.2 Service 实践","slug":"_4-2-service-实践","link":"#_4-2-service-实践","children":[]},{"level":3,"title":"4.3 外部Service","slug":"_4-3-外部service","link":"#_4-3-外部service","children":[]}]},{"level":2,"title":"5 应用数据","slug":"_5-应用数据","link":"#_5-应用数据","children":[{"level":3,"title":"5.1 应用数据解析","slug":"_5-1-应用数据解析","link":"#_5-1-应用数据解析","children":[]},{"level":3,"title":"5.2 应用数据实践","slug":"_5-2-应用数据实践","link":"#_5-2-应用数据实践","children":[]}]},{"level":2,"title":"6 应用配置","slug":"_6-应用配置","link":"#_6-应用配置","children":[{"level":3,"title":"6.1 应用配置解析","slug":"_6-1-应用配置解析","link":"#_6-1-应用配置解析","children":[]},{"level":3,"title":"6.2 配置文件实践","slug":"_6-2-配置文件实践","link":"#_6-2-配置文件实践","children":[]},{"level":3,"title":"6.3 敏感文件实践","slug":"_6-3-敏感文件实践","link":"#_6-3-敏感文件实践","children":[]}]},{"level":2,"title":"7 服务访问","slug":"_7-服务访问","link":"#_7-服务访问","children":[{"level":3,"title":"7.1 Ingress简介","slug":"_7-1-ingress简介","link":"#_7-1-ingress简介","children":[]},{"level":3,"title":"7.2 Ingress部署","slug":"_7-2-ingress部署","link":"#_7-2-ingress部署","children":[]},{"level":3,"title":"7.3 Ingress实践","slug":"_7-3-ingress实践","link":"#_7-3-ingress实践","children":[]}]},{"level":2,"title":"8 helm管理","slug":"_8-helm管理","link":"#_8-helm管理","children":[{"level":3,"title":"8.1 helm简介","slug":"_8-1-helm简介","link":"#_8-1-helm简介","children":[]},{"level":3,"title":"8.2 helm部署","slug":"_8-2-helm部署","link":"#_8-2-helm部署","children":[]},{"level":3,"title":"8.3 helm实践","slug":"_8-3-helm实践","link":"#_8-3-helm实践","children":[]}]}],"relativePath":"network/Kubernetes.md","lastUpdated":1696757468000}'),p={name:"network/Kubernetes.md"},e=l(`<h1 id="kubernetes-k8s-1-27-x" tabindex="-1">Kubernetes(K8s 1.27.x) <a class="header-anchor" href="#kubernetes-k8s-1-27-x" aria-hidden="true">#</a></h1><h2 id="_1-基础知识" tabindex="-1">1 基础知识 <a class="header-anchor" href="#_1-基础知识" aria-hidden="true">#</a></h2><h3 id="_1-1-k8s-有用么" tabindex="-1">1.1 K8s 有用么？ <a class="header-anchor" href="#_1-1-k8s-有用么" aria-hidden="true">#</a></h3><p>K8s有没有用</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/90998906d1f040cabfa8a92501ab73dc.png" alt="image.png"></p><p>K8s要不要学？</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/9e6a06241dee46728bde9184d40c8a66.jpg" alt="image.png"></p><div class="language-pow line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">pow</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#e1e4e8;">参考资料:</span></span>
<span class="line"><span style="color:#e1e4e8;">https://www.infoq.com/articles/devops-and-cloud-trends-2022/?itm_source=articles_about_InfoQ-trends-report&amp;itm_medium=link&amp;itm_campaign=InfoQ-trends-report</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_1-2-k8s-是什么" tabindex="-1">1.2 K8s 是什么？ <a class="header-anchor" href="#_1-2-k8s-是什么" aria-hidden="true">#</a></h3><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/523c14c863204efcb757f2695ee49fe6.png" alt="image.png"></p><h3 id="_1-3-k8s-部署方式" tabindex="-1">1.3 k8s 部署方式 <a class="header-anchor" href="#_1-3-k8s-部署方式" aria-hidden="true">#</a></h3><p>目前Kubernetes的两类部署样式</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/970170ede5cf4fcd908b19fdb579711e.png" alt="image.png"></p><h3 id="_1-4-k8s-环境解析" tabindex="-1">1.4 k8s 环境解析 <a class="header-anchor" href="#_1-4-k8s-环境解析" aria-hidden="true">#</a></h3><p>网络环境解析</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/f1b76d12294e4b6f83227004c054b601.png" alt="image.png"></p><p>部署结构解析</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/83eaf14444d1474e966bf3dd49eceec6.png" alt="image.png"></p><h2 id="_2-环境部署" tabindex="-1">2 环境部署 <a class="header-anchor" href="#_2-环境部署" aria-hidden="true">#</a></h2><h3 id="_2-1-基础环境配置" tabindex="-1">2.1 基础环境配置 <a class="header-anchor" href="#_2-1-基础环境配置" aria-hidden="true">#</a></h3><p>主机名规划</p><table><thead><tr><th>序号</th><th>主机ip</th><th>主机名规划</th></tr></thead><tbody><tr><td>1</td><td>10.0.0.12</td><td><a href="http://kubernetes-master.sswang.com" target="_blank" rel="noreferrer">kubernetes-master.sswang.com</a> kubernetes-master</td></tr><tr><td>2</td><td>10.0.0.15</td><td><a href="http://kubernetes-node1.sswang.com" target="_blank" rel="noreferrer">kubernetes-node1.sswang.com</a> kubernetes-node1</td></tr><tr><td>3</td><td>10.0.0.16</td><td><a href="http://kubernetes-node2.sswang.com" target="_blank" rel="noreferrer">kubernetes-node2.sswang.com</a> kubernetes-node2</td></tr><tr><td>4</td><td>10.0.0.17</td><td><a href="http://kubernetes-node3.sswang.com" target="_blank" rel="noreferrer">kubernetes-node3.sswang.com</a> kubernetes-node3</td></tr><tr><td>5</td><td>10.0.0.20</td><td><a href="http://kubernetes-register.sswang.com" target="_blank" rel="noreferrer">kubernetes-register.sswang.com</a> kubernetes-register</td></tr></tbody></table><p>跨主机免密码认证</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">生成秘钥对</span></span>
<span class="line"><span style="color:#E1E4E8;">ssh</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">keygen </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">t rsa </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">跨主机免密码认证</span></span>
<span class="line"><span style="color:#E1E4E8;">ssh</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">copy-id</span><span style="color:#E1E4E8;"> root@远程主机ip地址</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Swap环境配置(所有主机操作)</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">临时禁用</span></span>
<span class="line"><span style="color:#E1E4E8;">swapoff </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">永久禁用</span></span>
<span class="line"><span style="color:#E1E4E8;">sed </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">i </span><span style="color:#9ECBFF;">&#39;s/.*swap.*/#&amp;/&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">fstab </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">内核参数调整</span></span>
<span class="line"><span style="color:#E1E4E8;">cat </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sysctl.d</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">k8s.conf </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">vm.swappiness</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">sysctl </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sysctl.d</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">k8s.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>网络参数调整(所有主机操作)</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">配置iptables参数，使得流经网桥的流量也经过iptables</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">netfilter防火墙</span></span>
<span class="line"><span style="color:#E1E4E8;">cat </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sysctl.d</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">k8s.conf </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">net.bridge.bridge</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nf</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">call</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ip6tables </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">net.bridge.bridge</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nf</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">call</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">iptables </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">net.ipv4.ip_forward </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">配置生效</span></span>
<span class="line"><span style="color:#E1E4E8;">modprobe br_netfilter</span></span>
<span class="line"><span style="color:#E1E4E8;">modprobe overlay</span></span>
<span class="line"><span style="color:#E1E4E8;">sysctl </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sysctl.d</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">k8s.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_2-2-容器环境操作" tabindex="-1">2.2 容器环境操作 <a class="header-anchor" href="#_2-2-容器环境操作" aria-hidden="true">#</a></h3><p>注意：所有主机操作</p><p>部署docker软件源</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">定制软件源</span></span>
<span class="line"><span style="color:#E1E4E8;">yum install </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">y yum</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">utils device</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">mapper</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">persistent</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">data lvm2</span></span>
<span class="line"><span style="color:#E1E4E8;">yum</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">config</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">manager </span><span style="color:#F97583;">--</span><span style="color:#79B8FF;">add-repo</span><span style="color:#E1E4E8;"> http:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">mirrors.aliyun.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ce</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">linux</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">centos</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ce.repo</span></span>
<span class="line"><span style="color:#E1E4E8;">安装最新版docker</span></span>
<span class="line"><span style="color:#E1E4E8;">yum list docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ce </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">showduplicates </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> sort </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">r</span></span>
<span class="line"><span style="color:#E1E4E8;">yum install </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">y docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ce</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl enable docker</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl start docker</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>docker加速器配置</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">配置加速器文件</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># cat &gt;&gt; /etc/docker/daemon.json &lt;&lt;-EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;registry-mirrors&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;http://74f21445.m.daocloud.io&quot;</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;https://registry.docker-cn.com&quot;</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;http://hub-mirror.c.163.com&quot;</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;insecure-registries&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;kubernetes-register.sswang.com&quot;</span><span style="color:#E1E4E8;">]</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;exec-opts&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;native.cgroupdriver=systemd&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">重启docker服务</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl restart docker</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_2-3-cri环境操作" tabindex="-1">2.3 cri环境操作 <a class="header-anchor" href="#_2-3-cri环境操作" aria-hidden="true">#</a></h3><p>注意：所有主机操作</p><p>获取软件</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">下载软件</span></span>
<span class="line"><span style="color:#E1E4E8;">mkdir </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">softs &amp;&amp; cd </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">softs</span></span>
<span class="line"><span style="color:#E1E4E8;">wget https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">github.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Mirantis</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">releases</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">download</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v0.</span><span style="color:#79B8FF;">3.2</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0.3</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">2.</span><span style="color:#E1E4E8;">amd64.tgz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">解压软件</span></span>
<span class="line"><span style="color:#E1E4E8;">tar xf cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">0.3</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">2.</span><span style="color:#E1E4E8;">amd64.tgz</span></span>
<span class="line"><span style="color:#E1E4E8;">mv cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">local</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">检查效果</span></span>
<span class="line"><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">version</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>定制配置</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">定制配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">cat </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">systemd</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">system</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.service</span><span style="color:#F97583;">&lt;&lt;-</span><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Unit</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">Description</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">CRI Interface </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> Docker Application Container Engine</span></span>
<span class="line"><span style="color:#E1E4E8;">Documentation</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">docs.mirantis.com</span></span>
<span class="line"><span style="color:#E1E4E8;">After</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">network</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">online.target firewalld.service docker.service</span></span>
<span class="line"><span style="color:#E1E4E8;">Wants</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">network</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">online.target</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Service</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">Type</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">notify</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStart</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">local</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">pod</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">infra</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">container</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">image</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">registry.cn-hangzhou.aliyuncs.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pause:</span><span style="color:#79B8FF;">3.9</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">network</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">plugin</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">cni </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">cni</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">conf</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dir</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cni</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">net.d </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">cni</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dir</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">opt</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cni</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">container</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">runtime</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">endpoint</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">unix:</span><span style="color:#F97583;">///var/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.sock </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">root</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">directory</span><span style="color:#F97583;">=/var/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">dockershim </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">endpoint</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">unix:</span><span style="color:#F97583;">///var/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker.sock </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">root</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">directory</span><span style="color:#F97583;">=/var/</span><span style="color:#E1E4E8;">lib</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecReload</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kill </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">s HUP $MAINPID</span></span>
<span class="line"><span style="color:#E1E4E8;">TimeoutSec</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">RestartSec</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">Restart</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">always</span></span>
<span class="line"><span style="color:#E1E4E8;">StartLimitBurst</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">StartLimitInterval</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">60s</span></span>
<span class="line"><span style="color:#E1E4E8;">LimitNOFILE</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">infinity</span></span>
<span class="line"><span style="color:#E1E4E8;">LimitNPROC</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">infinity</span></span>
<span class="line"><span style="color:#E1E4E8;">LimitCORE</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">infinity</span></span>
<span class="line"><span style="color:#E1E4E8;">TasksMax</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">infinity</span></span>
<span class="line"><span style="color:#E1E4E8;">Delegate</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">yes</span></span>
<span class="line"><span style="color:#E1E4E8;">KillMode</span><span style="color:#F97583;">=process</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Install</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">WantedBy</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">multi</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">user.target</span></span>
<span class="line"><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">定制配置</span></span>
<span class="line"><span style="color:#E1E4E8;">cat </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">systemd</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">system</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.socket </span><span style="color:#F97583;">&lt;&lt;-</span><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Unit</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">Description</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">CRI Docker Socket </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> the API</span></span>
<span class="line"><span style="color:#E1E4E8;">PartOf</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">docker.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Socket</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">ListenStream</span><span style="color:#F97583;">=/var/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.sock</span></span>
<span class="line"><span style="color:#E1E4E8;">SocketMode</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0660</span></span>
<span class="line"><span style="color:#E1E4E8;">SocketUser</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">root</span></span>
<span class="line"><span style="color:#E1E4E8;">SocketGroup</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Install</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">WantedBy</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">sockets.target</span></span>
<span class="line"><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">设置服务开机自启动</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl daemon</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">reload</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl enable cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.service</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl restart cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.service</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="_2-4-harbor仓库操作" tabindex="-1">2.4 harbor仓库操作 <a class="header-anchor" href="#_2-4-harbor仓库操作" aria-hidden="true">#</a></h3><p>准备工作</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">安装docker环境</span></span>
<span class="line"><span style="color:#E1E4E8;">参考 上一节docker环境部署</span></span>
<span class="line"><span style="color:#E1E4E8;">安装docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">compose</span></span>
<span class="line"><span style="color:#E1E4E8;">yum install </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">y docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">compose</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>获取软件</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">下载软件</span></span>
<span class="line"><span style="color:#E1E4E8;">mkdir </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">{softs</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;">server} </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p &amp;&amp; cd </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">softs</span></span>
<span class="line"><span style="color:#E1E4E8;">wget https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">github.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">goharbor</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">releases</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">download</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v2.</span><span style="color:#79B8FF;">5.0</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">offline</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">installer</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v2.</span><span style="color:#79B8FF;">5.0</span><span style="color:#E1E4E8;">.tgz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">解压软件</span></span>
<span class="line"><span style="color:#E1E4E8;">tar </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">zxvf harbor</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">offline</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">installer</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v2.</span><span style="color:#79B8FF;">5.0</span><span style="color:#E1E4E8;">.tgz </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">C  </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">cd </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor</span><span style="color:#F97583;">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">加载镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">docker load </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> harbor.v2.</span><span style="color:#79B8FF;">5.0</span><span style="color:#E1E4E8;">.tar.gz</span></span>
<span class="line"><span style="color:#E1E4E8;">docker images</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">备份配置</span></span>
<span class="line"><span style="color:#E1E4E8;">cp harbor.yml.tmpl harbor.yml</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>修改配置</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">修改配置</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">root</span><span style="color:#E1E4E8;">@kubernetes</span><span style="color:#F97583;">-register</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/data/server/harbor</span><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># vim harbor.yml.tmpl</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 修改主机名</span></span>
<span class="line"><span style="color:#E1E4E8;">    hostname: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    http:</span></span>
<span class="line"><span style="color:#E1E4E8;">      port: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#https:  注释ssl相关的部分</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#  port: 443</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#  certificate: /your/certificate/path</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#  private_key: /your/private/key/path</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 修改harbor的登录密码</span></span>
<span class="line"><span style="color:#E1E4E8;">    harbor_admin_password: </span><span style="color:#79B8FF;">123456</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 设定harbor的数据存储目录</span></span>
<span class="line"><span style="color:#E1E4E8;">    data_volume: </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor</span><span style="color:#F97583;">/data</span></span>
<span class="line"><span style="color:#E1E4E8;">配置harbor</span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">prepare</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">启动harbor</span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">install.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">检查效果</span></span>
<span class="line"><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">compose ps</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>定制服务启动文件</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">定制服务启动文件 </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">systemd</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">system</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor.service</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Unit</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">Description</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Harbor</span></span>
<span class="line"><span style="color:#E1E4E8;">After</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">docker.service systemd</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">networkd.service systemd</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">resolved.service</span></span>
<span class="line"><span style="color:#E1E4E8;">Requires</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">docker.service</span></span>
<span class="line"><span style="color:#E1E4E8;">Documentation</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">http:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">github.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">vmware</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Service</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">Type</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">simple</span></span>
<span class="line"><span style="color:#E1E4E8;">Restart</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">on</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">failure</span></span>
<span class="line"><span style="color:#E1E4E8;">RestartSec</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#6A737D;">#需要注意harbor的安装位置</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStart</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">compose </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">file </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">compose.yml up</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStop</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">compose </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">file </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">harbor</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">docker</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">compose.yml down</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">Install</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">WantedBy</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">multi</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">user.target</span></span>
<span class="line"><span style="color:#E1E4E8;">加载服务配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl daemon</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">reload</span></span>
<span class="line"><span style="color:#E1E4E8;">启动服务</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl start harbor</span></span>
<span class="line"><span style="color:#E1E4E8;">检查状态</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl status harbor</span></span>
<span class="line"><span style="color:#E1E4E8;">设置开机自启动</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl enable harbor</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>harbor仓库定制</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">浏览器访问域名，用户名: admin</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> 密码：</span><span style="color:#79B8FF;">123456</span></span>
<span class="line"><span style="color:#E1E4E8;">创建sswang用户专用的项目仓库，名称为 sswang，权限为公开的</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>harbor仓库测试</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">登录仓库</span></span>
<span class="line"><span style="color:#6A737D;"># docker login kubernetes-register.sswang.com -u sswang</span></span>
<span class="line"><span style="color:#E1E4E8;">Password:   </span><span style="color:#6A737D;"># 输入登录密码 A12345678a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">下载镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">docker pull busybox</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">定制镜像标签</span></span>
<span class="line"><span style="color:#E1E4E8;">docker tag busybox </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">busybox:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">推送镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">docker push </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">busybox:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_2-5-k8s集群初始化" tabindex="-1">2.5 k8s集群初始化 <a class="header-anchor" href="#_2-5-k8s集群初始化" aria-hidden="true">#</a></h3><p>软件部署</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">定制阿里云的关于kubernetes的软件源</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">kubernetes</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Kubernetes</span></span>
<span class="line"><span style="color:#E1E4E8;">baseurl</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">mirrors.aliyun.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">yum</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">repos</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">el7</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x86_64</span></span>
<span class="line"><span style="color:#E1E4E8;">enabled</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">gpgcheck</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">repo_gpgcheck</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">gpgkey</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">mirrors.aliyun.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">yum</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">doc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">yum</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key.gpg https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">mirrors.aliyun.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">yum</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">doc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">rpm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">package</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key.gpg</span></span>
<span class="line"><span style="color:#E1E4E8;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">更新软件源</span></span>
<span class="line"><span style="color:#E1E4E8;">yum makecache fast</span></span>
<span class="line"><span style="color:#E1E4E8;">master环境软件部署</span></span>
<span class="line"><span style="color:#E1E4E8;">yum install kubeadm kubectl kubelet </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">node环境软件部署</span></span>
<span class="line"><span style="color:#E1E4E8;">yum install kubeadm kubectl kubelet </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">y</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>确认基本配置</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">检查镜像文件列表</span></span>
<span class="line"><span style="color:#E1E4E8;">kubeadm config images list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">获取镜像文件</span></span>
<span class="line"><span style="color:#E1E4E8;">images</span><span style="color:#F97583;">=$</span><span style="color:#E1E4E8;">(kubeadm config images list </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">version</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1.27</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> awk </span><span style="color:#F97583;">-F</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{print $NF}&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> \${images}</span></span>
<span class="line"><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker pull </span><span style="color:#79B8FF;">registry.aliyuncs.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker tag </span><span style="color:#79B8FF;">registry.aliyuncs.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker push </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker rmi </span><span style="color:#79B8FF;">registry.aliyuncs.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>master节点初始化</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">环境初始化命令</span></span>
<span class="line"><span style="color:#E1E4E8;">kubeadm init </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">version</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1.27</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">apiserver</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">advertise</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">address</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.12</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">image</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">repository </span><span style="color:#79B8FF;">kubernetes-register.superopsmsb.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">service</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cidr</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10.96</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">pod</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">network</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cidr</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10.244</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">ignore</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">preflight</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">errors</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">Swap \\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">socket</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">unix:</span><span style="color:#F97583;">///var/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.sock</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>node节点加入集群</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">复制join命令，加入到master集群</span></span>
<span class="line"><span style="color:#E1E4E8;">kubeadm join </span><span style="color:#79B8FF;">10.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.12</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">6443</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">token vudfvt.fwpohpbb7yw2qy49 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">discovery</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">token</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ca</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cert</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">hash sha256:</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">..</span><span style="color:#F97583;">.</span><span style="color:#E1E4E8;"> .</span><span style="color:#F97583;">..</span><span style="color:#79B8FF;">48545</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">socket</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">unix:</span><span style="color:#F97583;">///var/</span><span style="color:#E1E4E8;">run</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">cri</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">dockerd.sock</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-6-k8s环境收尾操作" tabindex="-1">2.6 k8s环境收尾操作 <a class="header-anchor" href="#_2-6-k8s环境收尾操作" aria-hidden="true">#</a></h3><p>权限操作</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">定制kubernetes的登录权限</span></span>
<span class="line"><span style="color:#E1E4E8;">mkdir </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">$HOME</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">.kube</span></span>
<span class="line"><span style="color:#E1E4E8;">cp </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">i </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">admin.conf </span><span style="color:#79B8FF;">$HOME</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">.kube</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">chown </span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;">(id </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">u):</span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;">(id </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">g) </span><span style="color:#79B8FF;">$HOME</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">.kube</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">config</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>命令补全</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">放到master主机的环境文件中</span></span>
<span class="line"><span style="color:#E1E4E8;">echo </span><span style="color:#9ECBFF;">&quot;source &lt;(kubectl completion bash)&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> ~</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">.bashrc</span></span>
<span class="line"><span style="color:#E1E4E8;">echo </span><span style="color:#9ECBFF;">&quot;source &lt;(kubeadm completion bash)&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> ~</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">.bashrc</span></span>
<span class="line"><span style="color:#E1E4E8;">source ~</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">.bashrc</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>网络环境</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">网络定制</span></span>
<span class="line"><span style="color:#E1E4E8;">mkdir </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">flannel </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p</span></span>
<span class="line"><span style="color:#E1E4E8;">cd </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">flannel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">获取配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">wget https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">raw.githubusercontent.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">flannel</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">io</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">flannel</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">master</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">Documentation</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flannel.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">定制镜像标签</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;">(grep image kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flannel.yml </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> grep </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v </span><span style="color:#9ECBFF;">&#39;#&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> awk </span><span style="color:#F97583;">-F</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{print $NF}&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">    docker pull flannel</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">    docker tag flannel</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i </span><span style="color:#79B8FF;">kubernetes-register.superopsmsb.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">    docker push </span><span style="color:#79B8FF;">kubernetes-register.superopsmsb.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">    docker rmi flannel</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">备份配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">cp kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flannel.yml{</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;">.bak}</span></span>
<span class="line"><span style="color:#E1E4E8;">修改配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">sed </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">i </span><span style="color:#9ECBFF;">&#39;/ image:/s/docker.io\\/flannel/kubernetes-register.sswang.com\\/google_containers/&#39;</span><span style="color:#E1E4E8;"> kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flannel.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">应用配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl apply </span><span style="color:#F97583;">-f</span><span style="color:#E1E4E8;"> kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">flannel.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">检查效果</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl get node</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_3-应用部署" tabindex="-1">3 应用部署 <a class="header-anchor" href="#_3-应用部署" aria-hidden="true">#</a></h2><h3 id="_3-1-应用管理解读" tabindex="-1">3.1 应用管理解读 <a class="header-anchor" href="#_3-1-应用管理解读" aria-hidden="true">#</a></h3><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/176c040ad69e4c6c84763b0058c62740.png" alt="image.png"></p><h3 id="_3-2-应用部署实践" tabindex="-1">3.2 应用部署实践 <a class="header-anchor" href="#_3-2-应用部署实践" aria-hidden="true">#</a></h3><p>资源对象管理关系</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/4d41b8459755492e95944390172cd6fc.png" alt="image.png"></p><p>资源对象管理实践</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">手工方式：</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl run pod名称 </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">image</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">image地址</span></span>
<span class="line"><span style="color:#E1E4E8;">资源清单方式:</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Pod</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    run: my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">pod</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">pod</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    name: my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">pod</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>deployment资源实践</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">proxy应用的配置清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">proxy</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  replicas: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    matchLabels:</span></span>
<span class="line"><span style="color:#E1E4E8;">      app: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  template:</span></span>
<span class="line"><span style="color:#E1E4E8;">    metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">      labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        app: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> containerPort: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web 的资源清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  replicas: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    matchLabels:</span></span>
<span class="line"><span style="color:#E1E4E8;">      app: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  template:</span></span>
<span class="line"><span style="color:#E1E4E8;">    metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">      labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        app: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">    spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx_web:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">        ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> containerPort: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web 的资源清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  replicas: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    matchLabels:</span></span>
<span class="line"><span style="color:#E1E4E8;">      app: tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  template:</span></span>
<span class="line"><span style="color:#E1E4E8;">    metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">      labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        app: tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">    spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: tomcat</span></span>
<span class="line"><span style="color:#E1E4E8;">        image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tomcat_web:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">        ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> containerPort: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h3 id="_3-3-应用管理实践" tabindex="-1">3.3 应用管理实践 <a class="header-anchor" href="#_3-3-应用管理实践" aria-hidden="true">#</a></h3><p>资源对象隔离</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">namespace资源对象实践</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Namespace</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ns</span></span>
<span class="line"><span style="color:#F97583;">---</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  namespace: my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ns</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  replicas: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    matchLabels:</span></span>
<span class="line"><span style="color:#E1E4E8;">      app: tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  template:</span></span>
<span class="line"><span style="color:#E1E4E8;">    metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">      labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        app: tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">    spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: tomcat</span></span>
<span class="line"><span style="color:#E1E4E8;">        image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tomcat_web:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">        ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> containerPort: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>资源对象的扩缩容</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">资源对象扩缩容</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl scale deployment 资源对象名称 </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">replicas</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">目标数量 deployment</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">修改应用镜像版本</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl set image deployment 资源对象名称 容器名称</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">镜像名称</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_4-应用访问" tabindex="-1">4 应用访问 <a class="header-anchor" href="#_4-应用访问" aria-hidden="true">#</a></h2><h3 id="_4-1-service对象定位" tabindex="-1">4.1 service对象定位 <a class="header-anchor" href="#_4-1-service对象定位" aria-hidden="true">#</a></h3><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/0f12d9679f354e59bfe5f33dfadce8e9.png" alt="image.png"></p><h3 id="_4-2-service-实践" tabindex="-1">4.2 Service 实践 <a class="header-anchor" href="#_4-2-service-实践" aria-hidden="true">#</a></h3><p>手工创建Service</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">根据应用部署资源对象，创建SVC对象</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl expose deployment nginx </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">port</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">type</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">NodePort</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>yaml方式创建Service</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web的service资源清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Service</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  type: NodePort</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> protocol: TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">      name: http</span></span>
<span class="line"><span style="color:#E1E4E8;">      port: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">      targetPort: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">      nodePort: </span><span style="color:#79B8FF;">31080</span></span>
<span class="line"><span style="color:#E1E4E8;">tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web的service资源清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Service</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  type: NodePort</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: tomcat</span></span>
<span class="line"><span style="color:#E1E4E8;">  ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> protocol: TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">      name: http</span></span>
<span class="line"><span style="color:#E1E4E8;">      port: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">      targetPort: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">      nodePort: </span><span style="color:#79B8FF;">31880</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_4-3-外部service" tabindex="-1">4.3 外部Service <a class="header-anchor" href="#_4-3-外部service" aria-hidden="true">#</a></h3><p>部署外部mysql环境</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">准备软件源</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># cat /etc/yum.repos.d/MariaDB.repo</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">mariadb</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> MariaDB</span></span>
<span class="line"><span style="color:#E1E4E8;">baseurl </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> http:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">yum.mariadb.org</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">10.3</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">centos7</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">amd64</span></span>
<span class="line"><span style="color:#E1E4E8;">gpgcheck</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">更新系统软件包：</span></span>
<span class="line"><span style="color:#E1E4E8;">yum makecache fast</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">安装 MySQL 服务器</span></span>
<span class="line"><span style="color:#E1E4E8;">yum install mariadb</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">server mariadb </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">y </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">设置 MySQL 服务在启动时自动启动</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl start mariadb.service</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl enable mariadb.service</span></span>
<span class="line"><span style="color:#E1E4E8;">开启 MySQL 服务器远程访问能力</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># vim /etc/my.cnf.d/server.cnf</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">mysqld</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">bind</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">address </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">重启 MySQL 服务使配置生效</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl restart mariadb.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">配置远程主机登录权限</span></span>
<span class="line"><span style="color:#E1E4E8;">mysql </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">uroot </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p123456 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e </span><span style="color:#9ECBFF;">&quot;GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39; WITH GRANT OPTION;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">mysql </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">uroot </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p123456 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e </span><span style="color:#9ECBFF;">&quot;FLUSH PRIVILEGES;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">主库上创建数据库</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># mysql -uroot -p123456 -e &quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">CREATE DATABASE bookinfo </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> charset utf8 collate utf8_general_ci;</span></span>
<span class="line"><span style="color:#E1E4E8;">USE bookinfo;</span></span>
<span class="line"><span style="color:#E1E4E8;">CREATE TABLE book_info (</span></span>
<span class="line"><span style="color:#E1E4E8;">  id INT AUTO_INCREMENT PRIMARY KEY</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  book_name VARCHAR(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  author VARCHAR(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  date_of_issue DATE</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  isDelete BOOLEAN</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">INSERT INTO book_info (book_name</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> author</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> date_of_issue</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> isDelete) VALUES</span></span>
<span class="line"><span style="color:#E1E4E8;">  (</span><span style="color:#9ECBFF;">&#39;Book 1&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Author 1&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;2022-01-01&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> FALSE)</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  (</span><span style="color:#9ECBFF;">&#39;Book 2&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Author 2&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;2022-02-01&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> FALSE)</span><span style="color:#F97583;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  (</span><span style="color:#9ECBFF;">&#39;Book 3&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Author 3&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;2022-03-01&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> TRUE);</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>定制资源清单文件</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Namespace</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: external</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ns</span></span>
<span class="line"><span style="color:#F97583;">---</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Endpoints</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: ex</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  namespace: external</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ns</span></span>
<span class="line"><span style="color:#E1E4E8;">subsets:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> addresses:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> ip: </span><span style="color:#79B8FF;">10.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.18</span></span>
<span class="line"><span style="color:#E1E4E8;">    ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> port: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#F97583;">---</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Service</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: ex</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">mysql</span></span>
<span class="line"><span style="color:#E1E4E8;">  namespace: external</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ns</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  type: ClusterIP</span></span>
<span class="line"><span style="color:#E1E4E8;">  ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> port: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#E1E4E8;">    targetPort: </span><span style="color:#79B8FF;">3306</span></span>
<span class="line"><span style="color:#F97583;">---</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: bookinfo</span></span>
<span class="line"><span style="color:#E1E4E8;">  namespace: external</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ns</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  replicas: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    matchLabels:</span></span>
<span class="line"><span style="color:#E1E4E8;">      app: flask</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">bookinfo</span></span>
<span class="line"><span style="color:#E1E4E8;">  template:</span></span>
<span class="line"><span style="color:#E1E4E8;">    metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">      labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        app: flask</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">bookinfo</span></span>
<span class="line"><span style="color:#E1E4E8;">    spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: flask</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">bookinfo</span></span>
<span class="line"><span style="color:#E1E4E8;">          image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">flask_bookinfo:</span><span style="color:#79B8FF;">2.3</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">          imagePullPolicy: Always</span></span>
<span class="line"><span style="color:#E1E4E8;">          ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> containerPort: </span><span style="color:#79B8FF;">5000</span></span>
<span class="line"><span style="color:#E1E4E8;">          env:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: DB_HOST</span></span>
<span class="line"><span style="color:#E1E4E8;">              value: </span><span style="color:#9ECBFF;">&quot;ex-mysql&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: DB_USER</span></span>
<span class="line"><span style="color:#E1E4E8;">              value: </span><span style="color:#9ECBFF;">&quot;root&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: DB_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">              value: </span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: DB_DATABASE</span></span>
<span class="line"><span style="color:#E1E4E8;">              value: </span><span style="color:#9ECBFF;">&quot;bookinfo&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="_5-应用数据" tabindex="-1">5 应用数据 <a class="header-anchor" href="#_5-应用数据" aria-hidden="true">#</a></h2><h3 id="_5-1-应用数据解析" tabindex="-1">5.1 应用数据解析 <a class="header-anchor" href="#_5-1-应用数据解析" aria-hidden="true">#</a></h3><p>k8s应用数据类型和步骤解析</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/3eb86f24f6224c6b918605c3a12db22f.png" alt="image.png"></p><p>k8s如何使用数据功能</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/07c9ecff65fe4a939a401ab178671974.png" alt="image.png"></p><p>k8s使用各种数据类型的配置</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/b8196355709a402aa3522ea3db5840da.png" alt="image.png"></p><h3 id="_5-2-应用数据实践" tabindex="-1">5.2 应用数据实践 <a class="header-anchor" href="#_5-2-应用数据实践" aria-hidden="true">#</a></h3><p>emptyDir实践</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">资源对象文件内容</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Pod</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">emptydir</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">    image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx_web:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    volumeMounts:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">index</span></span>
<span class="line"><span style="color:#E1E4E8;">      mountPath: </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">html</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: change</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">index</span></span>
<span class="line"><span style="color:#E1E4E8;">    image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">busybox:</span><span style="color:#79B8FF;">1.28</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 每过2秒更改一下文件内容</span></span>
<span class="line"><span style="color:#E1E4E8;">    command: [</span><span style="color:#9ECBFF;">&#39;sh&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;-c&#39;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;for i in $(seq 100); do echo index-$i &gt; /testdir/index.html;sleep 2;done&#39;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    volumeMounts:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">index</span></span>
<span class="line"><span style="color:#E1E4E8;">      mountPath: </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">testdir</span></span>
<span class="line"><span style="color:#E1E4E8;">  volumes:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">index</span></span>
<span class="line"><span style="color:#E1E4E8;">    emptyDir: {}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>hostPath实践</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">资源对象文件内容</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Pod</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">hostpath</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  volumes:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">backup</span></span>
<span class="line"><span style="color:#E1E4E8;">    hostPath:</span></span>
<span class="line"><span style="color:#E1E4E8;">     path: </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">backup</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">redis</span></span>
<span class="line"><span style="color:#E1E4E8;">  containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: hostpath</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span></span>
<span class="line"><span style="color:#E1E4E8;">      image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">redis:</span><span style="color:#79B8FF;">7.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">4</span></span>
<span class="line"><span style="color:#E1E4E8;">      volumeMounts:</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">backup</span></span>
<span class="line"><span style="color:#E1E4E8;">         mountPath: </span><span style="color:#F97583;">/data</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_6-应用配置" tabindex="-1">6 应用配置 <a class="header-anchor" href="#_6-应用配置" aria-hidden="true">#</a></h2><h3 id="_6-1-应用配置解析" tabindex="-1">6.1 应用配置解析 <a class="header-anchor" href="#_6-1-应用配置解析" aria-hidden="true">#</a></h3><p>k8s如何使用配置数据功能</p><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/7132b215a8974a0db11bd3b689a9bee6.png" alt="image.png"></p><h3 id="_6-2-配置文件实践" tabindex="-1">6.2 配置文件实践 <a class="header-anchor" href="#_6-2-配置文件实践" aria-hidden="true">#</a></h3><p>定制配置文件实践</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">定制资源清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: ConfigMap</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginxconf</span></span>
<span class="line"><span style="color:#F97583;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;">.conf: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#E1E4E8;">    server {</span></span>
<span class="line"><span style="color:#E1E4E8;">        listen </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        server_name </span><span style="color:#79B8FF;">www.sswang.com</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx {</span></span>
<span class="line"><span style="color:#E1E4E8;">          proxy_pass http:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tomcat {</span></span>
<span class="line"><span style="color:#E1E4E8;">          proxy_pass http:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web:</span><span style="color:#79B8FF;">8080</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            root </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">html;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#F97583;">---</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: ConfigMap</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">index</span></span>
<span class="line"><span style="color:#F97583;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  index.html: </span><span style="color:#9ECBFF;">&quot;Hello Nginx, This is Nginx Web Page by sswang!!!\\n&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">定制nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">proxy代理</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">proxy</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  replicas: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    matchLabels:</span></span>
<span class="line"><span style="color:#E1E4E8;">      app: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  template:</span></span>
<span class="line"><span style="color:#E1E4E8;">    metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">      labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        app: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx_proxy:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">        volumeMounts:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxconf</span></span>
<span class="line"><span style="color:#E1E4E8;">          mountPath: </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">conf.d</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">          readOnly: true</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxindex</span></span>
<span class="line"><span style="color:#E1E4E8;">          mountPath: </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">html</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">          readOnly: true</span></span>
<span class="line"><span style="color:#E1E4E8;">      volumes:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxconf</span></span>
<span class="line"><span style="color:#E1E4E8;">        configMap:</span></span>
<span class="line"><span style="color:#E1E4E8;">          name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginxconf</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxindex</span></span>
<span class="line"><span style="color:#E1E4E8;">        configMap:</span></span>
<span class="line"><span style="color:#E1E4E8;">          name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">index</span></span>
<span class="line"><span style="color:#F97583;">---</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Service</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: superopsmsb</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">proxy</span></span>
<span class="line"><span style="color:#E1E4E8;">  labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: superopsmsb</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">proxy</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  selector:</span></span>
<span class="line"><span style="color:#E1E4E8;">    app: nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  ports:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> protocol: TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">      name: http</span></span>
<span class="line"><span style="color:#E1E4E8;">      port: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">      targetPort: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><h3 id="_6-3-敏感文件实践" tabindex="-1">6.3 敏感文件实践 <a class="header-anchor" href="#_6-3-敏感文件实践" aria-hidden="true">#</a></h3><p>定制配置文件</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">准备nginx容器的配置目录</span></span>
<span class="line"><span style="color:#E1E4E8;">mkdir tls</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">做证书</span></span>
<span class="line"><span style="color:#E1E4E8;">openssl  genrsa </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">out tls</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tls.key </span><span style="color:#79B8FF;">2048</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">做成自签证书</span></span>
<span class="line"><span style="color:#E1E4E8;">openssl req  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">new </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">x509 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key tls</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tls.key  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">out tls</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tls.crt </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">subj </span><span style="color:#9ECBFF;">&quot;/CN=www.sswang.com&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">定制专属nginx配置文件  nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">conf</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tls</span><span style="color:#F97583;">/default</span><span style="color:#E1E4E8;">.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">server {</span></span>
<span class="line"><span style="color:#E1E4E8;">    listen </span><span style="color:#79B8FF;">443</span><span style="color:#E1E4E8;"> ssl;</span></span>
<span class="line"><span style="color:#E1E4E8;">    server_name </span><span style="color:#79B8FF;">www.sswang.com</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    ssl_certificate </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">certs</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tls.crt; </span></span>
<span class="line"><span style="color:#E1E4E8;">    ssl_certificate_key </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">certs</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tls.key;</span></span>
<span class="line"><span style="color:#E1E4E8;">    location </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        root </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">usr</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">share</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">html;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">server {</span></span>
<span class="line"><span style="color:#E1E4E8;">    listen </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    server_name </span><span style="color:#79B8FF;">www.sswang.com</span><span style="color:#E1E4E8;">; </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">301</span><span style="color:#E1E4E8;"> https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">$host</span><span style="color:#E1E4E8;">$request_uri; </span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>手工创建资源对象文件</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">创建cm资源对象</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl create configmap nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ssl</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">conf </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">from</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">file</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">conf</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tls</span><span style="color:#F97583;">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">创建secret资源对象</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl create secret tls nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ssl</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">secret </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">cert</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">tls</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tls.crt </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">key</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">tls</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">key</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">tls.key</span></span>
<span class="line"><span style="color:#E1E4E8;">定制资源清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Pod</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ssl</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sswang</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx_web:v0.</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    name: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">    volumeMounts:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxcerts</span></span>
<span class="line"><span style="color:#E1E4E8;">      mountPath: </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">certs</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">      readOnly: true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxconfs</span></span>
<span class="line"><span style="color:#E1E4E8;">      mountPath: </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">conf.d</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">      readOnly: true</span></span>
<span class="line"><span style="color:#E1E4E8;">  volumes:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxcerts</span></span>
<span class="line"><span style="color:#E1E4E8;">    secret:</span></span>
<span class="line"><span style="color:#E1E4E8;">      secretName: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ssl</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> name: nginxconfs</span></span>
<span class="line"><span style="color:#E1E4E8;">    configMap:</span></span>
<span class="line"><span style="color:#E1E4E8;">      name: nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ssl</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_7-服务访问" tabindex="-1">7 服务访问 <a class="header-anchor" href="#_7-服务访问" aria-hidden="true">#</a></h2><h3 id="_7-1-ingress简介" tabindex="-1">7.1 Ingress简介 <a class="header-anchor" href="#_7-1-ingress简介" aria-hidden="true">#</a></h3><p>原理解析</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">Ingress是授权入站连接到达集群服务的规则集合。</span></span>
<span class="line"><span style="color:#E1E4E8;">    从外部流量调度到nodeport上的service</span></span>
<span class="line"><span style="color:#E1E4E8;">    从service调度到ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller</span></span>
<span class="line"><span style="color:#E1E4E8;">    ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller根据ingress[</span><span style="color:#F97583;">Pod</span><span style="color:#E1E4E8;">]中的定义（虚拟主机或者后端的url）</span></span>
<span class="line"><span style="color:#E1E4E8;">    根据虚拟主机名直接调度到后端的一组应用pod中</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/f88dcb5bf765417ca8675796f14cef7b.png" alt="image.png"></p><h3 id="_7-2-ingress部署" tabindex="-1">7.2 Ingress部署 <a class="header-anchor" href="#_7-2-ingress部署" aria-hidden="true">#</a></h3><p>环境部署</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">获取配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">cd </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">app_secure</span></span>
<span class="line"><span style="color:#E1E4E8;">mkdir ingress ; cd ingress</span></span>
<span class="line"><span style="color:#E1E4E8;">wget https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">raw.githubusercontent.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">controller</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v1.</span><span style="color:#79B8FF;">3.1</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">deploy</span><span style="color:#F97583;">/static/</span><span style="color:#E1E4E8;">provider</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">baremetal</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">deploy.yaml</span></span>
<span class="line"><span style="color:#E1E4E8;">mv deploy.yaml ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">deploy.yaml</span></span>
<span class="line"><span style="color:#E1E4E8;">cp ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">deploy.yaml{</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;">.bak}</span></span>
<span class="line"><span style="color:#E1E4E8;">默认镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># grep image: ingress-deploy.yaml | awk -F &#39;/|@&#39; &#39;{print $(NF-1)}&#39; | uniq</span></span>
<span class="line"><span style="color:#E1E4E8;">controller:v1.</span><span style="color:#79B8FF;">3.1</span></span>
<span class="line"><span style="color:#E1E4E8;">kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">webhook</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">certgen:v1.</span><span style="color:#79B8FF;">3.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">获取镜像</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller:v1.</span><span style="color:#79B8FF;">3.1</span><span style="color:#E1E4E8;"> kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">webhook</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">certgen:v1.</span><span style="color:#79B8FF;">3.0</span></span>
<span class="line"><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker pull </span><span style="color:#79B8FF;">registry.cn-hangzhou.aliyuncs.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker tag </span><span style="color:#79B8FF;">registry.cn-hangzhou.aliyuncs.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker push </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">  docker rmi </span><span style="color:#79B8FF;">registry.cn-hangzhou.aliyuncs.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">$i</span></span>
<span class="line"><span style="color:#E1E4E8;">done</span></span>
<span class="line"><span style="color:#E1E4E8;">注意：</span></span>
<span class="line"><span style="color:#E1E4E8;">	controller的名称是需要更改一下，阿里云的镜像名称多了一个标识</span></span>
<span class="line"><span style="color:#E1E4E8;">修改基础镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># grep image: ingress-deploy.yaml</span></span>
<span class="line"><span style="color:#E1E4E8;">          image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller:v1.</span><span style="color:#79B8FF;">3.1</span></span>
<span class="line"><span style="color:#E1E4E8;">          image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">webhook</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">certgen:v1.</span><span style="color:#79B8FF;">3.0</span></span>
<span class="line"><span style="color:#E1E4E8;">          image: </span><span style="color:#79B8FF;">kubernetes-register.sswang.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">google_containers</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kube</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">webhook</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">certgen:v1.</span><span style="color:#79B8FF;">3.0</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#E1E4E8;">开放访问入口地址  </span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># vim ingress-deploy.yaml</span></span>
<span class="line"><span style="color:#E1E4E8;">...</span></span>
<span class="line"><span style="color:#79B8FF;">334</span><span style="color:#E1E4E8;"> apiVersion: v1</span></span>
<span class="line"><span style="color:#79B8FF;">335</span><span style="color:#E1E4E8;"> kind: Service</span></span>
<span class="line"><span style="color:#E1E4E8;">...</span></span>
<span class="line"><span style="color:#79B8FF;">344</span><span style="color:#E1E4E8;">   namespace: ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span></span>
<span class="line"><span style="color:#79B8FF;">345</span><span style="color:#E1E4E8;"> spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">      ...</span></span>
<span class="line"><span style="color:#79B8FF;">348</span><span style="color:#E1E4E8;">   ipFamilyPolicy: SingleStack</span></span>
<span class="line"><span style="color:#79B8FF;">349</span><span style="color:#E1E4E8;">   externalIPs: [</span><span style="color:#9ECBFF;">&#39;10.0.0.12&#39;</span><span style="color:#E1E4E8;">]			</span><span style="color:#6A737D;"># 限制集群外部访问的入口ip</span></span>
<span class="line"><span style="color:#79B8FF;">350</span><span style="color:#E1E4E8;">   ports:</span></span>
<span class="line"><span style="color:#79B8FF;">351</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> appProtocol: http</span></span>
<span class="line"><span style="color:#79B8FF;">352</span><span style="color:#E1E4E8;">     name: http</span></span>
<span class="line"><span style="color:#79B8FF;">353</span><span style="color:#E1E4E8;">     port: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">...</span></span>
<span class="line"><span style="color:#79B8FF;">628</span><span style="color:#E1E4E8;">   failurePolicy: Ignore				    </span><span style="color:#6A737D;"># 为了避免默认的准入控制限制，改为Ignore</span></span>
<span class="line"><span style="color:#E1E4E8;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">应用资源配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># kubectl apply -f ingress-deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">确认效果</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># kubectl get all -n ingress-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">NAME                                            READY   STATUS      RESTARTS   AGE</span></span>
<span class="line"><span style="color:#E1E4E8;">pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">admission</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">create</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">s5p7h        </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Completed   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          105s</span></span>
<span class="line"><span style="color:#E1E4E8;">pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">admission</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">patch</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">qnjmv         </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Completed   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          105s</span></span>
<span class="line"><span style="color:#E1E4E8;">pod</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">6cc467dfd9</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">c2dfg   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     Running     </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          105s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">NAME                                         TYPE        CLUSTER</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">IP       EXTERNAL</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">IP   PORT(S)                      AGE</span></span>
<span class="line"><span style="color:#E1E4E8;">service</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller             NodePort    </span><span style="color:#79B8FF;">10.109</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">163.145</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0.12</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">30439</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">TCP</span><span style="color:#F97583;">,</span><span style="color:#79B8FF;">443</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">31912</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">TCP   105s</span></span>
<span class="line"><span style="color:#E1E4E8;">service</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">admission   ClusterIP   </span><span style="color:#79B8FF;">10.96</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">223.121</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">none</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">443</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">TCP                      105s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">NAME                                       READY   UP</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">TO</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#E1E4E8;">deployment.apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">           105s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">NAME                                                  DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#E1E4E8;">replicaset.apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">controller</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">6cc467dfd9   </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">       105s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">NAME                                       COMPLETIONS   DURATION   AGE</span></span>
<span class="line"><span style="color:#E1E4E8;">job.batch</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">admission</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">create   </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">           8s         105s</span></span>
<span class="line"><span style="color:#E1E4E8;">job.batch</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">admission</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">patch    </span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">           7s         105s</span></span>
<span class="line"><span style="color:#E1E4E8;">测试访问页面</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span><span style="color:#6A737D;"># curl 10.0.0.12:30439</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">html</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">head</span><span style="color:#F97583;">&gt;&lt;</span><span style="color:#E1E4E8;">title</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;"> Not Found</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">title</span><span style="color:#F97583;">&gt;&lt;/</span><span style="color:#E1E4E8;">head</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">body</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">center</span><span style="color:#F97583;">&gt;&lt;</span><span style="color:#E1E4E8;">h</span><span style="color:#F97583;">1&gt;</span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;"> Not Found</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">h</span><span style="color:#F97583;">1&gt;&lt;/</span><span style="color:#E1E4E8;">center</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">hr</span><span style="color:#F97583;">&gt;&lt;</span><span style="color:#E1E4E8;">center</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">center</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">body</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;/</span><span style="color:#E1E4E8;">html</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h3 id="_7-3-ingress实践" tabindex="-1">7.3 Ingress实践 <a class="header-anchor" href="#_7-3-ingress实践" aria-hidden="true">#</a></h3><p>定制资源清单文件</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">定制资源清单文件</span></span>
<span class="line"><span style="color:#E1E4E8;">apiVersion: networking.k8s.io</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">v1</span></span>
<span class="line"><span style="color:#E1E4E8;">kind: Ingress</span></span>
<span class="line"><span style="color:#E1E4E8;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  name: superopsmsb</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ingress</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">mulhost</span></span>
<span class="line"><span style="color:#E1E4E8;">  annotations:</span></span>
<span class="line"><span style="color:#E1E4E8;">    kubernetes.io</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ingress.class: </span><span style="color:#9ECBFF;">&quot;nginx&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  rules:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> host: </span><span style="color:#79B8FF;">nginx.sswang.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    http:</span></span>
<span class="line"><span style="color:#E1E4E8;">      paths:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> path: </span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">        pathType: Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">        backend:</span></span>
<span class="line"><span style="color:#E1E4E8;">          service:</span></span>
<span class="line"><span style="color:#E1E4E8;">            name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nginx</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">            port:</span></span>
<span class="line"><span style="color:#E1E4E8;">              number: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> host: </span><span style="color:#79B8FF;">tomcat.sswang.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    http:</span></span>
<span class="line"><span style="color:#E1E4E8;">      paths:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> path: </span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">        pathType: Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">        backend:</span></span>
<span class="line"><span style="color:#E1E4E8;">          service:</span></span>
<span class="line"><span style="color:#E1E4E8;">            name: sswang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tomcat</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">            port:</span></span>
<span class="line"><span style="color:#E1E4E8;">              number: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_8-helm管理" tabindex="-1">8 helm管理 <a class="header-anchor" href="#_8-helm管理" aria-hidden="true">#</a></h2><h3 id="_8-1-helm简介" tabindex="-1">8.1 helm简介 <a class="header-anchor" href="#_8-1-helm简介" aria-hidden="true">#</a></h3><p>需求</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">在kubernetes平台上，我们在部署各种各样的应用服务的时候，可以基于手工或者自动的方式对各种资源对象实现伸缩操作，尤其是对于有状态的应用，我们可以结合持久性存储机制实现更大场景的伸缩动作。但是，无论我们怎么操作各种资源对象，问题最多的就是各种基础配置、镜像等之类的依赖管理操作。在linux平台下，常见的包依赖的就是yum、apt等工具，在kubernetes平台下，同样有类似的解决依赖关系的工具 </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;"> helm。</span></span>
<span class="line"><span style="color:#E1E4E8;">官方网址：https:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">v3.helm.sh</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">官方地址：https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">github.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>简介</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">helm的功能类似于yum 或 apt，提供应用部署时候所需要的各种配置、资源清单文件，他与yum之类工具不同的是，在k8s中helm是不提供镜像的，这些镜像文件需要由专门的镜像仓库来提供。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	例如：k8s平台上的nginx应用部署，对于该应用部署来说，主要需要三类内容：</span></span>
<span class="line"><span style="color:#E1E4E8;">        镜像：nginx镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">        资源定义文件：Deployment、service、hpa等</span></span>
<span class="line"><span style="color:#E1E4E8;">        专用文件：配置文件、证书等</span></span>
<span class="line"><span style="color:#E1E4E8;">        helm管理的主要是：资源定义文件和专用文件。</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/634d4622159f447e9e3612a44f266b14.png" alt="image.png"></p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">基于helm来成功的部署一个应用服务，完整的工作流程如下：</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> 部署一个稳定运行的k8s集群，在能管理k8s的主机上部署helm。</span></span>
<span class="line"><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> 用户在客户端主机上，定制各种Chart资源和config资源，上传到专用的仓库(本地或者远程)</span></span>
<span class="line"><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> helm客户端向Tiller发出部署请求，如果本地有chart用本地的，否则从仓库获取</span></span>
<span class="line"><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> Tiller与k8s集群的api</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">server发送请求</span></span>
<span class="line"><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> api</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">server通过集群内部机制部署应用，需要依赖镜像的时候，从专门的镜像仓库获取。</span></span>
<span class="line"><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> 基于helm部署好的应用实例，在k8s集群中，我们称之为release。</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>v3介绍</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">根据我们对 helm v2 版本的流程解析，我们发现，在客户端上部署tiller来维护 release相关的信息，有些太重量级了，所以在 helm v3 版本的时候，就剔除了专门的Tiller。在 Helm v3 中移除了 Tiller</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> 版本相关的数据直接存储在了 Kubernetes 中.</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://raw.githubusercontent.com/DunXi/images/main/img/6efef8c8d5c64c7a853fd41507e67a9e.png" alt="image.png"></p><h3 id="_8-2-helm部署" tabindex="-1">8.2 helm部署 <a class="header-anchor" href="#_8-2-helm部署" aria-hidden="true">#</a></h3><p>软件部署</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">下载软件</span></span>
<span class="line"><span style="color:#E1E4E8;">cd </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">softs</span></span>
<span class="line"><span style="color:#E1E4E8;">wget https:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">get.helm.sh</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v3.</span><span style="color:#79B8FF;">13.0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">配置环境</span></span>
<span class="line"><span style="color:#E1E4E8;">mkdir </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p</span></span>
<span class="line"><span style="color:#E1E4E8;">tar xf helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v3.</span><span style="color:#79B8FF;">13.0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">amd64.tar.gz</span></span>
<span class="line"><span style="color:#E1E4E8;">mv linux</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">amd64</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">环境变量</span></span>
<span class="line"><span style="color:#6A737D;"># cat /etc/profile.d/helm.sh</span></span>
<span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="color:#6A737D;"># set helm env</span></span>
<span class="line"><span style="color:#E1E4E8;">export PATH</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">$PATH:</span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">chmod </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">x </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">profile.d</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm.sh</span></span>
<span class="line"><span style="color:#E1E4E8;">source </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">profile.d</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">helm.sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">确认效果</span></span>
<span class="line"><span style="color:#6A737D;"># helm  version</span></span>
<span class="line"><span style="color:#E1E4E8;">version.BuildInfo{Version:</span><span style="color:#9ECBFF;">&quot;v3.13.0&quot;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> GitCommit:</span><span style="color:#9ECBFF;">&quot;1d11fcb5d3f3bf00dbe6fe31b8412839a96b3dc4&quot;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> GitTreeState:</span><span style="color:#9ECBFF;">&quot;clean&quot;</span><span style="color:#F97583;">,</span><span style="color:#E1E4E8;"> GoVersion:</span><span style="color:#9ECBFF;">&quot;go1.16.9&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>命令帮助</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#6A737D;"># helm --help</span></span>
<span class="line"><span style="color:#E1E4E8;">The Kubernetes package manager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Common actions </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> Helm:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> helm search:    search </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> charts</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> helm pull:      download a chart to your local directory to view</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> helm install:   upload the chart to Kubernetes</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> helm list:      list releases of charts</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_8-3-helm实践" tabindex="-1">8.3 helm实践 <a class="header-anchor" href="#_8-3-helm实践" aria-hidden="true">#</a></h3><p>仓库管理</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">添加仓库 </span></span>
<span class="line"><span style="color:#E1E4E8;">helm repo add az</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">stable http:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">mirror.azure.cn</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">charts</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">helm repo add bitnami https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">charts.bitnami.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bitnami</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">查看仓库</span></span>
<span class="line"><span style="color:#6A737D;"># helm repo list</span></span>
<span class="line"><span style="color:#E1E4E8;">NAME            URL</span></span>
<span class="line"><span style="color:#E1E4E8;">az</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">stable       http:</span><span style="color:#F97583;">//</span><span style="color:#E1E4E8;">mirror.azure.cn</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kubernetes</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">charts</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">bitnami         https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">charts.bitnami.com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bitnami</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">更新仓库属性信息</span></span>
<span class="line"><span style="color:#E1E4E8;">helm repo update</span></span>
<span class="line"><span style="color:#E1E4E8;">搜索chart信息</span></span>
<span class="line"><span style="color:#6A737D;"># helm search --help</span></span>
<span class="line"><span style="color:#E1E4E8;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">Available Commands:</span></span>
<span class="line"><span style="color:#E1E4E8;">  hub         search </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> charts </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> the Artifact Hub or your own hub instance</span></span>
<span class="line"><span style="color:#E1E4E8;">  repo        search repositories </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> a keyword </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> charts</span></span>
<span class="line"><span style="color:#E1E4E8;">  结果显示：</span></span>
<span class="line"><span style="color:#E1E4E8;">  	helm 有两种搜索的源地址，官方的在 Artifact，幸运的是，无法访问。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">从自定义仓库中获取源信息</span></span>
<span class="line"><span style="color:#E1E4E8;">helm search repo redis</span></span>
<span class="line"><span style="color:#E1E4E8;">查看chart的所有信息</span></span>
<span class="line"><span style="color:#E1E4E8;">helm show all bitnami</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">redis</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>redis实践</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">安装chart</span></span>
<span class="line"><span style="color:#E1E4E8;">helm install my_helm bitnami</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">删除应用</span></span>
<span class="line"><span style="color:#E1E4E8;">helm uninstall my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">更新应用</span></span>
<span class="line"><span style="color:#E1E4E8;">helm install my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm bitnami</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">redis </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">set master.persistence.enabled</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">false </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">set replica.persistence.enabled</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">查看效果</span></span>
<span class="line"><span style="color:#E1E4E8;">helm list</span></span>
<span class="line"><span style="color:#E1E4E8;">kubectl get pod</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>简单实践</p><div class="language-powershell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark" tabindex="0"><code><span class="line"><span style="color:#E1E4E8;">查看基本操作的信息</span></span>
<span class="line"><span style="color:#E1E4E8;">helm status my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">获取具备读写权限的主机域名</span></span>
<span class="line"><span style="color:#E1E4E8;"> 	redis主角色主机： my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">master.default.svc.cluster.local</span></span>
<span class="line"><span style="color:#E1E4E8;"> 	redis从角色主机： my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">replicas.default.svc.cluster.local</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">获取连接密码</span></span>
<span class="line"><span style="color:#6A737D;"># export REDIS_PASSWORD=$(kubectl get secret --namespace default my-helm-redis -o jsonpath=&quot;{.data.redis-password}&quot; | base64 --decode)</span></span>
<span class="line"><span style="color:#6A737D;"># echo $REDIS_PASSWORD</span></span>
<span class="line"><span style="color:#E1E4E8;">ID6KzPAZc1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">创建客户端</span></span>
<span class="line"><span style="color:#6A737D;"># kubectl run --namespace default redis-client --restart=&#39;Never&#39;  --env REDIS_PASSWORD=$REDIS_PASSWORD  --image docker.io/bitnami/redis:6.2.6-debian-10-r0 --command -- sleep infinity</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">连接redis主角色</span></span>
<span class="line"><span style="color:#E1E4E8;">$ redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cli </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">master.default.svc.cluster.local </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">a ID6KzPAZc1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">redis操作</span></span>
<span class="line"><span style="color:#E1E4E8;">my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">master.default.svc.cluster.local:</span><span style="color:#79B8FF;">6379</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> set a </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">OK</span></span>
<span class="line"><span style="color:#E1E4E8;">my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">master.default.svc.cluster.local:</span><span style="color:#79B8FF;">6379</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> set b </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">OK</span></span>
<span class="line"><span style="color:#E1E4E8;">my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">master.default.svc.cluster.local:</span><span style="color:#79B8FF;">6379</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> keys </span><span style="color:#F97583;">*</span></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">&quot;a&quot;</span></span>
<span class="line"><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">&quot;b&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">my</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">helm</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">redis</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">master.default.svc.cluster.local:</span><span style="color:#79B8FF;">6379</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> get a</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;1&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div>`,156),o=[e];function r(c,E,t,i,y,b){return a(),n("div",null,o)}const F=s(p,[["render",r]]);export{u as __pageData,F as default};
